(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"/xpB":function(l,n,e){"use strict";e.d(n,"a",(function(){return t}));var u=e("rRT/");class t extends u.a{}},"Id+k":function(l,n,e){"use strict";e.d(n,"a",(function(){return t})),e.d(n,"b",(function(){return i}));var u=e("8Y7J"),t=(e("eXX1"),e("9Zsr"),u.ob({encapsulation:2,styles:[],data:{}}));function a(l){return u.Mb(0,[(l()(),u.fb(0,null,null,0))],null,null)}function i(l){return u.Mb(0,[(l()(),u.fb(0,null,null,0,null,a))],null,null)}},K33K:function(l,n,e){"use strict";e.r(n);var u=e("8Y7J");class t{}var a=e("pMnS"),i=e("9AJC"),r=e("s7LF"),s=e("MisT"),o=e("LTyc"),c=e("7PPj"),b=e("dpqa"),d=e("G0yt"),p=e("nUl2"),g=e("9rfo"),h=e("OXuP"),m=e("wBwE"),f=e("iA0r"),C=e("4D8R"),v=e("UjDu"),y=e("8PDw"),q=e("cm5s"),_=e("a07c"),k=e("ib0n"),I=e("SVse"),T=e("DwFa"),w=e("t7hH"),R=e("9Zsr"),S=e("Qm07"),O=e("OsfI"),x=e("ZvpF"),D=e("Id+k"),B=e("eXX1"),P=e("y+3C"),K=e("QGNW"),A=e("iInd"),L=e("dix8"),j=e("ufrD"),N=e("WZ78"),M=e("ayJW"),E=e("cUpR"),V=e("+CBd"),z=e("vG6Q"),G=e("x6nW"),F=e("gBxT"),H=e("wVJ/"),U=e("wN9v"),$=e("dbQr"),J=e("9emE"),X=e("taEJ"),W=e("/xpB"),Z=e("LRne"),Q=e("vkgz"),Y=e("JX91"),ll=e("eIep"),nl=e("7o/Q"),el=e("sVev");function ul(l){return n=>n.lift(new tl(l,n))}class tl{constructor(l,n){this.predicate=l,this.source=n}call(l,n){return n.subscribe(new al(l,this.predicate,this.source))}}class al extends nl.a{constructor(l,n,e){super(l),this.predicate=n,this.source=e,this.seenValue=!1,this.index=0}applySingleValue(l){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=l)}_next(l){const n=this.index++;this.predicate?this.tryNext(l,n):this.applySingleValue(l)}tryNext(l,n){try{this.predicate(l,n,this.source)&&this.applySingleValue(l)}catch(e){this.destination.error(e)}}_complete(){const l=this.destination;this.index>0?(l.next(this.seenValue?this.singleValue:void 0),l.complete()):l.error(new el.a)}}var il=e("Osig"),rl=e("rRT/"),sl=e("f0Wu");function ol(l){return n=>n.value&&n.value.isBefore(l)?{tooEarly:"This cannot be before "+l.format("LLL")}:null}class cl{validate(l){return this.notBeforeMoment?ol(this.notBeforeMoment)(l):null}}var bl=e("JIr8");let dl=(()=>{class l{constructor(l,n){this.auth=l,this.net=n,this.validate=l=>this.parseActorCall(this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",l.value.trim())),this.parseActorCall=l=>l.pipe(ul(),Object(ll.a)(()=>Object(Z.a)(null)),Object(bl.a)(l=>l instanceof el.a?Object(Z.a)({patronBarcode:"No patron found with that barcode"}):"Sequence contains more than one element"===l?Object(Z.a)({patronBarcode:"Barcode matches more than one patron"}):void 0))}}return l.ngInjectableDef=u.Qb({factory:function(){return new l(u.Rb(y.a),u.Rb(il.b))},token:l,providedIn:"root"}),l})();var pl=e("YRS1");const gl=l=>{const n=l.get("startTime").value,e=l.get("endTime").value;return null!==n&&null!==e&&n.isBefore(e)?null:{startTimeNotBeforeEndTime:!0}};class hl extends rl.a{constructor(l,n,e,t,a,i,r,s,o){super(r),this.auth=l,this.format=n,this.net=e,this.org=t,this.pcrud=a,this.router=i,this.modal=r,this.pbv=s,this.toast=o,this.attributes=[],this.resources=[],this.timezone=this.format.wsOrgTimezone,this.openPatronReservations=()=>{this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value).subscribe(l=>this.router.navigate(["/staff","booking","manage_reservations","by_patron",l[0].id]))},this.addBresvAndOpenPatronReservations=()=>{this.addBresv$().subscribe(()=>this.openPatronReservations())},this.onComplete=new u.m}ngOnInit(){this.create=new r.j({patronBarcode:new r.h("",[r.B.required],[this.pbv.validate]),emailNotify:new r.h(!0),startTime:new r.h(null,ol(sl().add("15","minutes"))),endTime:new r.h,resourceList:new r.h,note:new r.h},[gl]),this.patronId&&this.pcrud.search("au",{id:this.patronId},{flesh:1,flesh_fields:{au:["card"]}}).subscribe(l=>this.create.patchValue({patronBarcode:l.card().barcode()})),this.addBresv$=()=>{let l=this.targetResource?[this.targetResource]:null;return l||null===this.resourceListSelection||"any"===this.resourceListSelection.id||(l=[this.resourceListSelection.id]),this.net.request("open-ils.booking","open-ils.booking.reservations.create",this.auth.token(),this.patronBarcode.value.trim(),this.selectedTimes,this.pickupLibId,this.targetResourceType.id,l,this.attributes.filter(Boolean),this.emailNotify,this.bresvNote).pipe(Object(Q.a)(l=>{l.ilsevent?(console.warn(l),this.fail.open()):(this.toast.success("Reservation successfully created"),console.debug(l),this.close())},l=>{console.warn(l),this.fail.open()},()=>this.onComplete.emit(!0)))},this.handlePickupLibChange=l=>{this.pickupLibId=l.id(),this.org.settings("lib.timezone",this.pickupLibId).then(l=>{this.timezone=l["lib.timezone"]||this.format.wsOrgTimezone,this.pickupLibraryUsesDifferentTz=l["lib.timezone"]&&this.format.wsOrgTimezone!==l["lib.timezone"]})},this.disableOrgs=()=>this.org.filterList({canHaveVolumes:!1},!0),this.patron$=this.patronBarcode.statusChanges.pipe(Object(Y.a)({first_given_name:"",second_given_name:"",family_name:""}),Object(ll.a)(()=>"VALID"===this.patronBarcode.status?this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value.trim()).pipe(ul(),Object(ll.a)(l=>this.pcrud.retrieve("au",l[0].id).pipe(Object(ll.a)(l=>Object(Z.a)({first_given_name:l.first_given_name(),second_given_name:l.second_given_name(),family_name:l.family_name()}))))):Object(Z.a)({first_given_name:"",second_given_name:"",family_name:""})))}setDefaultTimes(l,n){this.create.patchValue({startTime:sl.min(l),endTime:sl.max(l).clone().add(n,"minutes")})}get emailNotify(){return this.create.get("emailNotify").value}get bresvNote(){return this.create.get("note").value}get patronBarcode(){return this.create.get("patronBarcode")}get resourceListSelection(){return this.create.get("resourceList").value}get selectedTimes(){return[this.create.get("startTime").value.toISOString(),this.create.get("endTime").value.toISOString()]}}var ml=u.ob({encapsulation:2,styles:[],data:{}});function fl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,4,"div",[["class","alert alert-danger offset-lg-4"],["role","alert"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"span",[["aria-hidden","true"],["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["error"])),(l()(),u.qb(3,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Start time must be before end time"]))],null,null)}function Cl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,4,"div",[["class","alert alert-info"],["role","alert"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"span",[["aria-hidden","true"],["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["access_time"])),(l()(),u.qb(3,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(4,null,["Reservation location is in the "," timezone"]))],null,(function(l,n){l(n,4,0,n.component.timezone)}))}function vl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,0,"input",[["disabled",""],["id","create-resource"]],[[8,"value",0]],null,null,null,null))],null,(function(l,n){l(n,0,0,u.ub(1,"",n.component.targetResourceBarcode,""))}))}function yl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-combobox-entry",[],null,null,null,_.b,_.a)),u.pb(1,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null)],(function(l,n){var e=u.ub(1,"",n.context.$implicit.id(),""),t=u.ub(1,"",n.context.$implicit.barcode(),"");l(n,1,0,e,t)}),null)}function ql(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,9,"eg-combobox",[["formControlName","resourceList"],["startId","any"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,p.b,p.a)),u.pb(1,114688,null,0,g.a,[u.k,h.a,m.a,f.a],{startId:[0,"startId"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[g.a]),u.pb(3,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(5,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(6,0,null,null,1,"eg-combobox-entry",[["entryId","any"],["entryLabel","Any resource"]],null,null,null,_.b,_.a)),u.pb(7,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null),(l()(),u.fb(16777216,null,null,1,null,yl)),u.pb(9,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=n.component;l(n,1,0,"any"),l(n,3,0,"resourceList"),l(n,7,0,"any","Any resource"),l(n,9,0,e.resources)}),(function(l,n){l(n,0,0,u.Cb(n,5).ngClassUntouched,u.Cb(n,5).ngClassTouched,u.Cb(n,5).ngClassPristine,u.Cb(n,5).ngClassDirty,u.Cb(n,5).ngClassValid,u.Cb(n,5).ngClassInvalid,u.Cb(n,5).ngClassPending)}))}function _l(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"h3",[["class","modal-title"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Confirm Reservation Details"])),(l()(),u.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.dismiss("cross_click")&&u),u}),null,null)),(l()(),u.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Ã—"])),(l()(),u.qb(6,0,null,null,70,"form",[["class","modal-body form-common"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,8).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,8).onReset()&&t),t}),null,null)),u.pb(7,16384,null,0,r.G,[],null,null),u.pb(8,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(10,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(11,0,null,null,13,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(12,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-patron-barcode"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Patron barcode"])),(l()(),u.qb(14,0,null,null,5,"input",[["class","form-control col-lg-7"],["formControlName","patronBarcode"],["id","create-patron-barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,15)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,15).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,15)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,15)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(15,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(17,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"],isDisabled:[1,"isDisabled"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(19,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(20,0,null,null,4,"span",[["class","col-lg-7 offset-lg-4"]],null,null,null,null,null)),(l()(),u.Kb(21,null,[" "," "," "," "])),u.Eb(131072,I.b,[u.h]),u.Eb(131072,I.b,[u.h]),u.Eb(131072,I.b,[u.h]),(l()(),u.qb(25,0,null,null,7,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(26,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-end-time"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Start time"])),(l()(),u.qb(28,0,null,null,4,"eg-datetime-select",[["formControlName","startTime"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,V.b,V.a)),u.pb(29,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[8,null],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(31,16384,null,0,r.q,[[4,r.p]],null,null),u.pb(32,114688,null,0,z.a,[x.a,G.a,[6,r.p]],{timezone:[0,"timezone"]},null),(l()(),u.qb(33,0,null,null,9,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(34,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-end-time"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["End time"])),(l()(),u.qb(36,0,null,null,4,"eg-datetime-select",[["formControlName","endTime"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,V.b,V.a)),u.pb(37,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[8,null],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(39,16384,null,0,r.q,[[4,r.p]],null,null),u.pb(40,114688,null,0,z.a,[x.a,G.a,[6,r.p]],{timezone:[0,"timezone"]},null),(l()(),u.fb(16777216,null,null,1,null,fl)),u.pb(42,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(43,0,null,null,6,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(44,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-pickup-library"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Reservation location"])),(l()(),u.qb(46,0,null,null,1,"eg-org-select",[["domId","create-pickup-library"]],null,[[null,"onChange"]],(function(l,n,e){var u=!0;return"onChange"===n&&(u=!1!==l.component.handlePickupLibChange(e)&&u),u}),F.b,F.a)),u.pb(47,114688,null,0,H.a,[y.a,h.a,q.a,U.a],{domId:[0,"domId"],applyDefault:[1,"applyDefault"],hideOrgs:[2,"hideOrgs"],disableOrgs:[3,"disableOrgs"]},{onChange:"onChange"}),(l()(),u.qb(48,0,null,null,1,"eg-help-popover",[["helpText","The library where the resource is picked up or used"]],null,null,null,$.b,$.a)),u.pb(49,114688,null,0,J.a,[],{helpText:[0,"helpText"]},null),(l()(),u.fb(16777216,null,null,1,null,Cl)),u.pb(51,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(52,0,null,null,6,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(53,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-resource"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Resource"])),(l()(),u.fb(16777216,null,null,1,null,vl)),u.pb(56,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,ql)),u.pb(58,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(59,0,null,null,8,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(60,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-email-notify"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Notify by email?"])),(l()(),u.qb(62,0,null,null,5,"input",[["formControlName","emailNotify"],["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],(function(l,n,e){var t=!0;return"change"===n&&(t=!1!==u.Cb(l,63).onChange(e.target.checked)&&t),"blur"===n&&(t=!1!==u.Cb(l,63).onTouched()&&t),t}),null,null)),u.pb(63,16384,null,0,r.b,[u.C,u.k],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.b]),u.pb(65,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(67,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(68,0,null,null,8,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),u.qb(69,0,null,null,1,"label",[["class","col-lg-4 text-right font-weight-bold"],["for","create-note"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Note"])),(l()(),u.qb(71,0,null,null,5,"input",[["class","form-control col-lg-7"],["formControlName","note"],["id","create-note"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,72)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,72).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,72)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,72)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(72,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(74,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(76,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(77,0,null,null,6,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),u.qb(78,0,null,null,1,"button",[["class","btn btn-info"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.addBresv$().subscribe()&&u),u}),null,null)),(l()(),u.Kb(-1,null,["Confirm reservation"])),(l()(),u.qb(80,0,null,null,1,"button",[["class","btn btn-info"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.addBresvAndOpenPatronReservations()&&u),u}),null,null)),(l()(),u.Kb(-1,null,[" Confirm and show patron reservations "])),(l()(),u.qb(82,0,null,null,1,"button",[["class","btn btn-warning ml-2"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.close()&&u),u}),null,null)),(l()(),u.Kb(-1,null,["Cancel"]))],(function(l,n){var e=n.component;l(n,8,0,e.create),l(n,17,0,"patronBarcode",e.patronId),l(n,29,0,"startTime"),l(n,32,0,e.timezone),l(n,37,0,"endTime"),l(n,40,0,e.timezone),l(n,42,0,e.create.errors&&e.create.errors.startTimeNotBeforeEndTime),l(n,47,0,"create-pickup-library",!0,e.disableOrgs(),e.disableOrgs()),l(n,49,0,"The library where the resource is picked up or used"),l(n,51,0,e.pickupLibraryUsesDifferentTz),l(n,56,0,e.targetResource&&e.targetResourceBarcode),l(n,58,0,!(e.targetResource&&e.targetResourceBarcode)),l(n,65,0,"emailNotify"),l(n,74,0,"note")}),(function(l,n){var e,t,a,i=n.component;l(n,6,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending),l(n,14,0,u.Cb(n,19).ngClassUntouched,u.Cb(n,19).ngClassTouched,u.Cb(n,19).ngClassPristine,u.Cb(n,19).ngClassDirty,u.Cb(n,19).ngClassValid,u.Cb(n,19).ngClassInvalid,u.Cb(n,19).ngClassPending),l(n,21,0,null==(e=u.Lb(n,21,0,u.Cb(n,22).transform(i.patron$)))?null:e.first_given_name,null==(t=u.Lb(n,21,1,u.Cb(n,23).transform(i.patron$)))?null:t.second_given_name,null==(a=u.Lb(n,21,2,u.Cb(n,24).transform(i.patron$)))?null:a.family_name),l(n,28,0,u.Cb(n,31).ngClassUntouched,u.Cb(n,31).ngClassTouched,u.Cb(n,31).ngClassPristine,u.Cb(n,31).ngClassDirty,u.Cb(n,31).ngClassValid,u.Cb(n,31).ngClassInvalid,u.Cb(n,31).ngClassPending),l(n,36,0,u.Cb(n,39).ngClassUntouched,u.Cb(n,39).ngClassTouched,u.Cb(n,39).ngClassPristine,u.Cb(n,39).ngClassDirty,u.Cb(n,39).ngClassValid,u.Cb(n,39).ngClassInvalid,u.Cb(n,39).ngClassPending),l(n,62,0,u.Cb(n,67).ngClassUntouched,u.Cb(n,67).ngClassTouched,u.Cb(n,67).ngClassPristine,u.Cb(n,67).ngClassDirty,u.Cb(n,67).ngClassValid,u.Cb(n,67).ngClassInvalid,u.Cb(n,67).ngClassPending),l(n,71,0,u.Cb(n,76).ngClassUntouched,u.Cb(n,76).ngClassTouched,u.Cb(n,76).ngClassPristine,u.Cb(n,76).ngClassDirty,u.Cb(n,76).ngClassValid,u.Cb(n,76).ngClassInvalid,u.Cb(n,76).ngClassPending),l(n,78,0,!i.create.valid),l(n,80,0,!i.create.valid)}))}function kl(l){return u.Mb(0,[u.Ib(671088640,1,{dialogContent:0}),u.Ib(402653184,2,{fail:0}),(l()(),u.fb(0,[[1,2],["dialogContent",2]],null,0,null,_l)),(l()(),u.qb(3,0,null,null,1,"eg-alert-dialog",[["dialogBody","Could not create this reservation"]],null,null,null,X.b,X.a)),u.pb(4,114688,[[2,4],["fail",4]],0,W.a,[d.E],{dialogBody:[0,"dialogBody"]},null)],(function(l,n){l(n,4,0,"Could not create this reservation")}),null)}var Il=e("7Apk"),Tl=e("UUQ6");class wl extends rl.a{openLSE(){window.open("/eg/staff/admin/local/asset/org_unit_settings","_blank")}}var Rl=u.ob({encapsulation:2,styles:[],data:{}});function Sl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Timezone not set for your library"])),(l()(),u.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.dismiss("cross_click")&&u),u}),null,null)),(l()(),u.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Ã—"])),(l()(),u.qb(6,0,null,null,5,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),u.qb(7,0,null,null,4,"p",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Please make sure that "])),(l()(),u.qb(9,0,null,null,1,"i",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["lib.timezone"])),(l()(),u.Kb(-1,null,[" has a valid value in the Library Settings Editor."])),(l()(),u.qb(12,0,null,null,4,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),u.qb(13,0,null,null,1,"button",[["class","btn btn-success"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.openLSE()&&u),u}),null,null)),(l()(),u.Kb(-1,null,["Go to Library Settings Editor"])),(l()(),u.qb(15,0,null,null,1,"button",[["class","btn btn-warning"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.dismiss("canceled")&&u),u}),null,null)),(l()(),u.Kb(-1,null,["Continue anyway"]))],null,null)}function Ol(l){return u.Mb(0,[u.Ib(671088640,1,{dialogContent:0}),(l()(),u.fb(0,[[1,2],["dialogContent",2]],null,0,null,Sl))],null,null)}var xl=e("Cfvw"),Dl=e("NXyV"),Bl=e("EY2u"),Pl=e("PqYM"),Kl=e("z6cu"),Al=e("BFxc"),Ll=e("CqXF"),jl=e("Kj3r"),Nl=e("MWGh");let Ml=(()=>{class l{constructor(l,n){this.auth=l,this.pcrud=n,this.hoursOfOperation=l=>this.pcrud.retrieve("aouhoo",this.auth.user().ws_ou()).pipe(Object(ll.a)(n=>{const e=n[this.evergreenStyleDow(l)+"_open"]().split(":"),u=n[this.evergreenStyleDow(l)+"_close"]().split(":");return Object(Z.a)({startOfDay:{hour:"00"===e[0]?9:+e[0],minute:+e[1],second:0},endOfDay:{hour:"00"===u[0]?17:+u[0],minute:+u[1],second:0}})})),this.resourceAvailabilityIcon=(l,n)=>{let e={icon:"event_busy",title:"All resources are reserved at this time"},u=0;for(const t in l.patrons)l.patrons[t]instanceof Array&&l.patrons[t].length&&(u+=1);return u<n&&(e={icon:"event_available",title:"Resources are available at this time"}),e},this.fetchRelevantResources=(l,n,e)=>{const u={type:l,owner:n};return e.length&&(u.id={in:{from:"bram",select:{bram:["resource"]},where:{value:e}}}),this.pcrud.search("brsrc",u,{order_by:"barcode ASC",flesh:1,flesh_fields:{brsrc:["attr_maps"]}})},this.momentizeDateRange=(l,n)=>({startTime:sl.tz([l.fromDate.year,l.fromDate.month-1,l.fromDate.day],n),endTime:sl.tz([l.toDate.year,l.toDate.month-1,l.toDate.day+1],n)}),this.momentizeDay=(l,n,e,u)=>({startTime:sl.tz([l.getFullYear(),l.getMonth(),l.getDate(),n.hour,n.minute],u),endTime:sl.tz([l.getFullYear(),l.getMonth(),l.getDate(),e.hour,e.minute],u)}),this.createBasicSchedule=(l,n)=>{const e=l.startTime.clone(),u=[];for(;e<l.endTime;)u.push({time:e.clone()}),e.add(n,"minutes");return u},this.fetchReservations=(l,n)=>this.pcrud.search("bresv",{"-or":{target_resource:n,current_resource:n},end_time:{">":l.startTime.toISOString()},start_time:{"<":l.endTime.toISOString()},return_time:null,cancel_time:null},{flesh:1,flesh_fields:{bresv:["current_resource","usr"]}}),this.addReservationToSchedule=(l,n,e,u)=>{for(let t=0;t<n.length;t++){const a=n[t].time,i=t+1<n.length?n[t+1].time:n[t].time.clone().add(e,"minutes");sl.tz(l.start_time(),u).isBefore(i)&&sl.tz(l.end_time(),u).isAfter(a)&&(n[t].patrons||(n[t].patrons={}),n[t].patrons[l.current_resource().barcode()]||(n[t].patrons[l.current_resource().barcode()]=[]),-1===n[t].patrons[l.current_resource().barcode()].findIndex(n=>n.patronId===l.usr().id())&&n[t].patrons[l.current_resource().barcode()].push({patronLabel:l.usr().usrname(),patronId:l.usr().id(),reservationId:l.id()}))}return n},this.evergreenStyleDow=l=>"dow_"+(l.getDay()+6)%7}}return l.ngInjectableDef=u.Qb({factory:function(){return new l(u.Rb(y.a),u.Rb(f.a))},token:l,providedIn:"root"}),l})();const El=l=>{const n=l.get("startOfDay").value,e=l.get("endOfDay").value;return null!==n&&null!==e&&n.hour<=e.hour&&!(n.hour===e.hour&&n.minute>=e.minute)?null:{startOfDayNotBeforeEndOfDay:!0}};class Vl{constructor(l,n,e,u,t,a,i,r,s,o){this.auth=l,this.calendar=n,this.format=e,this.net=u,this.pcrud=t,this.route=a,this.router=i,this.scheduleService=r,this.store=s,this.toast=o,this.attributes=[],this.multiday=!1,this.subscriptions=[],this.defaultGranularity=30,this.granularity=this.defaultGranularity,this.scheduleSource=new Nl.c,this.resources=[],this.fetchData=()=>{this.setGranularity(),this.scheduleSource.data=[];let l=this.scheduleService.fetchRelevantResources(this.resourceType.value?this.resourceType.value.id:null,this.owningLibraries,this.flattenedSelectedAttributes);this.resourceId?l=Object(xl.a)(this.resources):this.resources=[],l.pipe(Object(Q.a)(l=>{this.resources.push(l),this.resources.sort((l,n)=>l.barcode()>n.barcode()?1:n.barcode()>l.barcode()?-1:0)}),Object(Al.a)(1),Object(ll.a)(()=>{let l={startTime:sl(),endTime:sl()};return l=this.multiday?this.scheduleService.momentizeDateRange(this.idealDateRange,this.format.wsOrgTimezone):this.scheduleService.momentizeDay(this.idealDate,this.userStartOfDay,this.userEndOfDay,this.format.wsOrgTimezone),this.scheduleSource.data=this.scheduleService.createBasicSchedule(l,this.granularity),this.scheduleService.fetchReservations(l,this.resources.map(l=>l.id()))})).subscribe(l=>{this.scheduleSource.data=this.scheduleService.addReservationToSchedule(l,this.scheduleSource.data,this.granularity,this.format.wsOrgTimezone)},l=>{},()=>{this.cellTextGenerator={Time:l=>this.multiday?l.time.format("LT"):this.format.transform({value:l.time,datatype:"timestamp",datePlusTime:!0})},this.resources.forEach(l=>{this.cellTextGenerator[l.barcode()]=n=>n.patrons[l.barcode()]?n.patrons[l.barcode()].map(l=>l.patronLabel).join(", "):""})})},this.addDays=l=>{const n=new Date(this.idealDate);n.setDate(n.getDate()+l),this.criteria.patchValue({idealDate:n})},this.openReservationViewer=l=>{this.viewReservation.mode="view",this.viewReservation.recordId=l,this.viewReservation.open({size:"lg"})}}ngOnInit(){this.format.wsOrgTimezone||this.noTimezoneSetDialog.open();const l={fromDate:this.calendar.getToday(),toDate:this.calendar.getNext(this.calendar.getToday(),"d",10)};this.route.paramMap.pipe(Object(Q.a)(l=>{this.patronId=+l.get("patron_id"),this.resourceBarcode=l.get("resource_barcode")}),Object(ll.a)(l=>function(l,n=Bl.a,e=Bl.a){return Object(Dl.a)(()=>l()?n:e)}(()=>l.has("resource_barcode"),this.handleBarcodeFromUrl$(l.get("resource_barcode")),Object(Z.a)(l)))).subscribe({error(){console.warn("could not find a resource with this barcode")}}),this.reservationTypes=[{id:"single",name:"Single day reservation"},{id:"multi",name:"Multiple day reservation"}],this.criteria=new r.j({resourceBarcode:new r.h(this.resourceBarcode?this.resourceBarcode:"",[],l=>Object(Pl.a)(800).pipe(Object(ll.a)(()=>this.pcrud.search("brsrc",{barcode:l.value},{limit:1})),ul(),Object(Ll.a)(null),Object(bl.a)(()=>Object(Z.a)({resourceBarcode:"No resource found with that barcode"})))),resourceType:new r.h,startOfDay:new r.h({hour:9,minute:0,second:0}),endOfDay:new r.h({hour:17,minute:0,second:0}),idealDate:new r.h(new Date),idealDateRange:new r.h(l),reservationType:new r.h,owningLibrary:new r.h({primaryOrgId:this.auth.user().ws_ou(),includeDescendants:!0}),selectedAttributes:new r.e([])},[El]),this.criteria.get("resourceBarcode").valueChanges.pipe(Object(jl.a)(1500)).subscribe(l=>{this.resources=[],"INVALID"===this.criteria.get("resourceBarcode").status?this.toast.danger("No resource found with this barcode"):this.router.navigate(["/staff","booking","create_reservation","for_resource",l])}),this.subscriptions.push(this.resourceType.valueChanges.pipe(Object(ll.a)(l=>{for(this.resourceBarcode=null,this.resources=[],this.resourceId=null,this.attributes=[];this.selectedAttributes.length;)this.selectedAttributes.removeAt(0);return l.id?this.pcrud.search("bra",{resource_type:l.id},{order_by:"name ASC",flesh:1,flesh_fields:{bra:["valid_values"]}}).pipe(Object(Q.a)(l=>{this.attributes.push(l),this.selectedAttributes.push(new r.h)})):Object(Z.a)()})).subscribe(()=>this.fetchData())),this.criteria.get("reservationType").valueChanges.subscribe(l=>{this.multiday="multi"===l.id,this.store.setItem("eg.booking.create.multiday",this.multiday)}),this.subscriptions.push(this.owningLibraryFamily.valueChanges.subscribe(()=>this.resources=[])),this.subscriptions.push(this.criteria.valueChanges.subscribe(()=>this.fetchData())),this.store.getItem("eg.booking.create.multiday").then(l=>{l&&(this.multiday=l),this.criteria.patchValue({reservationType:this.multiday?this.reservationTypes[1]:this.reservationTypes[0]})}),this.setGranularity=()=>{this.multiday?this.granularity=1440:this.store.getItem("eg.booking.create.granularity").then(l=>{this.granularity=l||this.defaultGranularity})},this.criteria.get("idealDate").valueChanges.pipe(Object(ll.a)(l=>this.scheduleService.hoursOfOperation(l))).subscribe(l=>this.criteria.patchValue(l,{emitEvent:!1}),()=>{},()=>this.fetchData()),this.changeGranularity=l=>{this.granularity=l.id,this.store.setItem("eg.booking.create.granularity",l.id).then(()=>this.fetchData())},this.minuteStep=()=>this.granularity<60?this.granularity:this.defaultGranularity,this.resourceAvailabilityIcon=l=>this.scheduleService.resourceAvailabilityIcon(l,this.resources.length)}ngAfterViewInit(){this.fetchData(),this.openTheDialog=l=>{l&&l.length&&this.createDialog.setDefaultTimes(l.map(l=>l.time.clone()),this.granularity),this.subscriptions.push(this.createDialog.open({size:"lg"}).subscribe(()=>this.fetchData()))}}invalidMultidaySettings(){return this.multiday&&(!this.idealDateRange||null==this.idealDateRange.fromDate||null==this.idealDateRange.toDate)}handleBarcodeFromUrl$(l){return this.findResourceByBarcode$(l).pipe(Object(bl.a)(()=>this.handleBrsrcError$(l)),Object(Q.a)(l=>{l&&(this.resourceId=l.id(),this.criteria.patchValue({resourceType:{id:l.type()}},{emitEvent:!1}),this.resources=[l],this.details.select("select-resource"),this.fetchData())}))}findResourceByBarcode$(l){return this.pcrud.search("brsrc",{barcode:l},{limit:1}).pipe(ul())}handleBrsrcError$(l){return this.tryToMakeThisBookable$(l).pipe(Object(ll.a)(()=>this.findResourceByBarcode$(l)),Object(bl.a)(()=>(this.toast.danger("No resource found with this barcode"),this.resourceId=-1,Object(Kl.a)("could not find or create a resource"))))}tryToMakeThisBookable$(l){return this.pcrud.search("acp",{barcode:l},{limit:1}).pipe(ul(),Object(ll.a)(l=>this.net.request("open-ils.booking","open-ils.booking.resources.create_from_copies",this.auth.token(),[l.id()])),Object(bl.a)(()=>(this.toast.danger("Cannot make this barcode bookable"),Object(Kl.a)("Tried and failed to make that barcode bookable"))),Object(Q.a)(l=>{this.toast.info("Made this barcode bookable"),this.resourceId=l.brsrc[0][0]}))}get resourceType(){return this.criteria.get("resourceType")}get userStartOfDay(){return this.criteria.get("startOfDay").value}get userEndOfDay(){return this.criteria.get("endOfDay").value}get idealDate(){return this.criteria.get("idealDate").value}get idealDateRange(){return this.criteria.get("idealDateRange").value}get owningLibraryFamily(){return this.criteria.get("owningLibrary")}get owningLibraries(){return this.criteria.get("owningLibrary").value.orgIds?this.criteria.get("owningLibrary").value.orgIds:[this.criteria.get("owningLibrary").value.primaryOrgId]}get selectedAttributes(){return this.criteria.get("selectedAttributes")}get flattenedSelectedAttributes(){return this.selectedAttributes.value.filter(Boolean).map(l=>l.id)}ngOnDestroy(){this.subscriptions.forEach(l=>{l.unsubscribe()})}}var zl=u.ob({encapsulation:0,styles:["#ideal-resource-barcode[_ngcontent-%COMP%] {min-width: 300px;}"],data:{}});function Gl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,3,"option",[],null,null,null,null,null)),u.pb(1,147456,null,0,r.u,[u.k,u.C,[2,r.z]],{ngValue:[0,"ngValue"]},null),u.pb(2,147456,null,0,r.F,[u.k,u.C,[8,null]],{ngValue:[0,"ngValue"]},null),(l()(),u.Kb(3,null,["",""]))],(function(l,n){l(n,1,0,n.context.$implicit),l(n,2,0,n.context.$implicit)}),(function(l,n){l(n,3,0,n.context.$implicit.name)}))}function Fl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"eg-date-select",[["domId","ideal-reservation-date"],["formControlName","idealDate"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,s.b,s.a)),u.pb(1,114688,[["dateLimiter",4]],0,o.a,[],{domId:[0,"domId"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[o.a]),u.pb(3,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(5,16384,null,0,r.q,[[4,r.p]],null,null)],(function(l,n){l(n,1,0,"ideal-reservation-date"),l(n,3,0,"idealDate")}),(function(l,n){l(n,0,0,u.Cb(n,5).ngClassUntouched,u.Cb(n,5).ngClassTouched,u.Cb(n,5).ngClassPristine,u.Cb(n,5).ngClassDirty,u.Cb(n,5).ngClassValid,u.Cb(n,5).ngClassInvalid,u.Cb(n,5).ngClassPending)}))}function Hl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"eg-daterange-select",[["formControlName","idealDateRange"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,c.b,c.a)),u.pb(1,114688,null,0,b.a,[d.h],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[b.a]),u.pb(3,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(5,16384,null,0,r.q,[[4,r.p]],null,null)],(function(l,n){l(n,1,0),l(n,3,0,"idealDateRange")}),(function(l,n){l(n,0,0,u.Cb(n,5).ngClassUntouched,u.Cb(n,5).ngClassTouched,u.Cb(n,5).ngClassPristine,u.Cb(n,5).ngClassDirty,u.Cb(n,5).ngClassValid,u.Cb(n,5).ngClassInvalid,u.Cb(n,5).ngClassPending)}))}function Ul(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["dns"])),(l()(),u.qb(2,0,null,null,1,null,null,null,null,null,null,null)),(l()(),u.Kb(-1,null,["Choose resource by type"]))],null,null)}function $l(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,18,"div",[["class","row"],["ngbPanelContent",""]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,17,"div",[["class","col"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,9,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,1,"label",[["class","input-group-text"],["for","ideal-resource-type"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Search by resource type"])),(l()(),u.qb(6,0,null,null,5,"eg-combobox",[["domId","ideal-resource-type"],["formControlName","resourceType"],["idlClass","brt"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,p.b,p.a)),u.pb(7,114688,null,0,g.a,[u.k,h.a,m.a,f.a],{idlClass:[0,"idlClass"],asyncSupportsEmptyTermClick:[1,"asyncSupportsEmptyTermClick"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[g.a]),u.pb(9,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(11,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(12,0,null,null,6,"div",[["class","col"]],null,null,null,null,null)),(l()(),u.qb(13,0,null,null,5,"eg-org-family-select",[["formControlName","owningLibrary"],["labelText","Owning library"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,C.b,C.a)),u.pb(14,114688,null,0,v.a,[y.a,q.a],{labelText:[0,"labelText"],hideAncestorSelector:[1,"hideAncestorSelector"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[v.a]),u.pb(16,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(18,16384,null,0,r.q,[[4,r.p]],null,null)],(function(l,n){l(n,7,0,"brt",!0),l(n,9,0,"resourceType"),l(n,14,0,"Owning library",!0),l(n,16,0,"owningLibrary")}),(function(l,n){l(n,6,0,u.Cb(n,11).ngClassUntouched,u.Cb(n,11).ngClassTouched,u.Cb(n,11).ngClassPristine,u.Cb(n,11).ngClassDirty,u.Cb(n,11).ngClassValid,u.Cb(n,11).ngClassInvalid,u.Cb(n,11).ngClassPending),l(n,13,0,u.Cb(n,18).ngClassUntouched,u.Cb(n,18).ngClassTouched,u.Cb(n,18).ngClassPristine,u.Cb(n,18).ngClassDirty,u.Cb(n,18).ngClassValid,u.Cb(n,18).ngClassInvalid,u.Cb(n,18).ngClassPending)}))}function Jl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["assignment"])),(l()(),u.qb(2,0,null,null,1,null,null,null,null,null,null,null)),(l()(),u.Kb(-1,null,["Choose resource by barcode"]))],null,null)}function Xl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,11,"div",[["class","row"],["ngbPanelContent",""]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,10,"div",[["class","col"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,9,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,1,"label",[["class","input-group-text"],["for","ideal-resource-barcode"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Search by resource barcode"])),(l()(),u.qb(6,0,null,null,5,"input",[["class","form-control"],["formControlName","resourceBarcode"],["id","ideal-resource-barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,7)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,7).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,7)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,7)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(7,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(9,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(11,16384,null,0,r.q,[[4,r.p]],null,null)],(function(l,n){l(n,9,0,"resourceBarcode")}),(function(l,n){l(n,6,0,u.Cb(n,11).ngClassUntouched,u.Cb(n,11).ngClassTouched,u.Cb(n,11).ngClassPristine,u.Cb(n,11).ngClassDirty,u.Cb(n,11).ngClassValid,u.Cb(n,11).ngClassInvalid,u.Cb(n,11).ngClassPending)}))}function Wl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["filter_list"])),(l()(),u.qb(2,0,null,null,1,null,null,null,null,null,null,null)),(l()(),u.Kb(-1,null,["Limit by attributes"]))],null,null)}function Zl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-combobox-entry",[],null,null,null,_.b,_.a)),u.pb(1,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null)],(function(l,n){var e=n.context.$implicit.id(),u=n.context.$implicit.valid_value();l(n,1,0,e,u)}),null)}function Ql(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,12,"li",[["class","list-group-item"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,11,"span",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,2,"span",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,1,"label",[["class","input-group-text"]],[[8,"htmlFor",0]],null,null,null,null)),(l()(),u.Kb(4,null,["",""])),(l()(),u.qb(5,0,null,null,7,"eg-combobox",[],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,p.b,p.a)),u.pb(6,114688,null,0,g.a,[u.k,h.a,m.a,f.a],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[g.a]),u.pb(8,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(10,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,Zl)),u.pb(12,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){l(n,6,0),l(n,8,0,n.context.index);var e=n.context.$implicit.valid_values();l(n,12,0,e)}),(function(l,n){var e=u.ub(1,"attribute-",n.context.$implicit.id(),"");l(n,3,0,e);var t=n.context.$implicit.name();l(n,4,0,t),l(n,5,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending)}))}function Yl(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"ul",[["class","list-group list-group-flush"],["formArrayName","selectedAttributes"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,null,null)),u.pb(1,212992,null,0,r.f,[[3,r.c],[8,null],[8,null]],{name:[0,"name"]},null),u.Hb(2048,null,r.c,null,[r.f]),u.pb(3,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.fb(16777216,null,null,1,null,Ql)),u.pb(5,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=n.component;l(n,1,0,"selectedAttributes"),l(n,5,0,e.attributes)}),(function(l,n){l(n,0,0,u.Cb(n,3).ngClassUntouched,u.Cb(n,3).ngClassTouched,u.Cb(n,3).ngClassPristine,u.Cb(n,3).ngClassDirty,u.Cb(n,3).ngClassValid,u.Cb(n,3).ngClassInvalid,u.Cb(n,3).ngClassPending)}))}function ln(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["settings"])),(l()(),u.qb(2,0,null,null,1,null,null,null,null,null,null,null)),(l()(),u.Kb(-1,null,["Schedule settings"]))],null,null)}function nn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,5,"li",[["class","list-group-item"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,4,"div",[["class","alert alert-danger"],["role","alert"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,1,"span",[["aria-hidden","true"],["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["error"])),(l()(),u.qb(4,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Start time must be before end time"]))],null,null)}function en(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,38,"ul",[["class","list-group list-group-flush"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,10,"li",[["class","list-group-item"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,9,"span",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,2,"span",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,1,"label",[["class","input-group-text"],["for","start-time"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Start time"])),(l()(),u.qb(6,0,null,null,5,"ngb-timepicker",[["formControlName","startOfDay"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,i.l,i.g)),u.pb(7,573440,null,0,d.ib,[d.jb,d.hb,u.h,d.kb],{meridian:[0,"meridian"],minuteStep:[1,"minuteStep"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[d.ib]),u.pb(9,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(11,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(12,0,null,null,10,"li",[["class","list-group-item"]],null,null,null,null,null)),(l()(),u.qb(13,0,null,null,9,"span",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(14,0,null,null,2,"span",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(15,0,null,null,1,"label",[["class","input-group-text"],["for","end-time"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["End time"])),(l()(),u.qb(17,0,null,null,5,"ngb-timepicker",[["formControlName","endOfDay"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,i.l,i.g)),u.pb(18,573440,null,0,d.ib,[d.jb,d.hb,u.h,d.kb],{meridian:[0,"meridian"],minuteStep:[1,"minuteStep"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[d.ib]),u.pb(20,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(22,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,nn)),u.pb(24,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(25,0,null,null,13,"li",[["class","list-group-item"]],null,null,null,null,null)),(l()(),u.qb(26,0,null,null,12,"span",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(27,0,null,null,2,"span",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(28,0,null,null,1,"label",[["class","input-group-text"],["for","granularity"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Granularity"])),(l()(),u.qb(30,0,null,null,8,"eg-combobox",[],null,[[null,"onChange"]],(function(l,n,e){var u=!0;return"onChange"===n&&(u=!1!==l.component.changeGranularity(e)&&u),u}),p.b,p.a)),u.Hb(5120,null,r.o,(function(l){return[l]}),[g.a]),u.pb(32,114688,null,0,g.a,[u.k,h.a,m.a,f.a],{startId:[0,"startId"]},{onChange:"onChange"}),(l()(),u.qb(33,0,null,null,1,"eg-combobox-entry",[["entryLabel","15 minutes"]],null,null,null,_.b,_.a)),u.pb(34,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null),(l()(),u.qb(35,0,null,null,1,"eg-combobox-entry",[["entryLabel","30 minutes"]],null,null,null,_.b,_.a)),u.pb(36,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null),(l()(),u.qb(37,0,null,null,1,"eg-combobox-entry",[["entryLabel","60 minutes"]],null,null,null,_.b,_.a)),u.pb(38,114688,null,0,k.a,[g.a],{entryId:[0,"entryId"],entryLabel:[1,"entryLabel"]},null)],(function(l,n){var e=n.component;l(n,7,0,!0,e.minuteStep()),l(n,9,0,"startOfDay"),l(n,18,0,!0,e.minuteStep()),l(n,20,0,"endOfDay"),l(n,24,0,e.criteria.errors&&e.criteria.errors.startOfDayNotBeforeEndOfDay),l(n,32,0,e.granularity?e.granularity:30),l(n,34,0,15,"15 minutes"),l(n,36,0,30,"30 minutes"),l(n,38,0,60,"60 minutes")}),(function(l,n){l(n,6,0,u.Cb(n,11).ngClassUntouched,u.Cb(n,11).ngClassTouched,u.Cb(n,11).ngClassPristine,u.Cb(n,11).ngClassDirty,u.Cb(n,11).ngClassValid,u.Cb(n,11).ngClassInvalid,u.Cb(n,11).ngClassPending),l(n,17,0,u.Cb(n,22).ngClassUntouched,u.Cb(n,22).ngClassTouched,u.Cb(n,22).ngClassPristine,u.Cb(n,22).ngClassDirty,u.Cb(n,22).ngClassValid,u.Cb(n,22).ngClassInvalid,u.Cb(n,22).ngClassPending)}))}function un(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,13,"div",[["class","row"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,4,"button",[["class","btn btn-info col-sm-2 offset-sm-3"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.addDays(-1)&&u),u}),null,null)),(l()(),u.qb(2,0,null,null,1,"span",[["class","material-icons mat-icon-in-button"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["keyboard_arrow_left"])),(l()(),u.qb(4,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Previous day"])),(l()(),u.qb(6,0,null,null,2,"h2",[["class","col-sm-2 text-center"]],null,null,null,null,null)),(l()(),u.Kb(7,null,["",""])),u.Gb(8,2),(l()(),u.qb(9,0,null,null,4,"button",[["class","btn btn-info col-sm-2"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.addDays(1)&&u),u}),null,null)),(l()(),u.qb(10,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Next day"])),(l()(),u.qb(12,0,null,null,1,"span",[["class","material-icons mat-icon-in-button"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["keyboard_arrow_right"]))],null,(function(l,n){var e=n.component,t=u.Lb(n,7,0,l(n,8,0,u.Cb(n.parent.parent,0),e.idealDate,"timestamp"));l(n,7,0,t)}))}function tn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-grid-column",[],null,null,null,T.b,T.a)),u.pb(1,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],cellTemplate:[2,"cellTemplate"],disableTooltip:[3,"disableTooltip"]},null)],(function(l,n){var e=n.context.$implicit.barcode(),t=u.ub(1,"",n.context.$implicit.barcode(),"");l(n,1,0,e,t,u.Cb(n.parent.parent,83),!0)}),null)}function an(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,13,null,null,null,null,null,null,null)),(l()(),u.qb(1,0,null,null,0,"hr",[],null,null,null,null,null)),(l()(),u.fb(16777216,null,null,1,null,un)),u.pb(3,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(4,0,null,null,9,"eg-grid",[["persistKey","disabled"]],null,[[null,"onRowActivate"]],(function(l,n,e){var u=!0;return"onRowActivate"===n&&(u=!1!==l.component.openTheDialog([e])&&u),u}),S.b,S.a)),u.pb(5,4440064,[[5,4],["scheduleGrid",4]],0,R.a,[m.a,q.a,O.a,x.a],{dataSource:[0,"dataSource"],sortable:[1,"sortable"],persistKey:[2,"persistKey"],rowFlairIsEnabled:[3,"rowFlairIsEnabled"],rowFlairCallback:[4,"rowFlairCallback"],disablePaging:[5,"disablePaging"],cellTextGenerator:[6,"cellTextGenerator"]},{onRowActivate:"onRowActivate"}),(l()(),u.qb(6,0,null,null,1,"eg-grid-toolbar-button",[["label","Create Reservation"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.openTheDialog(e)&&u),u}),D.b,D.a)),u.pb(7,114688,null,0,B.a,[R.a],{label:[0,"label"]},{onClick:"onClick"}),(l()(),u.qb(8,0,null,null,1,"eg-grid-toolbar-action",[["label","Create Reservation"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.openTheDialog(e)&&u),u}),P.b,P.a)),u.pb(9,114688,null,0,K.a,[R.a],{label:[0,"label"]},{onClick:"onClick"}),(l()(),u.qb(10,0,null,null,1,"eg-grid-column",[["name","Time"],["path","time"]],null,null,null,T.b,T.a)),u.pb(11,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],index:[2,"index"],cellTemplate:[3,"cellTemplate"]},null),(l()(),u.fb(16777216,null,null,1,null,tn)),u.pb(13,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=n.component;l(n,3,0,e.idealDate&&!e.multiday),l(n,5,0,e.scheduleSource,!1,"disabled",!0,e.resourceAvailabilityIcon,!0,e.cellTextGenerator),l(n,7,0,"Create Reservation"),l(n,9,0,"Create Reservation"),l(n,11,0,"Time","time",!0,u.Cb(n.parent,84)),l(n,13,0,e.resources)}),null)}function rn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,6,"div",[["class","text-sm-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,[" There are no bookable resource that match your criteria. Would you like to create "])),(l()(),u.qb(2,0,null,null,3,"a",[],[[1,"target",0],[8,"href",4]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==u.Cb(l,3).onClick(e.button,e.ctrlKey,e.metaKey,e.shiftKey)&&t),t}),null,null)),u.pb(3,671744,null,0,A.n,[A.l,A.a,I.m],{routerLink:[0,"routerLink"]},null),u.Db(4,4),(l()(),u.Kb(-1,null,["some new resources"])),(l()(),u.Kb(-1,null,["?\n"]))],(function(l,n){var e=l(n,4,0,"/staff","admin","booking","splash");l(n,3,0,e)}),(function(l,n){l(n,2,0,u.Cb(n,3).target,u.Cb(n,3).href)}))}function sn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,2,"li",[],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"button",[["class","btn btn-info"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.openReservationViewer(l.context.$implicit.reservationId)&&u),u}),null,null)),(l()(),u.Kb(2,null,[" "," "]))],null,(function(l,n){l(n,2,0,n.context.$implicit.patronLabel)}))}function on(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),u.qb(1,0,null,null,2,"ul",[["class","list-unstyled"]],null,null,null,null,null)),(l()(),u.fb(16777216,null,null,1,null,sn)),u.pb(3,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){l(n,3,0,n.parent.context.row.patrons[n.parent.context.col.name])}),null)}function cn(l){return u.Mb(0,[(l()(),u.fb(16777216,null,null,1,null,on)),u.pb(1,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(0,null,null,0))],(function(l,n){l(n,1,0,n.context.row.patrons&&n.context.row.patrons[n.context.col.name])}),null)}function bn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(l()(),u.Kb(1,null,[" "," "]))],null,(function(l,n){var e=n.parent.context.row.time.format("LT");l(n,1,0,e)}))}function dn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),u.Kb(1,null,[" "," "])),u.Gb(2,2)],null,(function(l,n){var e=u.Lb(n,1,0,l(n,2,0,u.Cb(n.parent.parent,0),n.parent.context.row.time,"timestamp"));l(n,1,0,e)}))}function pn(l){return u.Mb(0,[(l()(),u.fb(16777216,null,null,1,null,bn)),u.pb(1,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,dn)),u.pb(3,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,1,0,!e.multiday),l(n,3,0,e.multiday)}),null)}function gn(l){return u.Mb(0,[u.Eb(0,x.b,[x.a]),u.Ib(402653184,1,{createDialog:0}),u.Ib(402653184,2,{details:0}),u.Ib(402653184,3,{noTimezoneSetDialog:0}),u.Ib(402653184,4,{viewReservation:0}),u.Ib(671088640,5,{scheduleGrids:1}),(l()(),u.qb(6,0,null,null,1,"eg-staff-banner",[["bannerText","Create Reservation"]],null,null,null,L.b,L.a)),u.pb(7,49152,null,0,j.a,[],{bannerText:[0,"bannerText"]},null),(l()(),u.qb(8,0,null,null,1,"eg-title",[["prefix","Booking"],["suffix","Create Reservation"]],null,null,null,N.b,N.a)),u.pb(9,4243456,null,0,M.a,[E.h],{prefix:[0,"prefix"],suffix:[1,"suffix"]},null),(l()(),u.qb(10,0,null,null,66,"form",[["class","row"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,12).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,12).onReset()&&t),t}),null,null)),u.pb(11,16384,null,0,r.G,[],null,null),u.pb(12,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(14,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(15,0,null,null,23,"div",[["class","col-sm-6"]],null,null,null,null,null)),(l()(),u.qb(16,0,null,null,22,"div",[["class","row"]],null,null,null,null,null)),(l()(),u.qb(17,0,null,null,12,"div",[["class","col"]],null,null,null,null,null)),(l()(),u.qb(18,0,null,null,11,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(19,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(20,0,null,null,1,"label",[["class","input-group-text"],["for","ideal-reservation-type"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Reservation type"])),(l()(),u.qb(22,0,null,null,7,"select",[["class","form-control"],["formControlName","reservationType"],["id","ideal-reservation-type"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],(function(l,n,e){var t=!0;return"change"===n&&(t=!1!==u.Cb(l,23).onChange(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,23).onTouched()&&t),t}),null,null)),u.pb(23,16384,null,0,r.z,[u.C,u.k],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.z]),u.pb(25,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(27,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,Gl)),u.pb(29,278528,null,0,I.o,[u.N,u.K,u.r],{ngForOf:[0,"ngForOf"]},null),(l()(),u.qb(30,0,null,null,8,"div",[["class","col"]],null,null,null,null,null)),(l()(),u.qb(31,0,null,null,7,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(32,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(33,0,null,null,1,"label",[["class","input-group-text"],["for","ideal-reservation-date"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Reservation date"])),(l()(),u.fb(16777216,null,null,1,null,Fl)),u.pb(36,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,Hl)),u.pb(38,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(39,0,null,null,37,"div",[["class","card col-sm-6"]],null,null,null,null,null)),(l()(),u.qb(40,0,null,null,1,"h2",[["class","card-header"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Reservation details"])),(l()(),u.qb(42,0,null,null,34,"ngb-tabset",[],null,null,null,i.k,i.f)),u.pb(43,2146304,[[2,4],["details",4]],1,d.eb,[d.fb],null,null),u.Ib(603979776,6,{tabs:1}),(l()(),u.qb(45,0,null,null,7,"ngb-tab",[["id","select-resource-type"]],null,null,null,null,null)),u.pb(46,2113536,[[6,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,7,{titleTpls:1}),u.Ib(603979776,8,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,Ul)),u.pb(50,16384,[[7,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,$l)),u.pb(52,16384,[[8,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(53,0,null,null,7,"ngb-tab",[["id","select-resource"]],null,null,null,null,null)),u.pb(54,2113536,[[6,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,9,{titleTpls:1}),u.Ib(603979776,10,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,Jl)),u.pb(58,16384,[[9,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,Xl)),u.pb(60,16384,[[10,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(61,0,null,null,7,"ngb-tab",[["id","attributes"]],null,null,null,null,null)),u.pb(62,2113536,[[6,4]],2,d.bb,[],{id:[0,"id"],disabled:[1,"disabled"]},null),u.Ib(603979776,11,{titleTpls:1}),u.Ib(603979776,12,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,Wl)),u.pb(66,16384,[[11,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,Yl)),u.pb(68,16384,[[12,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(69,0,null,null,7,"ngb-tab",[["id","display-settings"]],null,null,null,null,null)),u.pb(70,2113536,[[6,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,13,{titleTpls:1}),u.Ib(603979776,14,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,ln)),u.pb(74,16384,[[13,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,en)),u.pb(76,16384,[[14,4]],0,d.cb,[u.K],null,null),(l()(),u.fb(16777216,null,null,1,null,an)),u.pb(78,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,rn)),u.pb(80,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(81,0,null,null,1,"eg-create-reservation-dialog",[],null,[[null,"onComplete"]],(function(l,n,e){var u=!0;return"onComplete"===n&&(u=!1!==l.component.fetchData()&&u),u}),kl,ml)),u.pb(82,114688,[[1,4],["createDialog",4]],0,hl,[y.a,x.a,il.b,q.a,f.a,A.l,d.E,dl,pl.a],{targetResource:[0,"targetResource"],targetResourceBarcode:[1,"targetResourceBarcode"],targetResourceType:[2,"targetResourceType"],patronId:[3,"patronId"],attributes:[4,"attributes"],resources:[5,"resources"]},{onComplete:"onComplete"}),(l()(),u.fb(0,[["reservationsTemplate",2]],null,0,null,cn)),(l()(),u.fb(0,[["timeTemplate",2]],null,0,null,pn)),(l()(),u.qb(85,0,null,null,1,"eg-fm-record-editor",[["datetimeFields","start_time,end_time"],["hiddenFields","xact_start,xact_finish,cancel_time,booking_interval"],["idlClass","bresv"]],null,null,null,Il.b,Il.a)),u.pb(86,114688,[[4,4],["viewReservation",4]],0,Tl.a,[d.E,m.a,y.a,pl.a,x.a,f.a],{idlClass:[0,"idlClass"],hiddenFields:[1,"hiddenFields"],datetimeFields:[2,"datetimeFields"]},null),(l()(),u.qb(87,0,null,null,1,"eg-no-timezone-set-dialog",[],null,null,null,Ol,Rl)),u.pb(88,114688,[[3,4],["noTimezoneSetDialog",4]],0,wl,[d.E],null,null)],(function(l,n){var e=n.component;l(n,7,0,"Create Reservation"),l(n,9,0,"Booking","Create Reservation"),l(n,12,0,e.criteria),l(n,25,0,"reservationType"),l(n,29,0,e.reservationTypes),l(n,36,0,!e.multiday),l(n,38,0,e.multiday),l(n,46,0,"select-resource-type"),l(n,54,0,"select-resource"),l(n,62,0,"attributes",0===e.attributes.length),l(n,70,0,"display-settings"),l(n,78,0,e.resources.length),l(n,80,0,e.resourceType.value&&!e.resources.length),l(n,82,0,e.resourceId,e.resourceBarcode,e.resourceType.value,e.patronId,e.flattenedSelectedAttributes,e.resources),l(n,86,0,"bresv","xact_start,xact_finish,cancel_time,booking_interval","start_time,end_time"),l(n,88,0)}),(function(l,n){l(n,10,0,u.Cb(n,14).ngClassUntouched,u.Cb(n,14).ngClassTouched,u.Cb(n,14).ngClassPristine,u.Cb(n,14).ngClassDirty,u.Cb(n,14).ngClassValid,u.Cb(n,14).ngClassInvalid,u.Cb(n,14).ngClassPending),l(n,22,0,u.Cb(n,27).ngClassUntouched,u.Cb(n,27).ngClassTouched,u.Cb(n,27).ngClassPristine,u.Cb(n,27).ngClassDirty,u.Cb(n,27).ngClassValid,u.Cb(n,27).ngClassInvalid,u.Cb(n,27).ngClassPending)}))}function hn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"ng-component",[],null,null,null,gn,zl)),u.pb(1,4440064,null,0,Vl,[y.a,d.h,x.a,il.b,f.a,A.a,A.l,Ml,O.a,pl.a],null,null)],(function(l,n){l(n,1,0)}),null)}var mn=u.mb("ng-component",Vl,hn,{},{},[]),fn=e("6rhm"),Cn=e("36iw");class vn{constructor(l,n,e){this.auth=l,this.net=n,this.toast=e,this.onSuccessfulCancel=new u.m}open(l){this.reservations=l,this.cancelReservationDialog.open().pipe(Object(ll.a)(()=>this.net.request("open-ils.booking","open-ils.booking.reservations.cancel",this.auth.token(),l))).subscribe(l=>{l.textcode?this.toast.danger("Could not cancel reservation"):(this.toast.success("Reservation successfully canceled"),this.onSuccessfulCancel.emit())})}}var yn=u.ob({encapsulation:2,styles:[],data:{}});function qn(l){return u.Mb(0,[(l()(),u.Kb(-1,null,["this reservation"]))],null,null)}function _n(l){return u.Mb(0,[(l()(),u.Kb(0,null,["these "," reservations"]))],null,(function(l,n){l(n,0,0,n.component.reservations.length)}))}function kn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,8,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,[" Are you sure you want to cancel "])),(l()(),u.qb(2,0,null,null,5,null,null,null,null,null,null,null)),u.pb(3,16384,null,0,I.s,[I.r],{ngPlural:[0,"ngPlural"]},null),(l()(),u.fb(16777216,null,null,1,null,qn)),u.pb(5,16384,null,0,I.t,[[8,"=1"],u.K,u.N,I.s],null,null),(l()(),u.fb(16777216,null,null,1,null,_n)),u.pb(7,16384,null,0,I.t,[[8,"other"],u.K,u.N,I.s],null,null),(l()(),u.Kb(-1,null,["? "]))],(function(l,n){l(n,3,0,n.component.reservations.length)}),null)}function In(l){return u.Mb(0,[u.Ib(402653184,1,{cancelReservationDialog:0}),(l()(),u.qb(1,0,null,null,1,"eg-confirm-dialog",[["dialogTitle","Confirm Cancelation"]],null,null,null,fn.b,fn.a)),u.pb(2,114688,[[1,4],["confirmCancelReservationDialog",4]],0,Cn.a,[d.E],{dialogTitle:[0,"dialogTitle"],dialogBodyTemplate:[1,"dialogBodyTemplate"]},null),(l()(),u.fb(0,[["confirmMessage",2]],null,0,null,kn))],(function(l,n){l(n,2,0,"Confirm Cancelation",u.Cb(n,3))}),null)}var Tn=e("5+tZ");let wn=(()=>{class l{constructor(l,n){this.pcrud=l,this.router=n,this.manageReservationsByResource=l=>{this.router.navigate(["/staff","booking","manage_reservations","by_resource",l])},this.viewItemStatus=l=>{this.pcrud.search("acp",{barcode:l},{limit:1}).subscribe(l=>{window.open("/eg/staff/cat/item/"+l.id())})},this.notOneUniqueSelected=l=>1!==new Set(l).size}}return l.ngInjectableDef=u.Qb({factory:function(){return new l(u.Rb(f.a),u.Rb(A.l))},token:l,providedIn:"root"}),l})();class Rn{constructor(l,n,e,t,a,i,r,s){this.auth=l,this.format=n,this.pcrud=e,this.router=t,this.toast=a,this.net=i,this.org=r,this.actions=s,this.onlyCaptured=!1,this.onPickup=new u.m,this.onReturn=new u.m,this.enrichRow$=l=>Object(xl.a)(this.org.settings("lib.timezone",l.pickup_lib().id())).pipe(Object(ll.a)(n=>(l.length=sl(l.end_time()).from(sl(l.start_time()),!0),l.timezone=n["lib.timezone"],Object(Z.a)(l))))}ngOnInit(){this.format.wsOrgTimezone||this.noTimezoneSetDialog.open(),this.gridSource=new Nl.c,this.gridSource.getRows=(l,n)=>{const e={},u={usr:this.patron?this.patron:{">":0},target_resource_type:this.resourceType?this.resourceType:{">":0},cancel_time:null,xact_finish:null};return this.resourceBarcode&&(u.current_resource={in:{from:"brsrc",select:{brsrc:["id"]},where:{barcode:this.resourceBarcode}}}),this.pickupLibIds&&(u.pickup_lib=this.pickupLibIds),this.onlyCaptured&&(u.capture_time={"!=":null}),this.status?"pickupReady"===this.status?(u.pickup_time=null,u.start_time={"!=":null}):"pickedUp"===this.status||"returnReady"===this.status?(u.pickup_time={"!=":null},u.return_time=null):"returnedToday"===this.status&&(u.return_time={">":sl().startOf("day").toISOString()}):u.return_time=null,n.length&&(e.bresv=n[0].name+" "+n[0].dir),this.pcrud.search("bresv",u,{order_by:e,limit:l.limit,offset:l.offset,flesh:2,flesh_fields:{bresv:["usr","capture_staff","target_resource","target_resource_type","current_resource","request_lib","pickup_lib"],au:["card"]}}).pipe(Object(Tn.a)(l=>this.enrichRow$(l)))},this.editDialog.mode="update",this.editSelected=l=>{const n=e=>{e&&this.showEditDialog(e).then(()=>n(l.shift()))};n(l.shift())},this.cancelSelected=l=>{this.cancelReservationDialog.open(l.map(l=>l.id()))},this.viewByResource=l=>{this.actions.manageReservationsByResource(l[0].current_resource().barcode())},this.viewByPatron=l=>{const n=l.map(l=>l.usr().id());this.router.navigate(["/staff","booking","manage_reservations","by_patron",n[0]])},this.viewItemStatus=l=>{this.actions.viewItemStatus(l[0].current_resource().barcode())},this.viewPatronRecord=l=>{const n=l.map(l=>l.usr().id());window.open("/eg/staff/circ/patron/"+n[0]+"/checkout")},this.noSelectedRows=l=>0===l.length,this.notOnePatronSelected=l=>this.actions.notOneUniqueSelected(l.map(l=>l.usr().id())),this.notOneResourceSelected=l=>this.actions.notOneUniqueSelected(l.map(l=>{if(l.current_resource())return l.current_resource().id()})),this.notOneCatalogedItemSelected=l=>this.actions.notOneUniqueSelected(l.filter(l=>l.current_resource()&&"t"===l.target_resource_type().catalog_item()).map(l=>l.current_resource().id())),this.cancelNotAppropriate=l=>this.noSelectedRows(l)||["pickedUp","returnReady","returnedToday"].includes(this.status),this.pickupNotAppropriate=l=>this.noSelectedRows(l)||"pickupReady"!==this.status,this.editNotAppropriate=l=>this.noSelectedRows(l)||"returnedToday"===this.status,this.returnNotAppropriate=l=>!!this.noSelectedRows(l)||!(!this.status||"pickupReady"!==this.status)||(l.forEach(l=>{if(null==l.pickup_time()||l.return_time())return!0}),!1),this.reloadGrid=()=>{this.grid.reload()},this.pickupSelected=l=>{const n=e=>{e&&this.pickupResource(e).subscribe(()=>n(l.shift()))};n(l.shift())},this.returnSelected=l=>{const n=e=>{e&&this.returnResource(e).subscribe(()=>n(l.shift()))};n(l.shift())},this.pickupResource=l=>this.net.request("open-ils.circ","open-ils.circ.reservation.pickup",this.auth.token(),{patron_barcode:l.usr().card().barcode(),reservation:l}).pipe(Object(Q.a)(()=>{this.onPickup.emit(l),this.grid.reload()})),this.returnResource=l=>this.net.request("open-ils.circ","open-ils.circ.reservation.return",this.auth.token(),{patron_barcode:this.patronBarcode,reservation:l}).pipe(Object(Q.a)(()=>{this.onReturn.emit(l),this.grid.reload()})),this.listReadOnlyFields=()=>{let l="usr,xact_start,request_time,capture_time,pickup_time,return_time,capture_staff,target_resource_type,email_notify,current_resource,target_resource,unrecovered,request_lib,pickup_lib,fine_interval,fine_amount,max_fine";return this.status&&"pickupReady"!==this.status&&(l+=",start_time"),this.status&&"returnedToday"===this.status&&(l+=",end_time"),l},this.handleRowActivate=l=>{this.status?"returnReady"===this.status?this.returnResource(l).subscribe():"pickupReady"===this.status?this.pickupResource(l).subscribe():"returnedToday"===this.status?this.toast.warning("Cannot edit this reservation"):this.showEditDialog(l):this.showEditDialog(l)},this.redirectToCreate=()=>{this.router.navigate(["/staff","booking","create_reservation"])}}ngOnChanges(){this.reloadGrid()}showEditDialog(l){return this.editDialog.recordId=l.id(),this.editDialog.timezone=l.timezone,new Promise((l,n)=>{this.editDialog.open({size:"lg"}).subscribe(n=>{this.toast.success("Reservation successfully updated"),this.grid.reload(),l(n)},l=>{})})}filterByResourceBarcode(l){this.router.navigate(["/staff","booking","manage_reservations","by_resource",l])}momentizeIsoString(l,n){return this.format.momentizeIsoString(l,n)}}var Sn=u.ob({encapsulation:2,styles:[],data:{}});function On(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-grid-toolbar-button",[["label","Create New Reservation"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.redirectToCreate(e)&&u),u}),D.b,D.a)),u.pb(1,114688,null,0,B.a,[R.a],{label:[0,"label"]},{onClick:"onClick"})],(function(l,n){l(n,1,0,"Create New Reservation")}),null)}function xn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-grid-toolbar-button",[["label","Pick Up Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.pickupSelected(e)&&u),u}),D.b,D.a)),u.pb(1,114688,null,0,B.a,[R.a],{label:[0,"label"],disabled:[1,"disabled"]},{onClick:"onClick"})],(function(l,n){l(n,1,0,"Pick Up Selected",!u.Cb(n.parent,5).context.getSelectedRows().length)}),null)}function Dn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-grid-toolbar-button",[["label","Return Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.returnSelected(e)&&u),u}),D.b,D.a)),u.pb(1,114688,null,0,B.a,[R.a],{label:[0,"label"],disabled:[1,"disabled"]},{onClick:"onClick"})],(function(l,n){l(n,1,0,"Return Selected",!u.Cb(n.parent,5).context.getSelectedRows().length)}),null)}function Bn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,3,"eg-datetime-select",[["domId","endTime"]],null,[[null,"onChangeAsIso"]],(function(l,n,e){var u=!0;return"onChangeAsIso"===n&&(u=!1!==l.context.record[l.context.field.name](e)&&u),u}),V.b,V.a)),u.Hb(5120,null,r.n,(function(l){return[l]}),[cl]),u.pb(2,114688,null,0,z.a,[x.a,G.a,[8,null]],{domId:[0,"domId"],initialIso:[1,"initialIso"],showTZ:[2,"showTZ"],timezone:[3,"timezone"],readOnly:[4,"readOnly"]},{onChangeAsIso:"onChangeAsIso"}),u.pb(3,16384,null,0,cl,[],{notBeforeMoment:[0,"notBeforeMoment"]},null)],(function(l,n){var e=n.component,t=u.ub(1,"",n.context.record[n.context.field.name](),"");l(n,2,0,"endTime",t,u.Cb(n.parent,81).timezone,u.Cb(n.parent,81).timezone,n.context.field.readOnly);var a=e.momentizeIsoString(n.context.record.start_time(),u.Cb(n.parent,81).timezone);l(n,3,0,a)}),null)}function Pn(l){return u.Mb(0,[u.Ib(402653184,1,{grid:0}),u.Ib(402653184,2,{editDialog:0}),u.Ib(402653184,3,{cancelReservationDialog:0}),u.Ib(402653184,4,{noTimezoneSetDialog:0}),(l()(),u.qb(4,0,null,null,75,"eg-grid",[],null,[[null,"onRowActivate"]],(function(l,n,e){var u=!0;return"onRowActivate"===n&&(u=!1!==l.component.handleRowActivate(e)&&u),u}),S.b,S.a)),u.pb(5,4440064,[[1,4],["grid",4]],0,R.a,[m.a,q.a,O.a,x.a],{dataSource:[0,"dataSource"],sortable:[1,"sortable"],useLocalSort:[2,"useLocalSort"],persistKey:[3,"persistKey"]},{onRowActivate:"onRowActivate"}),(l()(),u.qb(6,0,null,null,1,"eg-grid-toolbar-action",[["label","Edit Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.editSelected(e)&&u),u}),P.b,P.a)),u.pb(7,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(8,0,null,null,1,"eg-grid-toolbar-action",[["label","Cancel Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.cancelSelected(e)&&u),u}),P.b,P.a)),u.pb(9,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(10,0,null,null,1,"eg-grid-toolbar-action",[["label","Pick Up Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.pickupSelected(e)&&u),u}),P.b,P.a)),u.pb(11,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(12,0,null,null,1,"eg-grid-toolbar-action",[["label","Return Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.returnSelected(e)&&u),u}),P.b,P.a)),u.pb(13,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(14,0,null,null,1,"eg-grid-toolbar-action",[["label","View Patron Record"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewPatronRecord(e)&&u),u}),P.b,P.a)),u.pb(15,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(16,0,null,null,1,"eg-grid-toolbar-action",[["label","View Reservations for This Patron"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewByPatron(e)&&u),u}),P.b,P.a)),u.pb(17,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(18,0,null,null,1,"eg-grid-toolbar-action",[["label","View Item Status"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewItemStatus(e)&&u),u}),P.b,P.a)),u.pb(19,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(20,0,null,null,1,"eg-grid-toolbar-action",[["label","View Reservations for This Resource"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewByResource(e)&&u),u}),P.b,P.a)),u.pb(21,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.fb(16777216,null,null,1,null,On)),u.pb(23,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,xn)),u.pb(25,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(16777216,null,null,1,null,Dn)),u.pb(27,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(28,0,null,null,1,"eg-grid-column",[["label","ID"],["name","id"],["path","id"]],null,null,null,T.b,T.a)),u.pb(29,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],index:[3,"index"],hidden:[4,"hidden"]},null),(l()(),u.qb(30,0,null,null,1,"eg-grid-column",[["label","Patron username"],["path","usr.usrname"]],null,null,null,T.b,T.a)),u.pb(31,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"]},null),(l()(),u.qb(32,0,null,null,1,"eg-grid-column",[["label","Patron barcode"],["path","usr.card.barcode"]],null,null,null,T.b,T.a)),u.pb(33,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(34,0,null,null,1,"eg-grid-column",[["label","Patron first name"],["path","usr.first_given_name"]],null,null,null,T.b,T.a)),u.pb(35,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(36,0,null,null,1,"eg-grid-column",[["label","Patron middle name"],["path","usr.second_given_name"]],null,null,null,T.b,T.a)),u.pb(37,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"]},null),(l()(),u.qb(38,0,null,null,1,"eg-grid-column",[["label","Patron family name"],["path","usr.family_name"]],null,null,null,T.b,T.a)),u.pb(39,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(40,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Start Time"],["name","start_time"],["path","start_time"]],null,null,null,T.b,T.a)),u.pb(41,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],datatype:[3,"datatype"],datePlusTime:[4,"datePlusTime"]},null),(l()(),u.qb(42,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","End Time"],["name","end_time"],["path","end_time"]],null,null,null,T.b,T.a)),u.pb(43,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],datatype:[3,"datatype"],datePlusTime:[4,"datePlusTime"]},null),(l()(),u.qb(44,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Request Time"],["name","request_time"],["path","request_time"]],null,null,null,T.b,T.a)),u.pb(45,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],datatype:[3,"datatype"],datePlusTime:[4,"datePlusTime"]},null),(l()(),u.qb(46,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Capture Time"],["name","capture_time"],["path","capture_time"]],null,null,null,T.b,T.a)),u.pb(47,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],datatype:[3,"datatype"],datePlusTime:[4,"datePlusTime"]},null),(l()(),u.qb(48,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Pickup Time"],["name","pickup_time"],["path","pickup_time"]],null,null,null,T.b,T.a)),u.pb(49,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],datatype:[3,"datatype"],datePlusTime:[4,"datePlusTime"]},null),(l()(),u.qb(50,0,null,null,1,"eg-grid-column",[["datatype","bool"],["label","Email notify"],["path","email_notify"]],null,null,null,T.b,T.a)),u.pb(51,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"],datatype:[3,"datatype"]},null),(l()(),u.qb(52,0,null,null,1,"eg-grid-column",[["datatype","bool"],["path","unrecovered"]],null,null,null,T.b,T.a)),u.pb(53,114688,null,0,w.a,[R.a],{path:[0,"path"],hidden:[1,"hidden"],datatype:[2,"datatype"]},null),(l()(),u.qb(54,0,null,null,1,"eg-grid-column",[["datatype","money"],["label","Billing total"],["path","billing_total"]],null,null,null,T.b,T.a)),u.pb(55,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],datatype:[2,"datatype"]},null),(l()(),u.qb(56,0,null,null,1,"eg-grid-column",[["datatype","money"],["label","Payment total"],["path","payment_total"]],null,null,null,T.b,T.a)),u.pb(57,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],datatype:[2,"datatype"]},null),(l()(),u.qb(58,0,null,null,1,"eg-grid-column",[["label","Booking interval"],["path","booking_interval"]],null,null,null,T.b,T.a)),u.pb(59,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"]},null),(l()(),u.qb(60,0,null,null,1,"eg-grid-column",[["label","Fine interval"],["path","fine_interval"]],null,null,null,T.b,T.a)),u.pb(61,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"]},null),(l()(),u.qb(62,0,null,null,1,"eg-grid-column",[["datatype","money"],["label","Fine amount"],["path","fine_amount"]],null,null,null,T.b,T.a)),u.pb(63,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"],datatype:[3,"datatype"]},null),(l()(),u.qb(64,0,null,null,1,"eg-grid-column",[["datatype","money"],["label","Maximum fine"],["path","max_fine"]],null,null,null,T.b,T.a)),u.pb(65,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],hidden:[2,"hidden"],datatype:[3,"datatype"]},null),(l()(),u.qb(66,0,null,null,1,"eg-grid-column",[["label","Resource Barcode"],["path","current_resource.barcode"]],null,null,null,T.b,T.a)),u.pb(67,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(68,0,null,null,1,"eg-grid-column",[["label","Note"],["path","note"]],null,null,null,T.b,T.a)),u.pb(69,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(70,0,null,null,1,"eg-grid-column",[["label","Resource Type"],["path","target_resource_type.name"]],null,null,null,T.b,T.a)),u.pb(71,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(72,0,null,null,1,"eg-grid-column",[["label","Reservation length"],["path","length"]],null,null,null,T.b,T.a)),u.pb(73,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(74,0,null,null,1,"eg-grid-column",[["label","Request library"],["path","request_lib.name"]],null,null,null,T.b,T.a)),u.pb(75,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(76,0,null,null,1,"eg-grid-column",[["label","Reservation location"],["path","pickup_lib.name"]],null,null,null,T.b,T.a)),u.pb(77,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(78,0,null,null,1,"eg-grid-column",[["label","Reservation location timezone"],["path","timezone"]],null,null,null,T.b,T.a)),u.pb(79,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(80,0,null,null,4,"eg-fm-record-editor",[["datetimeFields","start_time,end_time"],["hiddenFields","xact_start,xact_finish,cancel_time,booking_interval"],["idlClass","bresv"]],null,null,null,Il.b,Il.a)),u.pb(81,114688,[[2,4],["editDialog",4]],0,Tl.a,[d.E,m.a,y.a,pl.a,x.a,f.a],{idlClass:[0,"idlClass"],fieldOptions:[1,"fieldOptions"],hiddenFields:[2,"hiddenFields"],readonlyFields:[3,"readonlyFields"],datetimeFields:[4,"datetimeFields"]},null),u.Fb(82,{template:0}),u.Fb(83,{customTemplate:0}),u.Fb(84,{end_time:0}),(l()(),u.qb(85,0,null,null,1,"eg-cancel-reservation-dialog",[],null,[[null,"onSuccessfulCancel"]],(function(l,n,e){var t=!0;return"onSuccessfulCancel"===n&&(t=!1!==u.Cb(l,5).reload()&&t),t}),In,yn)),u.pb(86,49152,[[3,4],["confirmCancelReservationDialog",4]],0,vn,[y.a,il.b,pl.a],null,{onSuccessfulCancel:"onSuccessfulCancel"}),(l()(),u.qb(87,0,null,null,1,"eg-no-timezone-set-dialog",[],null,null,null,Ol,Rl)),u.pb(88,114688,[[4,4],["noTimezoneSetDialog",4]],0,wl,[d.E],null,null),(l()(),u.fb(0,[["endTimeTemplate",2]],null,0,null,Bn))],(function(l,n){var e=n.component;l(n,5,0,e.gridSource,!0,!0,u.ub(1,"booking.",e.persistSuffix,"")),l(n,7,0,"Edit Selected",e.editNotAppropriate),l(n,9,0,"Cancel Selected",e.cancelNotAppropriate),l(n,11,0,"Pick Up Selected",e.pickupNotAppropriate),l(n,13,0,"Return Selected",e.returnNotAppropriate),l(n,15,0,"View Patron Record",e.notOnePatronSelected),l(n,17,0,"View Reservations for This Patron",e.notOnePatronSelected),l(n,19,0,"View Item Status",e.notOneCatalogedItemSelected),l(n,21,0,"View Reservations for This Resource",e.notOneResourceSelected),l(n,23,0,!e.status),l(n,25,0,"pickupReady"===e.status),l(n,27,0,"returnReady"===e.status),l(n,29,0,"id","id","ID",!0,!0),l(n,31,0,"usr.usrname","Patron username",!0),l(n,33,0,"usr.card.barcode","Patron barcode"),l(n,35,0,"usr.first_given_name","Patron first name"),l(n,37,0,"usr.second_given_name","Patron middle name",!0),l(n,39,0,"usr.family_name","Patron family name"),l(n,41,0,"start_time","start_time","Start Time","timestamp",!0),l(n,43,0,"end_time","end_time","End Time","timestamp",!0),l(n,45,0,"request_time","request_time","Request Time","timestamp",!0),l(n,47,0,"capture_time","capture_time","Capture Time","timestamp",!0),l(n,49,0,"pickup_time","pickup_time","Pickup Time","timestamp",!0),l(n,51,0,"email_notify","Email notify",!0,"bool"),l(n,53,0,"unrecovered",!0,"bool"),l(n,55,0,"billing_total","Billing total","money"),l(n,57,0,"payment_total","Payment total","money"),l(n,59,0,"booking_interval","Booking interval",!0),l(n,61,0,"fine_interval","Fine interval",!0),l(n,63,0,"fine_amount","Fine amount",!0,"money"),l(n,65,0,"max_fine","Maximum fine",!0,"money"),l(n,67,0,"current_resource.barcode","Resource Barcode"),l(n,69,0,"note","Note"),l(n,71,0,"target_resource_type.name","Resource Type"),l(n,73,0,"length","Reservation length"),l(n,75,0,"request_lib.name","Request library"),l(n,77,0,"pickup_lib.name","Reservation location"),l(n,79,0,"timezone","Reservation location timezone");var t=l(n,84,0,l(n,83,0,l(n,82,0,u.Cb(n,89))));l(n,81,0,"bresv",t,"xact_start,xact_finish,cancel_time,booking_interval",e.listReadOnlyFields(),"start_time,end_time"),l(n,88,0)}),null)}let Kn=(()=>{class l{constructor(l){this.pcrud=l,this.validate=l=>this.pcrud.search("brsrc",{barcode:l.value},{limit:1}).pipe(Object(ll.a)(()=>Object(Z.a)(null)),Object(bl.a)(l=>Object(Z.a)({resourceBarcode:"No resource found with that barcode"})))}}return l.ngInjectableDef=u.Qb({factory:function(){return new l(u.Rb(f.a))},token:l,providedIn:"root"}),l})();class An{constructor(l,n,e,u,t,a,i,r,s){this.route=l,this.router=n,this.auth=e,this.net=u,this.pcrud=t,this.store=a,this.toast=i,this.patronValidator=r,this.resourceValidator=s,this.subscriptions=[],this.startingTab="patron",this.startingPickupOrgs={primaryOrgId:this.auth.user().ws_ou(),includeDescendants:!0},this.store.getItem("eg.booking.manage.selected_org_family").then(l=>{l&&(this.startingPickupOrgs=l)})}ngOnInit(){this.filters=new r.j({pickupLibraries:new r.h(this.startingPickupOrgs),patronBarcode:new r.h("",[],[this.patronValidator.validate]),resourceBarcode:new r.h("",[],[this.resourceValidator.validate]),resourceType:new r.h(null)}),this.subscriptions.push(this.pickupLibraries.valueChanges.pipe().subscribe(()=>this.reservationsGrid.reloadGrid())),this.subscriptions.push(this.patronBarcode.statusChanges.pipe(Object(jl.a)(300),Object(ll.a)(l=>"VALID"===l?this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value.trim()).pipe(ul(),Object(Q.a)(l=>this.router.navigate(["/staff","booking","manage_reservations","by_patron",l[0].id]))):(this.toast.danger("No patron found with this barcode"),Object(Z.a)()))).subscribe()),this.subscriptions.push(this.resourceBarcode.statusChanges.pipe(Object(jl.a)(300),Object(Q.a)(l=>{"VALID"===l&&(this.resourceBarcode.value?this.router.navigate(["/staff","booking","manage_reservations","by_resource",this.resourceBarcode.value]):this.removeFilters())})).subscribe()),this.subscriptions.push(this.resourceType.valueChanges.pipe(Object(Q.a)(l=>{l?this.router.navigate(["/staff","booking","manage_reservations","by_resource_type",l.id]):this.removeFilters()})).subscribe()),this.subscriptions.push(this.pickupLibraries.valueChanges.pipe(Object(Q.a)(l=>this.store.setItem("eg.booking.manage.selected_org_family",l))).subscribe()),this.removeFilters=()=>{this.router.navigate(["/staff","booking","manage_reservations"])},this.route.paramMap.pipe(Object(ll.a)(l=>(this.patronId=l.has("patron_id")?+l.get("patron_id"):null,this.filters.patchValue({resourceBarcode:l.get("resource_barcode")},{emitEvent:!1}),this.filters.patchValue({resourceType:{id:+l.get("resource_type_id")}},{emitEvent:!1}),this.patronId?this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}}).pipe(Object(Q.a)(l=>{this.filters.patchValue({patronBarcode:l.card().barcode()})},l=>{console.debug(l)})):this.resourceBarcode.value?(this.startingTab="resource",this.pcrud.search("brsrc",{barcode:this.resourceBarcode.value},{limit:1}).pipe(Object(Q.a)(l=>{this.resourceId=l.id()},l=>{this.resourceId=-1,this.toast.danger("No resource found with this barcode")}))):this.resourceType.value?(this.startingTab="type",Object(Z.a)(null)):Object(Z.a)(null)))).subscribe()}get pickupLibraries(){return this.filters.get("pickupLibraries")}get patronBarcode(){return this.filters.get("patronBarcode")}get resourceBarcode(){return this.filters.get("resourceBarcode")}get resourceType(){return this.filters.get("resourceType")}get pickupLibrariesForGrid(){return this.pickupLibraries.value?this.pickupLibraries.value.orgIds:[this.auth.user().ws_ou()]}get resourceTypeForGrid(){return this.resourceType.value?this.resourceType.value.id:null}ngOnDestroy(){this.subscriptions.forEach(l=>{l.unsubscribe()})}}var Ln=u.ob({encapsulation:2,styles:[],data:{}});function jn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["filter_list"]))],null,null)}function Nn(l){return u.Mb(0,[(l()(),u.fb(16777216,null,null,1,null,jn)),u.pb(1,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(2,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Filter by patron"]))],(function(l,n){l(n,1,0,n.component.patronId)}),null)}function Mn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,3,"button",[["class","btn btn-warning"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.removeFilters()&&u),u}),null,null)),(l()(),u.qb(1,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["delete"])),(l()(),u.Kb(-1,null,[" Remove filter"]))],null,null)}function En(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,13,"div",[["class","m-2"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,12,"div",[["class","input-group m-2"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,1,"label",[["class","input-group-text"],["for","patron-barcode-value"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Patron barcode"])),(l()(),u.qb(5,0,null,null,5,"input",[["class","form-control"],["formControlName","patronBarcode"],["id","patron-barcode-value"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,6)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,6).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,6)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,6)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(6,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(8,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(10,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(11,0,null,null,2,"div",[["class","input-group-button"]],null,null,null,null,null)),(l()(),u.fb(16777216,null,null,1,null,Mn)),u.pb(13,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,8,0,"patronBarcode"),l(n,13,0,e.patronBarcode.value)}),(function(l,n){l(n,5,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending)}))}function Vn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["filter_list"]))],null,null)}function zn(l){return u.Mb(0,[(l()(),u.fb(16777216,null,null,1,null,Vn)),u.pb(1,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(2,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Filter by resource"]))],(function(l,n){l(n,1,0,n.component.resourceBarcode.value)}),null)}function Gn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,3,"button",[["class","btn btn-warning"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.removeFilters()&&u),u}),null,null)),(l()(),u.qb(1,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["delete"])),(l()(),u.Kb(-1,null,[" Remove filter"]))],null,null)}function Fn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,13,"div",[["class","m-2"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,12,"div",[["class","input-group m-2"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,1,"label",[["class","input-group-text"],["for","resource-barcode-value"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Resource barcode"])),(l()(),u.qb(5,0,null,null,5,"input",[["class","form-control"],["formControlName","resourceBarcode"],["id","resource-barcode-value"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,6)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,6).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,6)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,6)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(6,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(8,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(10,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(11,0,null,null,2,"div",[["class","input-group-button"]],null,null,null,null,null)),(l()(),u.fb(16777216,null,null,1,null,Gn)),u.pb(13,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,8,0,"resourceBarcode"),l(n,13,0,e.resourceBarcode.value)}),(function(l,n){l(n,5,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending)}))}function Hn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["filter_list"]))],null,null)}function Un(l){return u.Mb(0,[(l()(),u.fb(16777216,null,null,1,null,Hn)),u.pb(1,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.qb(2,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Filter by resource type"]))],(function(l,n){l(n,1,0,n.component.resourceTypeForGrid)}),null)}function $n(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,15,"div",[["class","m-2"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,14,"div",[["class","input-group m-2"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,1,"label",[["class","input-group-text"],["for","resource-type-value"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Resource type"])),(l()(),u.qb(5,0,null,null,5,"eg-combobox",[["domId","resource-type-value"],["formControlName","resourceType"],["idlClass","brt"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,p.b,p.a)),u.pb(6,114688,null,0,g.a,[u.k,h.a,m.a,f.a],{idlClass:[0,"idlClass"],asyncSupportsEmptyTermClick:[1,"asyncSupportsEmptyTermClick"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[g.a]),u.pb(8,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(10,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(11,0,null,null,4,"div",[["class","input-group-button"]],null,null,null,null,null)),(l()(),u.qb(12,0,null,null,3,"button",[["class","btn btn-warning"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.removeFilters()&&u),u}),null,null)),(l()(),u.qb(13,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["delete"])),(l()(),u.Kb(-1,null,[" Remove filter"]))],(function(l,n){l(n,6,0,"brt",!0),l(n,8,0,"resourceType")}),(function(l,n){l(n,5,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending)}))}function Jn(l){return u.Mb(0,[u.Ib(402653184,1,{filterTabs:0}),u.Ib(402653184,2,{reservationsGrid:0}),(l()(),u.qb(2,0,null,null,1,"eg-staff-banner",[["bannerText","Manage Reservations"]],null,null,null,L.b,L.a)),u.pb(3,49152,null,0,j.a,[],{bannerText:[0,"bannerText"]},null),(l()(),u.qb(4,0,null,null,1,"eg-title",[["prefix","Booking"],["suffix","Manage Reservations"]],null,null,null,N.b,N.a)),u.pb(5,4243456,null,0,M.a,[E.h],{prefix:[0,"prefix"],suffix:[1,"suffix"]},null),(l()(),u.qb(6,0,null,null,42,"form",[["class","row"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,8).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,8).onReset()&&t),t}),null,null)),u.pb(7,16384,null,0,r.G,[],null,null),u.pb(8,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(10,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(11,0,null,null,6,"div",[["class","col-sm-3"]],null,null,null,null,null)),(l()(),u.qb(12,0,null,null,5,"eg-org-family-select",[["formControlName","pickupLibraries"],["labelText","Reservation location"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,C.b,C.a)),u.pb(13,114688,null,0,v.a,[y.a,q.a],{labelText:[0,"labelText"]},null),u.Hb(1024,null,r.o,(function(l){return[l]}),[v.a]),u.pb(15,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(17,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(18,0,null,null,30,"div",[["class","col-sm-6 offset-sm-3"]],null,null,null,null,null)),(l()(),u.qb(19,0,null,null,29,"div",[["class","card"]],null,null,null,null,null)),(l()(),u.qb(20,0,null,null,1,"h2",[["class","card-header"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Filter reservations"])),(l()(),u.qb(22,0,null,null,26,"ngb-tabset",[["class","mt-1"]],null,null,null,i.k,i.f)),u.pb(23,2146304,[[1,4],["filterTabs",4]],1,d.eb,[d.fb],{activeId:[0,"activeId"]},null),u.Ib(603979776,3,{tabs:1}),(l()(),u.qb(25,0,null,null,7,"ngb-tab",[["id","patron"]],null,null,null,null,null)),u.pb(26,2113536,[[3,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,4,{titleTpls:1}),u.Ib(603979776,5,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,Nn)),u.pb(30,16384,[[4,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,En)),u.pb(32,16384,[[5,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(33,0,null,null,7,"ngb-tab",[["id","resource"]],null,null,null,null,null)),u.pb(34,2113536,[[3,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,6,{titleTpls:1}),u.Ib(603979776,7,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,zn)),u.pb(38,16384,[[6,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,Fn)),u.pb(40,16384,[[7,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(41,0,null,null,7,"ngb-tab",[["id","type"]],null,null,null,null,null)),u.pb(42,2113536,[[3,4]],2,d.bb,[],{id:[0,"id"]},null),u.Ib(603979776,8,{titleTpls:1}),u.Ib(603979776,9,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,Un)),u.pb(46,16384,[[8,4]],0,d.db,[u.K],null,null),(l()(),u.fb(0,null,null,1,null,$n)),u.pb(48,16384,[[9,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(49,0,null,null,1,"eg-reservations-grid",[["persistSuffix","manage"]],null,null,null,Pn,Sn)),u.pb(50,638976,[[2,4],["reservationsGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],resourceBarcode:[1,"resourceBarcode"],resourceType:[2,"resourceType"],pickupLibIds:[3,"pickupLibIds"],persistSuffix:[4,"persistSuffix"]},null)],(function(l,n){var e=n.component;l(n,3,0,"Manage Reservations"),l(n,5,0,"Booking","Manage Reservations"),l(n,8,0,e.filters),l(n,13,0,"Reservation location"),l(n,15,0,"pickupLibraries"),l(n,23,0,e.startingTab),l(n,26,0,"patron"),l(n,34,0,"resource"),l(n,42,0,"type"),l(n,50,0,e.patronId,e.resourceBarcode.value,e.resourceTypeForGrid,e.pickupLibrariesForGrid,"manage")}),(function(l,n){l(n,6,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending),l(n,12,0,u.Cb(n,17).ngClassUntouched,u.Cb(n,17).ngClassTouched,u.Cb(n,17).ngClassPristine,u.Cb(n,17).ngClassDirty,u.Cb(n,17).ngClassValid,u.Cb(n,17).ngClassInvalid,u.Cb(n,17).ngClassPending)}))}function Xn(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"eg-manage-reservations",[],null,null,null,Jn,Ln)),u.pb(1,245760,null,0,An,[A.a,A.l,y.a,il.b,f.a,O.a,pl.a,dl,Kn],null,null)],(function(l,n){l(n,1,0)}),null)}var Wn=u.mb("eg-manage-reservations",An,Xn,{},{},[]),Zn=e("pLZG"),Qn=e("W4aW");class Yn{constructor(l,n,e,u,t,a,i){this.pcrud=l,this.patron=n,this.pbv=e,this.route=u,this.router=t,this.store=a,this.toast=i,this.subscriptions=[],this.onlyShowCaptured=!0}ngOnInit(){this.findPatron=new r.j({patronBarcode:new r.h(null,[r.B.required],[this.pbv.validate])}),this.route.paramMap.pipe(Object(Zn.a)(l=>l.has("patron_id")),Object(ll.a)(l=>(this.patronId=+l.get("patron_id"),this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}})))).subscribe(l=>{this.findPatron.patchValue({patronBarcode:l.card().barcode()},{emitEvent:!1}),this.readyGrid.reloadGrid(),this.pickedUpGrid.reloadGrid()}),this.subscriptions.push(this.patronBarcode.valueChanges.pipe(Object(jl.a)(1500),Object(ll.a)(l=>"INVALID"===this.patronBarcode.status?(this.toast.danger("No patron found with this barcode"),Object(Z.a)()):this.patron.bcSearch(l).pipe(ul(),Object(Q.a)(l=>{this.router.navigate(["/staff","booking","pickup","by_patron",l[0].id])})))).subscribe()),this.store.getItem("eg.booking.pickup.ready.only_show_captured").then(l=>{null!=l&&(this.onlyShowCaptured=l)}),this.handleShowCapturedChange=()=>{this.onlyShowCaptured=!this.onlyShowCaptured,this.readyGrid.reloadGrid(),this.store.setItem("eg.booking.pickup.ready.only_show_captured",this.onlyShowCaptured)}}get patronBarcode(){return this.findPatron.get("patronBarcode")}ngOnDestroy(){this.subscriptions.forEach(l=>{l.unsubscribe()})}}var le=u.ob({encapsulation:2,styles:[],data:{}});function ne(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,12,"div",[],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"h2",[["class","text-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Ready for pickup"])),(l()(),u.qb(3,0,null,null,3,"div",[["class","form-check"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,0,"input",[["class","form-check-input"],["id","only-show-captured"],["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],(function(l,n,e){var u=!0;return"change"===n&&(u=!1!==l.component.handleShowCapturedChange()&&u),u}),null,null)),(l()(),u.qb(5,0,null,null,1,"label",[["class","form-check-label"],["for","only-show-captured"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Show only captured resources"])),(l()(),u.qb(7,0,null,null,1,"eg-reservations-grid",[["persistSuffix","pickup.ready"],["status","pickupReady"]],null,[[null,"onPickup"]],(function(l,n,e){var t=!0;return"onPickup"===n&&(t=!1!==u.Cb(l,12).reloadGrid()&&t),t}),Pn,Sn)),u.pb(8,638976,[[1,4],["readyGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"],onlyCaptured:[3,"onlyCaptured"]},{onPickup:"onPickup"}),(l()(),u.qb(9,0,null,null,1,"h2",[["class","text-center mt-2"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Already picked up"])),(l()(),u.qb(11,0,null,null,1,"eg-reservations-grid",[["persistSuffix","pickup.picked_up"],["status","pickedUp"]],null,null,null,Pn,Sn)),u.pb(12,638976,[[2,4],["pickedUpGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"]},null)],(function(l,n){var e=n.component;l(n,8,0,e.patronId,"pickupReady","pickup.ready",e.onlyShowCaptured),l(n,12,0,e.patronId,"pickedUp","pickup.picked_up")}),(function(l,n){l(n,4,0,n.component.onlyShowCaptured)}))}function ee(l){return u.Mb(0,[u.Ib(671088640,1,{readyGrid:0}),u.Ib(671088640,2,{pickedUpGrid:0}),(l()(),u.qb(2,0,null,null,1,"eg-staff-banner",[["bannerText","Booking Pickup"]],null,null,null,L.b,L.a)),u.pb(3,49152,null,0,j.a,[],{bannerText:[0,"bannerText"]},null),(l()(),u.qb(4,0,null,null,1,"eg-title",[["prefix","Booking"],["suffix","Pickup"]],null,null,null,N.b,N.a)),u.pb(5,4243456,null,0,M.a,[E.h],{prefix:[0,"prefix"],suffix:[1,"suffix"]},null),(l()(),u.qb(6,0,null,null,15,"form",[["class","row"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,8).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,8).onReset()&&t),t}),null,null)),u.pb(7,16384,null,0,r.G,[],null,null),u.pb(8,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(10,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(11,0,null,null,10,"div",[["class","col-md-4"]],null,null,null,null,null)),(l()(),u.qb(12,0,null,null,9,"div",[["class","input-group flex-nowrap"]],null,null,null,null,null)),(l()(),u.qb(13,0,null,null,8,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(14,0,null,null,1,"label",[["class","input-group-text"],["for","patron-barcode"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Patron barcode"])),(l()(),u.qb(16,0,null,null,5,"input",[["class","form-control"],["formControlName","patronBarcode"],["id","patron-barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,17)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,17).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,17)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,17)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(17,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(19,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(21,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,ne)),u.pb(23,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,3,0,"Booking Pickup"),l(n,5,0,"Booking","Pickup"),l(n,8,0,e.findPatron),l(n,19,0,"patronBarcode"),l(n,23,0,e.patronId)}),(function(l,n){l(n,6,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending),l(n,16,0,u.Cb(n,21).ngClassUntouched,u.Cb(n,21).ngClassTouched,u.Cb(n,21).ngClassPristine,u.Cb(n,21).ngClassDirty,u.Cb(n,21).ngClassValid,u.Cb(n,21).ngClassInvalid,u.Cb(n,21).ngClassPending)}))}function ue(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"ng-component",[],null,null,null,ee,le)),u.pb(1,245760,null,0,Yn,[f.a,Qn.a,dl,A.a,A.l,O.a,pl.a],null,null)],(function(l,n){l(n,1,0)}),null)}var te=u.mb("ng-component",Yn,ue,{},{},[]);class ae{constructor(l,n,e,u,t){this.auth=l,this.net=n,this.org=e,this.pcrud=u,this.actions=t,this.noSelectedRows=l=>0===l.length,this.notOneResourceSelected=l=>this.actions.notOneUniqueSelected(l.map(l=>{if(l.current_resource)return l.current_resource.id})),this.notOneCatalogedItemSelected=l=>this.actions.notOneUniqueSelected(l.filter(l=>l.current_resource&&l.call_number).map(l=>l.current_resource.id())),this.cancelSelected=l=>{this.cancelReservationDialog.open(l.map(l=>l.reservations[0].id()))},this.fleshResource=l=>"t"===l.target_resource_type.catalog_item()?this.pcrud.search("acp",{barcode:l.current_resource.barcode()},{limit:1,flesh:1,flesh_fields:{acp:["call_number","location"]}}).pipe(Object(ll.a)(n=>(l.call_number=n.call_number().label(),l.call_number_sortkey=n.call_number().label_sortkey(),l.shelving_location=n.location().name(),Object(Z.a)(l)))):Object(Z.a)(l),this.viewByResource=l=>{this.actions.manageReservationsByResource(l[0].current_resource.barcode())},this.viewItemStatus=l=>{this.actions.viewItemStatus(l[0].current_resource.barcode())}}ngOnInit(){this.dataSource=new Nl.c,this.pullListCriteria=new r.j({daysHence:new r.h(5,[r.B.required,r.B.min(1)])}),this.pullListCriteria.valueChanges.subscribe(()=>this.fillGrid()),this.disableOrgs=()=>this.org.filterList({canHaveVolumes:!1},!0),this.fillGrid=(l=this.auth.user().ws_ou())=>{this.dataSource.data=[],this.net.request("open-ils.booking","open-ils.booking.reservations.get_pull_list",this.auth.token(),null,86400*this.daysHence.value,l).pipe(Object(ll.a)(l=>Object(xl.a)(l)),Object(ll.a)(l=>this.fleshResource(l))).subscribe(l=>this.dataSource.data.push(l))}}get daysHence(){return this.pullListCriteria.get("daysHence")}}var ie=u.ob({encapsulation:2,styles:[],data:{}});function re(l){return u.Mb(0,[u.Ib(402653184,1,{cancelReservationDialog:0}),(l()(),u.qb(1,0,null,null,1,"eg-staff-banner",[["bannerText","Booking Pull List"]],null,null,null,L.b,L.a)),u.pb(2,49152,null,0,j.a,[],{bannerText:[0,"bannerText"]},null),(l()(),u.qb(3,0,null,null,1,"eg-title",[["prefix","Booking"],["suffix","Pull List"]],null,null,null,N.b,N.a)),u.pb(4,4243456,null,0,M.a,[E.h],{prefix:[0,"prefix"],suffix:[1,"suffix"]},null),(l()(),u.qb(5,0,null,null,23,"form",[["class","row"],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,7).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,7).onReset()&&t),t}),null,null)),u.pb(6,16384,null,0,r.G,[],null,null),u.pb(7,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(9,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(10,0,null,null,6,"div",[["class","col-md-4"]],null,null,null,null,null)),(l()(),u.qb(11,0,null,null,5,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(12,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(13,0,null,null,1,"label",[["class","input-group-text"],["for","ou"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Library:"])),(l()(),u.qb(15,0,null,null,1,"eg-org-select",[["domId","ou"]],null,[[null,"onChange"]],(function(l,n,e){var u=!0;return"onChange"===n&&(u=!1!==l.component.fillGrid(e.id())&&u),u}),F.b,F.a)),u.pb(16,114688,null,0,H.a,[y.a,h.a,q.a,U.a],{domId:[0,"domId"],applyDefault:[1,"applyDefault"],hideOrgs:[2,"hideOrgs"],disableOrgs:[3,"disableOrgs"]},{onChange:"onChange"}),(l()(),u.qb(17,0,null,null,11,"div",[["class","col-md-4"]],null,null,null,null,null)),(l()(),u.qb(18,0,null,null,10,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),u.qb(19,0,null,null,2,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(20,0,null,null,1,"label",[["class","input-group-text"],["for","days-hence"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Number of days to fetch:"])),(l()(),u.qb(22,0,null,null,6,"input",[["class","form-control"],["formControlName","daysHence"],["min","1"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,23)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,23).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,23)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,23)._compositionEnd(e.target.value)&&t),"change"===n&&(t=!1!==u.Cb(l,24).onChange(e.target.value)&&t),"input"===n&&(t=!1!==u.Cb(l,24).onChange(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,24).onTouched()&&t),t}),null,null)),u.pb(23,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.pb(24,16384,null,0,r.v,[u.C,u.k],null,null),u.Hb(1024,null,r.o,(function(l,n){return[l,n]}),[r.d,r.v]),u.pb(26,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(28,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.qb(29,0,null,null,29,"eg-grid",[["persistKey","booking.pull_list"]],null,null,null,S.b,S.a)),u.pb(30,4440064,[["pullList",4]],0,R.a,[m.a,q.a,O.a,x.a],{dataSource:[0,"dataSource"],sortable:[1,"sortable"],useLocalSort:[2,"useLocalSort"],persistKey:[3,"persistKey"]},null),(l()(),u.qb(31,0,null,null,1,"eg-grid-toolbar-action",[["label","Cancel Selected"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.cancelSelected(e)&&u),u}),P.b,P.a)),u.pb(32,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(33,0,null,null,1,"eg-grid-toolbar-action",[["label","View Item Status"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewItemStatus(e)&&u),u}),P.b,P.a)),u.pb(34,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(35,0,null,null,1,"eg-grid-toolbar-action",[["label","View Reservations for This Resource"]],null,[[null,"onClick"]],(function(l,n,e){var u=!0;return"onClick"===n&&(u=!1!==l.component.viewByResource(e)&&u),u}),P.b,P.a)),u.pb(36,114688,null,0,K.a,[R.a],{label:[0,"label"],disableOnRows:[1,"disableOnRows"]},{onClick:"onClick"}),(l()(),u.qb(37,0,null,null,1,"eg-grid-toolbar-action",[["label","Print Pull List"]],null,[[null,"onClick"]],(function(l,n,e){var t=!0;return"onClick"===n&&(t=!1!==u.Cb(l,30).print()&&t),t}),P.b,P.a)),u.pb(38,114688,null,0,K.a,[R.a],{label:[0,"label"]},{onClick:"onClick"}),(l()(),u.qb(39,0,null,null,1,"eg-grid-column",[["label","ID"],["name","id"],["path","current_resource.id"]],null,null,null,T.b,T.a)),u.pb(40,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"],index:[3,"index"],hidden:[4,"hidden"]},null),(l()(),u.qb(41,0,null,null,1,"eg-grid-column",[["label","Shelving location"],["path","shelving_location"]],null,null,null,T.b,T.a)),u.pb(42,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(43,0,null,null,1,"eg-grid-column",[["label","Call number"],["path","call_number"]],null,null,null,T.b,T.a)),u.pb(44,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(45,0,null,null,1,"eg-grid-column",[["label","Call number sortkey"],["path","call_number_sortkey"]],null,null,null,T.b,T.a)),u.pb(46,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(47,0,null,null,1,"eg-grid-column",[["label","Barcode"],["name","barcode"],["path","current_resource.barcode"]],null,null,null,T.b,T.a)),u.pb(48,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"]},null),(l()(),u.qb(49,0,null,null,1,"eg-grid-column",[["label","Title or name"],["name","title"],["path","target_resource_type.name"]],null,null,null,T.b,T.a)),u.pb(50,114688,null,0,w.a,[R.a],{name:[0,"name"],path:[1,"path"],label:[2,"label"]},null),(l()(),u.qb(51,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Reservation start time"],["path","reservations.0.start_time"]],null,null,null,T.b,T.a)),u.pb(52,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],datatype:[2,"datatype"],datePlusTime:[3,"datePlusTime"]},null),(l()(),u.qb(53,0,null,null,1,"eg-grid-column",[["datatype","timestamp"],["label","Reservation end time"],["path","reservations.0.end_time"]],null,null,null,T.b,T.a)),u.pb(54,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"],datatype:[2,"datatype"],datePlusTime:[3,"datePlusTime"]},null),(l()(),u.qb(55,0,null,null,1,"eg-grid-column",[["label","Patron first name"],["path","reservations.0.usr.first_given_name"]],null,null,null,T.b,T.a)),u.pb(56,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(57,0,null,null,1,"eg-grid-column",[["label","Patron last name"],["path","reservations.0.usr.family_name"]],null,null,null,T.b,T.a)),u.pb(58,114688,null,0,w.a,[R.a],{path:[0,"path"],label:[1,"label"]},null),(l()(),u.qb(59,0,null,null,1,"eg-cancel-reservation-dialog",[],null,[[null,"onSuccessfulCancel"]],(function(l,n,e){var u=!0;return"onSuccessfulCancel"===n&&(u=!1!==l.component.fillGrid()&&u),u}),In,yn)),u.pb(60,49152,[[1,4],["confirmCancelReservationDialog",4]],0,vn,[y.a,il.b,pl.a],null,{onSuccessfulCancel:"onSuccessfulCancel"})],(function(l,n){var e=n.component;l(n,2,0,"Booking Pull List"),l(n,4,0,"Booking","Pull List"),l(n,7,0,e.pullListCriteria),l(n,16,0,"ou",!0,e.disableOrgs(),e.disableOrgs()),l(n,26,0,"daysHence"),l(n,30,0,e.dataSource,!0,!0,"booking.pull_list"),l(n,32,0,"Cancel Selected",e.noSelectedRows),l(n,34,0,"View Item Status",e.notOneCatalogedItemSelected),l(n,36,0,"View Reservations for This Resource",e.notOneResourceSelected),l(n,38,0,"Print Pull List"),l(n,40,0,"id","current_resource.id","ID",!0,!0),l(n,42,0,"shelving_location","Shelving location"),l(n,44,0,"call_number","Call number"),l(n,46,0,"call_number_sortkey","Call number sortkey"),l(n,48,0,"barcode","current_resource.barcode","Barcode"),l(n,50,0,"title","target_resource_type.name","Title or name"),l(n,52,0,"reservations.0.start_time","Reservation start time","timestamp",!0),l(n,54,0,"reservations.0.end_time","Reservation end time","timestamp",!0),l(n,56,0,"reservations.0.usr.first_given_name","Patron first name"),l(n,58,0,"reservations.0.usr.family_name","Patron last name")}),(function(l,n){l(n,5,0,u.Cb(n,9).ngClassUntouched,u.Cb(n,9).ngClassTouched,u.Cb(n,9).ngClassPristine,u.Cb(n,9).ngClassDirty,u.Cb(n,9).ngClassValid,u.Cb(n,9).ngClassInvalid,u.Cb(n,9).ngClassPending),l(n,22,0,u.Cb(n,28).ngClassUntouched,u.Cb(n,28).ngClassTouched,u.Cb(n,28).ngClassPristine,u.Cb(n,28).ngClassDirty,u.Cb(n,28).ngClassValid,u.Cb(n,28).ngClassInvalid,u.Cb(n,28).ngClassPending)}))}function se(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"ng-component",[],null,null,null,re,ie)),u.pb(1,114688,null,0,ae,[y.a,il.b,q.a,f.a,wn],null,null)],(function(l,n){l(n,1,0)}),null)}var oe=u.mb("ng-component",ae,se,{},{},[]);class ce{constructor(l,n,e,u,t,a,i){this.pcrud=l,this.patron=n,this.pbv=e,this.route=u,this.router=t,this.store=a,this.toast=i,this.subscriptions=[],this.handleParams$=l=>(this.patronId=+l.get("patron_id"),this.patronId?this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}}).pipe(Object(Q.a)(l=>{this.findPatron.patchValue({patronBarcode:l.card().barcode()}),this.refreshGrids()},l=>{console.debug(l)})):Object(xl.a)(this.store.getItem("eg.booking.return.tab")).pipe(Object(Q.a)(l=>{l&&this.tabs.select(l)}))),this.refreshGrids=()=>{this.grids.forEach(l=>l.reloadGrid())}}ngOnInit(){this.route.paramMap.pipe(Object(ll.a)(l=>this.handleParams$(l))).subscribe(),this.findPatron=new r.j({patronBarcode:new r.h(null,[r.B.required],[this.pbv.validate]),resourceBarcode:new r.h(null,[r.B.required])}),this.subscriptions.push(this.patronBarcode.valueChanges.pipe(Object(jl.a)(1500),Object(ll.a)(l=>"INVALID"===this.patronBarcode.status?(this.toast.danger("No patron found with this barcode"),Object(Z.a)()):this.patron.bcSearch(l).pipe(ul(),Object(Q.a)(l=>{this.router.navigate(["/staff","booking","return","by_patron",l[0].id])})))).subscribe()),this.subscriptions.push(this.resourceBarcode.valueChanges.pipe(Object(jl.a)(1500),Object(ll.a)(l=>"INVALID"!==this.resourceBarcode.status?this.pcrud.search("brsrc",{barcode:l},{order_by:{curr_rsrcs:"pickup_time DESC"},limit:1,flesh:1,flesh_fields:{brsrc:["curr_rsrcs"]},select:{curr_rsrcs:{return_time:null,pickup_time:{"!=":null}}}}).pipe(Object(Q.a)(l=>{l.curr_rsrcs()[0].usr()&&(this.patronId=l.curr_rsrcs()[0].usr(),this.refreshGrids())})):Object(Z.a)())).subscribe()),this.noSelectedRows=l=>0===l.length,this.handleTabChange=l=>{this.store.setItem("eg.booking.return.tab",l.nextId).then(()=>{this.router.navigate(["/staff","booking","return"]),this.findPatron.patchValue({resourceBarcode:""}),this.patronId=null})}}get patronBarcode(){return this.findPatron.get("patronBarcode")}get resourceBarcode(){return this.findPatron.get("resourceBarcode")}ngOnDestroy(){this.subscriptions.forEach(l=>{l.unsubscribe()})}}var be=u.ob({encapsulation:2,styles:[],data:{}});function de(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,8,"div",[],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"h2",[["class","text-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Ready for return"])),(l()(),u.qb(3,0,null,null,1,"eg-reservations-grid",[["persistSuffix","return.patron.picked_up"],["status","returnReady"]],null,[[null,"onReturn"]],(function(l,n,e){var u=!0;return"onReturn"===n&&(u=!1!==l.component.refreshGrids()&&u),u}),Pn,Sn)),u.pb(4,638976,[[2,4],["readyGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"]},{onReturn:"onReturn"}),(l()(),u.qb(5,0,null,null,1,"h2",[["class","text-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Returned today"])),(l()(),u.qb(7,0,null,null,1,"eg-reservations-grid",[["persistSuffix","return.patron.returned"],["status","returnedToday"]],null,null,null,Pn,Sn)),u.pb(8,638976,[[2,4],["returnedGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"]},null)],(function(l,n){var e=n.component;l(n,4,0,e.patronId,"returnReady","return.patron.picked_up"),l(n,8,0,e.patronId,"returnedToday","return.patron.returned")}),null)}function pe(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,11,"div",[["class","row"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,10,"div",[["class","col-md-4"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,9,"div",[["class","input-group flex-nowrap"]],null,null,null,null,null)),(l()(),u.qb(3,0,null,null,8,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,1,"label",[["class","input-group-text"],["for","patron-barcode"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Patron barcode"])),(l()(),u.qb(6,0,null,null,5,"input",[["class","form-control"],["formControlName","patronBarcode"],["id","patron-barcode"],["placeholder","Patron barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,7)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,7).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,7)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,7)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(7,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(9,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(11,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,de)),u.pb(13,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,9,0,"patronBarcode"),l(n,13,0,e.patronId)}),(function(l,n){l(n,6,0,u.Cb(n,11).ngClassUntouched,u.Cb(n,11).ngClassTouched,u.Cb(n,11).ngClassPristine,u.Cb(n,11).ngClassDirty,u.Cb(n,11).ngClassValid,u.Cb(n,11).ngClassInvalid,u.Cb(n,11).ngClassPending)}))}function ge(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,8,"div",[],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"h2",[["class","text-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Ready for return"])),(l()(),u.qb(3,0,null,null,1,"eg-reservations-grid",[["persistSuffix","return.resource.picked_up"],["status","returnReady"]],null,[[null,"onReturn"]],(function(l,n,e){var t=!0;return"onReturn"===n&&(t=!1!==u.Cb(l,8).reloadGrid()&&t),t}),Pn,Sn)),u.pb(4,638976,[[2,4],["readyGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"]},{onReturn:"onReturn"}),(l()(),u.qb(5,0,null,null,1,"h2",[["class","text-center"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Returned today"])),(l()(),u.qb(7,0,null,null,1,"eg-reservations-grid",[["persistSuffix","return.resource.returned"],["status","returnedToday"]],null,null,null,Pn,Sn)),u.pb(8,638976,[[2,4],["returnedGrid",4]],0,Rn,[y.a,x.a,f.a,A.l,pl.a,il.b,q.a,wn],{patron:[0,"patron"],status:[1,"status"],persistSuffix:[2,"persistSuffix"]},null)],(function(l,n){var e=n.component;l(n,4,0,e.patronId,"returnReady","return.resource.picked_up"),l(n,8,0,e.patronId,"returnedToday","return.resource.returned")}),null)}function he(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,9,"div",[["class","input-group flex-nowrap"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,8,"div",[["class","input-group-prepend"]],null,null,null,null,null)),(l()(),u.qb(2,0,null,null,1,"label",[["class","input-group-text"],["for","resource-barcode"]],null,null,null,null,null)),(l()(),u.Kb(-1,null,["Resource barcode"])),(l()(),u.qb(4,0,null,null,5,"input",[["class","form-control"],["formControlName","resourceBarcode"],["id","resource-barcode"],["placeholder","Resource barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var t=!0;return"input"===n&&(t=!1!==u.Cb(l,5)._handleInput(e.target.value)&&t),"blur"===n&&(t=!1!==u.Cb(l,5).onTouched()&&t),"compositionstart"===n&&(t=!1!==u.Cb(l,5)._compositionStart()&&t),"compositionend"===n&&(t=!1!==u.Cb(l,5)._compositionEnd(e.target.value)&&t),t}),null,null)),u.pb(5,16384,null,0,r.d,[u.C,u.k,[2,r.a]],null,null),u.Hb(1024,null,r.o,(function(l){return[l]}),[r.d]),u.pb(7,671744,null,0,r.i,[[3,r.c],[8,null],[8,null],[6,r.o],[2,r.E]],{name:[0,"name"]},null),u.Hb(2048,null,r.p,null,[r.i]),u.pb(9,16384,null,0,r.q,[[4,r.p]],null,null),(l()(),u.fb(16777216,null,null,1,null,ge)),u.pb(11,16384,null,0,I.p,[u.N,u.K],{ngIf:[0,"ngIf"]},null),(l()(),u.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,7,0,"resourceBarcode"),l(n,11,0,e.patronId)}),(function(l,n){l(n,4,0,u.Cb(n,9).ngClassUntouched,u.Cb(n,9).ngClassTouched,u.Cb(n,9).ngClassPristine,u.Cb(n,9).ngClassDirty,u.Cb(n,9).ngClassValid,u.Cb(n,9).ngClassInvalid,u.Cb(n,9).ngClassPending)}))}function me(l){return u.Mb(0,[u.Ib(402653184,1,{tabs:0}),u.Ib(671088640,2,{grids:1}),(l()(),u.qb(2,0,null,null,1,"eg-staff-banner",[["bannerText","Booking Return"]],null,null,null,L.b,L.a)),u.pb(3,49152,null,0,j.a,[],{bannerText:[0,"bannerText"]},null),(l()(),u.qb(4,0,null,null,1,"eg-title",[["prefix","Booking"],["suffix","Return"]],null,null,null,N.b,N.a)),u.pb(5,4243456,null,0,M.a,[E.h],{prefix:[0,"prefix"],suffix:[1,"suffix"]},null),(l()(),u.qb(6,0,null,null,19,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(l,n,e){var t=!0;return"submit"===n&&(t=!1!==u.Cb(l,8).onSubmit(e)&&t),"reset"===n&&(t=!1!==u.Cb(l,8).onReset()&&t),t}),null,null)),u.pb(7,16384,null,0,r.G,[],null,null),u.pb(8,540672,null,0,r.k,[[8,null],[8,null]],{form:[0,"form"]},null),u.Hb(2048,null,r.c,null,[r.k]),u.pb(10,16384,null,0,r.r,[[4,r.c]],null,null),(l()(),u.qb(11,0,null,null,14,"ngb-tabset",[["activeId","patron"]],null,[[null,"tabChange"]],(function(l,n,e){var u=!0;return"tabChange"===n&&(u=!1!==l.component.handleTabChange(e)&&u),u}),i.k,i.f)),u.pb(12,2146304,[[1,4],["tabs",4]],1,d.eb,[d.fb],{activeId:[0,"activeId"]},{tabChange:"tabChange"}),u.Ib(603979776,3,{tabs:1}),(l()(),u.qb(14,0,null,null,5,"ngb-tab",[["id","patron"],["title","By patron"]],null,null,null,null,null)),u.pb(15,2113536,[[3,4]],2,d.bb,[],{id:[0,"id"],title:[1,"title"]},null),u.Ib(603979776,4,{titleTpls:1}),u.Ib(603979776,5,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,pe)),u.pb(19,16384,[[5,4]],0,d.cb,[u.K],null,null),(l()(),u.qb(20,0,null,null,5,"ngb-tab",[["id","resource"],["title","By resource"]],null,null,null,null,null)),u.pb(21,2113536,[[3,4]],2,d.bb,[],{id:[0,"id"],title:[1,"title"]},null),u.Ib(603979776,6,{titleTpls:1}),u.Ib(603979776,7,{contentTpls:1}),(l()(),u.fb(0,null,null,1,null,he)),u.pb(25,16384,[[7,4]],0,d.cb,[u.K],null,null)],(function(l,n){var e=n.component;l(n,3,0,"Booking Return"),l(n,5,0,"Booking","Return"),l(n,8,0,e.findPatron),l(n,12,0,"patron"),l(n,15,0,"patron","By patron"),l(n,21,0,"resource","By resource")}),(function(l,n){l(n,6,0,u.Cb(n,10).ngClassUntouched,u.Cb(n,10).ngClassTouched,u.Cb(n,10).ngClassPristine,u.Cb(n,10).ngClassDirty,u.Cb(n,10).ngClassValid,u.Cb(n,10).ngClassInvalid,u.Cb(n,10).ngClassPending)}))}function fe(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,1,"ng-component",[],null,null,null,me,be)),u.pb(1,245760,null,0,ce,[f.a,Qn.a,dl,A.a,A.l,O.a,pl.a],null,null)],(function(l,n){l(n,1,0)}),null)}var Ce=u.mb("ng-component",ce,fe,{},{},[]),ve=e("G8BM"),ye=e("EWr9"),qe=e("XKii"),_e=e("LMfH"),ke=e("EQoe"),Ie=e("mW9/"),Te=e("avZ9"),we=e("pKmL"),Re=e("9RLy"),Se=e("VEwP"),Oe=e("NR/D"),xe=e("r2N+"),De=e("ZqI7"),Be=e("MhCk"),Pe=e("MZHd");class Ke{}var Ae=e("EBEo"),Le=e("zF8d"),je=e("csFu"),Ne=e("Y/mG");e.d(n,"BookingModuleNgFactory",(function(){return Me}));var Me=u.nb(t,[],(function(l){return u.zb([u.Ab(512,u.j,u.Y,[[8,[a.a,i.a,i.b,i.p,i.q,i.m,i.n,i.o,mn,Wn,te,oe,Ce]],[3,u.j],u.w]),u.Ab(4608,I.r,I.q,[u.t,[2,I.S]]),u.Ab(4608,r.D,r.D,[]),u.Ab(4608,r.g,r.g,[]),u.Ab(4608,d.E,d.E,[u.j,u.q,d.Fb,d.F]),u.Ab(4608,I.f,I.f,[u.t]),u.Ab(4608,I.d,I.d,[u.t]),u.Ab(4608,ve.a,ve.a,[]),u.Ab(4608,ye.a,ye.a,[q.a]),u.Ab(4608,qe.a,qe.a,[m.a,il.b,q.a,ye.a,f.a]),u.Ab(4608,_e.a,_e.a,[il.b,f.a,h.a,ke.a]),u.Ab(4608,Ie.a,Ie.a,[m.a,il.b,q.a,ye.a,f.a,qe.a,_e.a]),u.Ab(4608,Te.a,Te.a,[q.a]),u.Ab(4608,Qn.a,Qn.a,[il.b,y.a]),u.Ab(1073742336,I.c,I.c,[]),u.Ab(1073742336,r.C,r.C,[]),u.Ab(1073742336,r.l,r.l,[]),u.Ab(1073742336,r.x,r.x,[]),u.Ab(1073742336,A.o,A.o,[[2,A.t],[2,A.l]]),u.Ab(1073742336,d.c,d.c,[]),u.Ab(1073742336,d.f,d.f,[]),u.Ab(1073742336,d.g,d.g,[]),u.Ab(1073742336,d.k,d.k,[]),u.Ab(1073742336,d.l,d.l,[]),u.Ab(1073742336,d.t,d.t,[]),u.Ab(1073742336,d.z,d.z,[]),u.Ab(1073742336,d.G,d.G,[]),u.Ab(1073742336,d.I,d.I,[]),u.Ab(1073742336,d.N,d.N,[]),u.Ab(1073742336,d.U,d.U,[]),u.Ab(1073742336,d.X,d.X,[]),u.Ab(1073742336,d.ab,d.ab,[]),u.Ab(1073742336,d.gb,d.gb,[]),u.Ab(1073742336,d.lb,d.lb,[]),u.Ab(1073742336,d.ob,d.ob,[]),u.Ab(1073742336,d.rb,d.rb,[]),u.Ab(1073742336,d.ub,d.ub,[]),u.Ab(1073742336,d.H,d.H,[]),u.Ab(1073742336,we.a,we.a,[]),u.Ab(1073742336,Re.a,Re.a,[]),u.Ab(1073742336,Se.a,Se.a,[]),u.Ab(1073742336,Oe.a,Oe.a,[]),u.Ab(1073742336,xe.a,xe.a,[]),u.Ab(1073742336,De.a,De.a,[]),u.Ab(1073742336,Be.a,Be.a,[]),u.Ab(1073742336,Pe.a,Pe.a,[]),u.Ab(1073742336,Ke,Ke,[]),u.Ab(1073742336,Ae.a,Ae.a,[]),u.Ab(1073742336,Le.a,Le.a,[]),u.Ab(1073742336,je.a,je.a,[]),u.Ab(1073742336,Ne.a,Ne.a,[]),u.Ab(1073742336,t,t,[]),u.Ab(1024,A.j,(function(){return[[{path:"create_reservation",children:[{path:"",component:Vl},{path:"for_patron/:patron_id",component:Vl},{path:"for_resource/:resource_barcode",component:Vl}]},{path:"manage_reservations",children:[{path:"",component:An},{path:"by_patron/:patron_id",component:An},{path:"by_resource/:resource_barcode",component:An},{path:"by_resource_type/:resource_type_id",component:An}]},{path:"pickup",children:[{path:"",component:Yn},{path:"by_patron/:patron_id",component:Yn}]},{path:"pull_list",component:ae},{path:"return",children:[{path:"",component:ce},{path:"by_patron/:patron_id",component:ce}]}]]}),[])])}))},eXX1:function(l,n,e){"use strict";e.d(n,"a",(function(){return a}));var u=e("8Y7J"),t=e("MWGh");e("9Zsr");class a{constructor(l){this.grid=l,this.onClick=new u.m,this.button=new t.e,this.button.onClick=this.onClick}set disabled(l){this.button&&(this.button.disabled=l)}ngOnInit(){this.grid?(this.button.label=this.label,this.button.action=this.action,this.grid.context.toolbarButtons.push(this.button)):console.warn("GridToolbarButtonComponent needs a [grid]")}}},taEJ:function(l,n,e){"use strict";e.d(n,"a",(function(){return t})),e.d(n,"b",(function(){return i}));var u=e("8Y7J"),t=(e("/xpB"),e("G0yt"),u.ob({encapsulation:2,styles:[],data:{}}));function a(l){return u.Mb(0,[(l()(),u.qb(0,0,null,null,2,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),u.qb(1,0,null,null,1,"div",[["class","alert alert-danger"]],null,null,null,null,null)),(l()(),u.Kb(2,null,["",""])),(l()(),u.qb(3,0,null,null,2,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),u.qb(4,0,null,null,1,"button",[["class","btn btn-success"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==l.component.close()&&u),u}),null,null)),(l()(),u.Kb(-1,null,["OK"]))],null,(function(l,n){l(n,2,0,n.component.dialogBody)}))}function i(l){return u.Mb(0,[u.Ib(671088640,1,{dialogContent:0}),(l()(),u.fb(0,[[1,2],["dialogContent",2]],null,0,null,a))],null,null)}}}]);