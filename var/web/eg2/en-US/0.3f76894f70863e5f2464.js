(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"531C":function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s("OsfI");class r{constructor(e){this.store=e,this.urlCache={}}play(e){e&&this.playUrl(e,e)}playUrl(e,t){this.store.getItem("eg.audio.disable").then(s=>{if(s)return;const r=this.urlCache[e]||"/audio/notifications/"+e.replace(/\./g,"/")+".wav",i=new Audio(r);i.onloadeddata=()=>{this.urlCache[t]=r,i.play(),console.debug("audio: "+r)},this.urlCache[e]||(i.onerror=()=>{e.match(/\./)?(e=e.replace(/\.[^\.]+$/,""),this.playUrl(e,t)):console.warn(`No suitable URL found for path "${t}"`)})})}}},EWr9:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s("cm5s");class r{constructor(e){this.org=e}createUrl(e){const t=e.depth||0,s=e.orgId?this.org.get(e.orgId):this.org.root();return`/opac/extras/unapi?id=tag::U2@${e.target}/${e.id}${e.extras}/${s.shortname()}/${t}&format=${e.format}`}getAsXmlDocument(e){const t=this.createUrl(e);return new Promise((e,s)=>{const r=new XMLHttpRequest;r.onreadystatechange=function(){4===this.readyState&&(200===this.status?e(r.responseXML):s("UNAPI request failed for "+t))},r.open("GET",t,!0),r.send()})}}},LMfH:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("8Y7J");s("OXuP"),s("Osig"),s("iA0r"),s("EQoe");class i{constructor(e,t,s,i){this.net=e,this.pcrud=t,this.store=s,this.anonCache=i,this.idList=[],this.onChange=new r.m,this.store.addLoginSessionKey("basket")}hasRecordId(e){return this.idList.indexOf(Number(e))>-1}recordCount(){return this.idList.length}getRecordIds(){const e=this.store.getLoginSessionItem("basket");return this.idList=[],e?this.anonCache.getItem(e,"recordIds").then(e=>e?(this.idList=e.map(e=>Number(e)),this.idList):this.idList):Promise.resolve(this.idList)}setRecordIds(e){this.idList=e;const t=this.store.getLoginSessionItem("basket");return this.anonCache.setItem(t,"recordIds",this.idList).then(e=>(this.store.setLoginSessionItem("basket",e),this.onChange.emit(this.idList),this.idList))}addRecordIds(e){return 0===(e=e.filter(e=>!this.hasRecordId(e))).length?Promise.resolve(this.idList):this.setRecordIds(this.idList.concat(e.map(e=>Number(e))))}removeRecordIds(e){if(0===this.idList.length)return Promise.resolve(this.idList);const t=this.idList.filter(t=>e.indexOf(Number(t))<0);return this.setRecordIds(t)}removeAllRecordIds(){return this.setRecordIds([])}}},MZHd:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var r=s("531C"),i=s("XFKz");class a{static forRoot(){return{ngModule:a,providers:[i.a,r.a]}}}},MhCk:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{}},"NR/D":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{}},OsfI:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s("8PDw"),i=s("Osig"),a=s("8Y7J");let n=(()=>{class e{constructor(e,t){this.net=e,this.auth=t,this.cache={}}setItem(e,t){if(!this.auth.token())return Promise.reject("Auth required to apply settings");const s={};return s[e]=t,this.net.request("open-ils.actor","open-ils.actor.settings.apply.user_or_ws",this.auth.token(),s).toPromise().then(s=>Number(s)>0?this.cache[e]=t:Promise.reject(`No user or workstation setting type exists for: "${e}".\nCreate a ws/user setting type or use setLocalItem() to store the value locally.`))}getItem(e){return this.getItemBatch([e]).then(t=>t[e])}getItemCached(e){return this.cache[e]}getItemBatchCached(e){const t={};return e.forEach(e=>{e in this.cache&&(t[e]=this.cache[e])}),t}getItemBatch(e){const t={};if(e.forEach(e=>{e in this.cache&&(t[e]=this.cache[e])}),e.length===Object.keys(t).length)return Promise.resolve(t);if(!this.auth.token())return Promise.resolve({});const s=[];return e.forEach(e=>{Object.keys(t).includes(e)||s.push(e)}),new Promise((e,r)=>{this.net.request("open-ils.actor","open-ils.actor.settings.retrieve",s,this.auth.token()).subscribe(e=>{this.cache[e.name]=t[e.name]=e.value},e=>r,()=>e(t))})}removeItem(e){return this.setItem(e,null)}}return e.ngInjectableDef=a.Qb({factory:function(){return new e(a.Rb(i.b),a.Rb(r.a))},token:e,providedIn:"root"}),e})()},Q4dc:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("8Y7J");class i{constructor(){this.offset=0,this.limit=null,this.resultCount=null,this.onChange$=new r.m}reset(){this.resultCount=null,this.offset=0}setLimit(e){e!==this.limit&&(this.limit=e,this.setPage(1))}isFirstPage(){return 0===this.offset}isLastPage(){return this.currentPage()===this.pageCount()}currentPage(){return Math.floor(this.offset/this.limit)+1}increment(){this.setPage(this.currentPage()+1)}decrement(){this.setPage(this.currentPage()-1)}toFirst(){this.isFirstPage()||this.setPage(1)}toLast(){this.isLastPage()||this.setPage(this.pageCount())}setPage(e){this.offset=this.limit*(e-1),this.onChange$.emit(this.offset)}pageCount(){if(null===this.resultCount)return-1;let e=this.resultCount/this.limit;return Math.floor(e)<e&&(e=Math.floor(e)+1),e}pageRange(e,t){const s=Math.floor(t/2);let r=e<=s?1:e-s+1;const i=this.pageCount();return r+t>i&&(r=i-t+1,r<1&&(r=1)),r+t>i&&(t=i),this.pageList().slice(r-1,r-1+t)}pageList(){const e=[];for(let t=1;t<=this.pageCount();t++)e.push(t);return e}rowNumber(e){return this.offset+e+1}}},StZw:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return o}));var r=s("8Y7J"),i=s("SVse"),a=(s("tNQm"),s("G8BM"),r.ob({encapsulation:2,styles:[],data:{}}));function n(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function l(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(e()(),r.fb(16777216,null,null,1,null,n)),r.pb(2,540672,null,0,i.y,[r.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),(e()(),r.fb(0,null,null,0))],(function(e,t){var s=t.component;e(t,2,0,s.ctx,s.template)}),null)}function c(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(e()(),r.qb(1,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),r.Kb(2,null,["",""]))],null,(function(e,t){e(t,2,0,t.component.text)}))}function o(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,4,"span",[["style","display:none"]],null,null,null,null,null)),(e()(),r.fb(16777216,null,null,1,null,l)),r.pb(2,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(16777216,null,null,1,null,c)),r.pb(4,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null)],(function(e,t){var s=t.component;e(t,2,0,s.template),e(t,4,0,!s.template)}),null)}},WZ78:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return p}));var r=s("8Y7J"),i=s("SVse"),a=s("StZw"),n=s("tNQm"),l=s("G8BM"),c=(s("ayJW"),s("cUpR"),r.ob({encapsulation:2,styles:[],data:{}}));function o(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(e()(),r.qb(1,0,null,null,2,null,null,null,null,null,null,null)),(e()(),r.Kb(2,null,[""," - "])),r.Eb(0,i.B,[])],null,(function(e,t){e(t,2,0,r.Lb(t,2,0,r.Cb(t,3).transform(t.parent.parent.context.pfx,0,12)))}))}function h(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(e()(),r.Kb(1,null,["",""]))],null,(function(e,t){e(t,1,0,t.parent.parent.context.pfx)}))}function u(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(e()(),r.fb(16777216,null,null,1,null,o)),r.pb(2,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(16777216,null,null,1,null,h)),r.pb(4,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(0,null,null,0))],(function(e,t){e(t,2,0,t.parent.context.sfx),e(t,4,0,!t.parent.context.sfx)}),null)}function m(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(e()(),r.Kb(1,null,["",""]))],null,(function(e,t){e(t,1,0,t.parent.context.sfx)}))}function f(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(e()(),r.Kb(-1,null,["Evergreen"]))],null,null)}function d(e){return r.Mb(0,[(e()(),r.fb(16777216,null,null,1,null,u)),r.pb(1,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(16777216,null,null,1,null,m)),r.pb(3,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(16777216,null,null,1,null,f)),r.pb(5,16384,null,0,i.p,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.fb(0,null,null,0))],(function(e,t){e(t,1,0,t.context.pfx),e(t,3,0,t.context.sfx),e(t,5,0,!t.context.pfx&&!t.context.sfx)}),null)}function p(e){return r.Mb(0,[r.Ib(402653184,1,{titleString:0}),(e()(),r.fb(0,[["titleStringTmpl",2]],null,0,null,d)),(e()(),r.qb(2,0,null,null,1,"eg-string",[],null,null,null,a.b,a.a)),r.pb(3,114688,[[1,4],["titleString",4]],0,n.a,[r.k,l.a],{template:[0,"template"]},null)],(function(e,t){e(t,3,0,r.Cb(t,1))}),null)}},XFKz:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(){this.assignments=[]}assign(e){const t=[];this.assignments.forEach(s=>{if(s.key===e.key){if(s.ctx===e.ctx)return;s.shadowed=!0}t.unshift(s)}),t.unshift(e),this.assignments=t}compressKeys(e){if(!e.key)return null;let t="";return(e.ctrlKey||e.metaKey)&&(t+="ctrl+"),e.altKey&&(t+="alt+"),e.shiftKey&&(t+="shift+"),t+=e.key.toLowerCase(),t}fire(e){const t=this.compressKeys(e);for(const s in this.assignments)if(t===this.assignments[s].key){const t=this.assignments[s];return console.debug("AccessKey assignment found for "+t.key),setTimeout(t.action,0),void e.preventDefault()}}infoIze(){return this.assignments.map(e=>({key:e.key,desc:e.desc,ctx:e.ctx}))}}},XKii:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var r=s("Cfvw"),i=s("HDdC"),a=s("5+tZ"),n=s("vkgz"),l=s("lJxs");s("cm5s"),s("EWr9"),s("wBwE"),s("Osig"),s("iA0r");const c={mods:"http://www.loc.gov/mods/v3",biblio:"http://open-ils.org/spec/biblio/v1",holdings:"http://open-ils.org/spec/holdings/v1",indexing:"http://open-ils.org/spec/indexing/v1"};class o{constructor(e,t,s){this.displayHighlights={},this.id=Number(e.id()),this.record=e,this.orgId=t,this.orgDepth=s,this.display={},this.attributes={},this.bibCallNumber=null,this.metabibRecords=[]}ingest(){this.compileDisplayFields(),this.compileRecordAttrs(),this.record.creator(Number(this.record.creator())),this.record.editor(Number(this.record.editor()))}compileDisplayFields(){this.record.flat_display_entries().forEach(e=>{"t"===e.multi()?this.display[e.name()]?this.display[e.name()].push(e.value()):this.display[e.name()]=[e.value()]:this.display[e.name()]=e.value()})}compileRecordAttrs(){this.record.mattrs().forEach(e=>{this.attributes[e.attr()]?this.attributes[e.attr()].indexOf(e.value())<0&&this.attributes[e.attr()].push(e.value()):this.attributes[e.attr()]=[e.value()]})}getHoldCount(){if(Number.isInteger(this.holdCount))return Promise.resolve(this.holdCount);let e="open-ils.circ.bre.holds.count",t=this.id;return this.metabibId&&(e="open-ils.circ.mmr.holds.count",t=this.metabibId),this.net.request("open-ils.circ",e,t).toPromise().then(e=>this.holdCount=e)}getBibCallNumber(){return null!==this.bibCallNumber?Promise.resolve(this.bibCallNumber):this.net.request("open-ils.cat","open-ils.cat.biblio.record.marc_cn.retrieve",this.id,null,this.orgId).toPromise().then(e=>{if(e&&e.length>0){const t=Object.keys(e[0])[0];this.bibCallNumber=e[0][t]}else this.bibCallNumber="";return this.bibCallNumber})}}class h{constructor(e,t,s,r,i){this.idl=e,this.net=t,this.org=s,this.unapi=r,this.pcrud=i,this.userCache={}}fetchableBreFields(){return this.idl.classes.bre.fields.filter(e=>!e.virtual&&"marc"!==e.name).map(e=>e.name)}getBibSummary(e,t,s){const i=[].concat(e);return 0===i.length?Object(r.a)([]):this.pcrud.search("bre",{id:i},{flesh:1,flesh_fields:{bre:["flat_display_entries","mattrs"]},select:{bre:this.fetchableBreFields()}},{anonymous:!0}).pipe(Object(a.a)(e=>{const r=new o(e,t,s);return r.net=this.net,r.ingest(),this.getHoldingsSummary(e.id(),t,s).then(e=>(r.holdingsSummary=e,r))}))}getMetabibSummary(e,t,s){const i=[].concat(e);return 0===i.length?Object(r.a)([]):this.pcrud.search("mmr",{id:i},{flesh:1,flesh_fields:{mmr:["source_maps"]}},{anonymous:!0}).pipe(Object(a.a)(e=>this.compileMetabib(e,t,s)))}compileMetabib(e,t,s){const r=e.source_maps().map(e=>e.source()).filter(t=>t!==e.master_record());let a;const l=new i.a(e=>a=e);return this.getBibSummary(e.master_record(),t,s).subscribe(i=>{let l;i.metabibId=Number(e.id()),i.metabibRecords=e.source_maps().map(e=>Number(e.source())),l=r.length>0?this.pcrud.search("mraf",{id:r}).pipe(Object(n.a)(e=>i.record.mattrs().push(e))).toPromise():Promise.resolve(),l.then(()=>{i.compileRecordAttrs(),this.getHoldingsSummary(e.id(),t,s,!0).then(e=>{i.holdingsSummary=e,a.next(i),a.complete()})})}),l}fleshBibUsers(e){const t=[];return e.forEach(e=>{["creator","editor"].forEach(s=>{const r=e[s]();Number.isInteger(r)&&(this.userCache[r]?e[s](this.userCache[r]):t.includes(r)||t.push(r))})}),0===t.length?Promise.resolve():this.pcrud.search("au",{id:t}).pipe(Object(l.a)(t=>{this.userCache[t.id()]=t,e.forEach(e=>{t.id()===e.creator()&&e.creator(t),t.id()===e.editor()&&e.editor(t)})})).toPromise()}getHoldingsSummary(e,t,s,r){const i=[];return this.unapi.getAsXmlDocument({target:r?"mmr":"bre",id:e,extras:"{holdings_xml}",format:"holdings_xml",orgId:t,depth:s}).then(e=>{const t=e.evaluate("/holdings:holdings/holdings:counts/holdings:count",e,e=>c[e]||null,XPathResult.ANY_TYPE,null);let s;for(;s=t.iterateNext();){const e={type:s.getAttribute("type")};["depth","org_unit","transcendant","available","count","unshadow"].forEach(t=>{e[t]=Number(s.getAttribute(t))}),i.push(e)}return i})}}},XN9O:function(e,t,s){"use strict";var r=s("Q4dc");class i{static equals(e,t,s){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(s){if(!s(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}}s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return l})),s.d(t,"b",(function(){return d}));const a=["item_type","item_form","item_lang","audience","audience_group","vr_format","bib_level","lit_form","search_format","icon_format"];var n=function(e){return e[e.PENDING=0]="PENDING",e[e.SEARCHING=1]="SEARCHING",e[e.COMPLETE=2]="COMPLETE",e}({});class l{constructor(e,t,s){this.facetClass=e,this.facetName=t,this.facetValue=s}equals(e){return this.facetClass===e.facetClass&&this.facetName===e.facetName&&this.facetValue===e.facetValue}clone(){return new l(this.facetClass,this.facetName,this.facetValue)}}class c{constructor(){this.ids=[],this.count=0}}class o{reset(){this.value="",this.pivot=null,this.fieldClass="title"}isSearchable(){return""!==this.value&&""!==this.fieldClass}clone(){const e=new o;return e.value=this.value,e.pivot=this.pivot,e.fieldClass=this.fieldClass,e}equals(e){return e.value===this.value&&e.fieldClass===this.fieldClass}}class h{reset(){this.tags=[""],this.values=[""],this.subfields=[""]}isSearchable(){return""!==this.tags[0]&&""!==this.values[0]}clone(){const e=new h;return e.tags=[].concat(this.tags),e.values=[].concat(this.values),e.subfields=[].concat(this.subfields),e}equals(e){return i.equals(e.tags,this.tags)&&i.equals(e.values,this.values)&&i.equals(e.subfields,this.subfields)}}class u{reset(){this.value="",this.queryType=""}isSearchable(){return""!==this.value&&""!==this.queryType}clone(){const e=new u;return e.value=this.value,e.queryType=this.queryType,e}equals(e){return e.value===this.value&&e.queryType===this.queryType}}class m{reset(){this.value="",this.offset=0,this.limit=5}isSearchable(){return""!==this.value&&void 0!==this.value}clone(){const e=new m;return e.value=this.value,e.offset=this.offset,e.limit=this.limit,e}equals(e){return e.value===this.value}}class f{constructor(){this.available=!1}reset(){this.query=[""],this.fieldClass=["keyword"],this.matchOp=["contains"],this.joinOp=[""],this.facetFilters=[],this.copyLocations=[""],this.format="",this.hasBrowseEntry="",this.date1=null,this.date2=null,this.dateOp="is",this.fromMetarecord=null,this.ccvmFilters={},a.forEach(e=>this.ccvmFilters[e]=[""])}clone(){const e=new f;return e.query=[].concat(this.query),e.fieldClass=[].concat(this.fieldClass),e.matchOp=[].concat(this.matchOp),e.joinOp=[].concat(this.joinOp),e.copyLocations=[].concat(this.copyLocations),e.format=this.format,e.hasBrowseEntry=this.hasBrowseEntry,e.date1=this.date1,e.date2=this.date2,e.dateOp=this.dateOp,e.fromMetarecord=this.fromMetarecord,e.facetFilters=this.facetFilters.map(e=>e.clone()),e.ccvmFilters={},Object.keys(this.ccvmFilters).forEach(t=>e.ccvmFilters[t]=this.ccvmFilters[t]),e}equals(e){if(i.equals(e.query,this.query)&&i.equals(e.fieldClass,this.fieldClass)&&i.equals(e.matchOp,this.matchOp)&&i.equals(e.joinOp,this.joinOp)&&i.equals(e.copyLocations,this.copyLocations)&&e.format===this.format&&e.hasBrowseEntry===this.hasBrowseEntry&&e.date1===this.date1&&e.date2===this.date2&&e.dateOp===this.dateOp&&e.fromMetarecord===this.fromMetarecord&&i.equals(e.facetFilters,this.facetFilters,(e,t)=>e.equals(t))&&Object.keys(this.ccvmFilters).length===Object.keys(e.ccvmFilters).length){let t=!1;return Object.keys(this.ccvmFilters).forEach(s=>{i.equals(this.ccvmFilters[s],e.ccvmFilters[s])||(t=!0)}),!t}return!1}isMetarecordSearch(){return this.isSearchable()&&this.groupByMetarecord&&null===this.fromMetarecord}isSearchable(){return""!==this.query[0]||""!==this.hasBrowseEntry||null!==this.fromMetarecord}hasFacet(e){return Boolean(this.facetFilters.filter(t=>t.equals(e))[0])}removeFacet(e){this.facetFilters=this.facetFilters.filter(t=>!t.equals(e))}addFacet(e){this.hasFacet(e)||this.facetFilters.push(e)}toggleFacet(e){this.hasFacet(e)?this.removeFacet(e):this.facetFilters.push(e)}}class d{constructor(){this.searchState=n.PENDING,this.highlightData={},this.pager=new r.a,this.termSearch=new f,this.marcSearch=new h,this.identSearch=new u,this.browseSearch=new o,this.cnBrowseSearch=new m,this.reset()}clone(){const e=new d;return e.sort=this.sort,e.isStaff=this.isStaff,e.global=this.global,e.searchOrg=this.searchOrg,e.termSearch=this.termSearch.clone(),e.marcSearch=this.marcSearch.clone(),e.identSearch=this.identSearch.clone(),e.browseSearch=this.browseSearch.clone(),e.cnBrowseSearch=this.cnBrowseSearch.clone(),e}equals(e){return this.termSearch.equals(e.termSearch)&&this.marcSearch.equals(e.marcSearch)&&this.identSearch.equals(e.identSearch)&&this.browseSearch.equals(e.browseSearch)&&this.cnBrowseSearch.equals(e.cnBrowseSearch)&&this.sort===e.sort&&this.global===e.global}reset(){this.pager.offset=0,this.sort="",this.showBasket=!1,this.result=new c,this.resultIds=[],this.highlightData={},this.searchState=n.PENDING,this.termSearch.reset(),this.marcSearch.reset(),this.identSearch.reset(),this.browseSearch.reset(),this.cnBrowseSearch.reset()}isSearchable(){return this.showBasket||this.termSearch.isSearchable()||this.marcSearch.isSearchable()||this.identSearch.isSearchable()||this.browseSearch.isSearchable()}currentResultIds(){const e=[],t=Math.min(this.pager.offset+this.pager.limit,this.pager.resultCount);for(let s=this.pager.offset;s<t;s++)e.push(this.resultIds[s]);return e}addResultId(e,t){this.resultIds[t+this.pager.offset]=Number(e)}resultIdAt(e){return this.resultIds[e]||null}indexForResult(e){for(let t=0;t<this.resultIds.length;t++)if(this.resultIds[t]===e)return t;return null}compileMarcSearchArgs(){const e=[],t=this.marcSearch;t.values.forEach((s,r)=>{""!==s&&e.push({restrict:[{subfield:t.subfields[r]?t.subfields[r]:"_",tag:t.tags[r]}],term:t.values[r]})});const s={searches:e,limit:this.pager.limit,offset:this.pager.offset,org_unit:this.searchOrg.id()};if(this.sort){const e=this.sort.split(/\./);s.sort=e[0],e[1]&&(s.sort_dir="descending")}return s}compileIdentSearchQuery(){return" site("+this.searchOrg.shortname()+") "+this.identSearch.queryType+":"+this.identSearch.value}compileBoolQuerySet(e){const t=this.termSearch;let s=t.query[e];const r=t.fieldClass[e];let i="";if(!s)return i;switch(e>0&&(i+=" "+t.joinOp[e]+" "),i+="(",r&&(i+=r+":"),t.matchOp[e]){case"phrase":s=this.addQuotes(this.stripQuotes(s));break;case"nocontains":s="-"+this.addQuotes(this.stripQuotes(s));break;case"exact":s="^"+this.stripAnchors(s)+"$";break;case"starts":s=this.addQuotes("^"+this.stripAnchors(this.stripQuotes(s)))}return i+s+")"}stripQuotes(e){return e.replace(/"/g,"")}stripAnchors(e){return e.replace(/[\^\$]/g,"")}addQuotes(e){return e.match(/ /)?'"'+e+'"':e}compileTermSearchQuery(){const e=this.termSearch;let t="";if(e.available&&(t+="#available"),this.sort){const e=this.sort.split(/\./);e[1]&&(t+=" #descending"),t+=" sort("+e[0]+")"}if(e.date1&&e.dateOp)switch(e.dateOp){case"is":t+=` date1(${e.date1})`;break;case"before":t+=` before(${e.date1})`;break;case"after":t+=` after(${e.date1})`;break;case"between":e.date2&&(t+=` between(${e.date1},${e.date2})`)}t.length&&(t+=" ");const s=e.query.length;return s>1&&(t+="("),e.query.forEach((e,s)=>{t+=this.compileBoolQuerySet(s)}),s>1&&(t+=")"),e.hasBrowseEntry&&(t+=` has_browse_entry(${e.hasBrowseEntry})`),e.fromMetarecord&&(t+=` from_metarecord(${e.fromMetarecord})`),e.format&&(t+=" search_format("+e.format+")"),this.global&&(t+=" depth("+this.org.root().ou_type().depth()+")"),""!==e.copyLocations[0]&&(t+=" locations("+e.copyLocations+")"),t+=" site("+this.searchOrg.shortname()+")",Object.keys(e.ccvmFilters).forEach(s=>{""!==e.ccvmFilters[s][0]&&(t+=" "+s+"("+e.ccvmFilters[s]+")")}),e.facetFilters.forEach(e=>{t+=" "+e.facetClass+"|"+e.facetName+"["+e.facetValue+"]"}),t}scrub(e){switch(e){case"term":this.marcSearch.reset(),this.browseSearch.reset(),this.identSearch.reset(),this.cnBrowseSearch.reset(),this.termSearch.hasBrowseEntry="",this.termSearch.browseEntry=null,this.termSearch.fromMetarecord=null,this.termSearch.facetFilters=[];break;case"ident":this.marcSearch.reset(),this.browseSearch.reset(),this.termSearch.reset(),this.cnBrowseSearch.reset();break;case"marc":this.browseSearch.reset(),this.termSearch.reset(),this.identSearch.reset(),this.cnBrowseSearch.reset();break;case"browse":this.marcSearch.reset(),this.termSearch.reset(),this.identSearch.reset(),this.cnBrowseSearch.reset(),this.browseSearch.pivot=null;break;case"cnbrowse":this.marcSearch.reset(),this.termSearch.reset(),this.identSearch.reset(),this.browseSearch.reset(),this.cnBrowseSearch.offset=0}}}},ZqI7:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{}},avZ9:function(e,t,s){"use strict";s("cm5s");var r=s("XN9O");class i{get keys(){return Object.keys(this.params)}constructor(e){this.params=e||{}}has(e){return e in this.params}get(e){return this.has(e)?[].concat(this.params[e])[0]:null}getAll(e){return this.has(e)?[].concat(this.params[e]):[]}}s.d(t,"a",(function(){return a}));class a{constructor(e){this.org=e}toUrlParams(e){const t={};if(e.searchOrg&&(t.org=e.searchOrg.id()),e.pager.limit&&(t.limit=e.pager.limit),e.pager.offset&&(t.offset=e.pager.offset),["limit","offset","sort","global","showBasket","sort"].forEach(s=>{e[s]&&(t[s]=e[s])}),e.marcSearch.isSearchable()){const s=e.marcSearch;t.marcTag=[],t.marcSubfield=[],t.marcValue=[],s.values.forEach((e,r)=>{""!==e&&(t.marcTag.push(s.tags[r]),t.marcSubfield.push(s.subfields[r]),t.marcValue.push(s.values[r]))})}if(e.identSearch.isSearchable()&&(t.identQuery=e.identSearch.value,t.identQueryType=e.identSearch.queryType),e.browseSearch.isSearchable()&&(t.browseTerm=e.browseSearch.value,t.browseClass=e.browseSearch.fieldClass,e.browseSearch.pivot&&(t.browsePivot=e.browseSearch.pivot)),e.termSearch.isSearchable()){const s=e.termSearch;t.query=[],t.fieldClass=[],t.joinOp=[],t.matchOp=[],["format","available","hasBrowseEntry","date1","date2","dateOp","groupByMetarecord","fromMetarecord"].forEach(e=>{s[e]&&(t[e]=s[e])}),s.query.forEach((e,r)=>{""!==e&&(t.query.push(s.query[r]),t.fieldClass.push(s.fieldClass[r]),t.joinOp.push(s.joinOp[r]),t.matchOp.push(s.matchOp[r]))}),Object.keys(s.ccvmFilters).forEach(e=>{s.ccvmFilters[e]&&""!==s.ccvmFilters[e][0]&&(t[e]=s.ccvmFilters[e].join(","))}),s.facetFilters.length&&(t.facets=[],s.facetFilters.forEach(e=>{t.facets.push(JSON.stringify({c:e.facetClass,n:e.facetName,v:e.facetValue}))})),s.copyLocations.length&&""!==s.copyLocations[0]&&(t.copyLocations=s.copyLocations.join(","))}return e.cnBrowseSearch.isSearchable()&&(t.cnBrowseTerm=e.cnBrowseSearch.value,t.cnBrowsePage=e.cnBrowseSearch.offset,t.cnBrowsePageSize=e.cnBrowseSearch.limit),t}fromUrlHash(e){return this.fromUrlParams(new i(e))}fromUrlParams(e){const t=new r.b;return this.applyUrlParams(t,e),t}applyUrlParams(e,t){let s;e.reset(),t.get("org")&&(e.searchOrg=this.org.get(+t.get("org"))),(s=t.get("limit"))&&(e.pager.limit=+s),(s=t.get("offset"))&&(e.pager.offset=+s),(s=t.get("sort"))&&(e.sort=s),(s=t.get("global"))&&(e.global=s),(s=t.get("showBasket"))&&(e.showBasket=s),t.has("marcValue")&&(e.marcSearch.tags=t.getAll("marcTag"),e.marcSearch.subfields=t.getAll("marcSubfield"),e.marcSearch.values=t.getAll("marcValue")),t.has("identQuery")&&(e.identSearch.value=t.get("identQuery"),e.identSearch.queryType=t.get("identQueryType")),t.has("browseTerm")&&(e.browseSearch.value=t.get("browseTerm"),e.browseSearch.fieldClass=t.get("browseClass"),t.has("browsePivot")&&(e.browseSearch.pivot=+t.get("browsePivot"))),t.has("cnBrowseTerm")&&(e.cnBrowseSearch.value=t.get("cnBrowseTerm"),e.cnBrowseSearch.offset=Number(t.get("cnBrowsePage")),e.cnBrowseSearch.limit=Number(t.get("cnBrowsePageSize")));const i=e.termSearch;t.getAll("facets").forEach(e=>{const t=JSON.parse(e);i.addFacet(new r.d(t.c,t.n,t.v))}),t.has("hasBrowseEntry")?i.hasBrowseEntry=t.get("hasBrowseEntry"):t.has("query")&&(["format","available","date1","date2","dateOp","groupByMetarecord","fromMetarecord"].forEach(e=>{t.has(e)&&(i[e]=t.get(e))}),["query","fieldClass","joinOp","matchOp"].forEach(e=>{t.getAll(e),t.has(e)&&(i[e]=t.getAll(e))}),r.a.forEach(e=>{const s=t.get(e);i.ccvmFilters[e]=s?s.split(/,/):[""]}),t.get("copyLocations")&&(i.copyLocations=t.get("copyLocations").split(/,/)))}}},ayJW:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s("tNQm");class r{constructor(e){this.title=e}set prefix(e){this.pfx=e,this.setTitle()}set suffix(e){this.sfx=e,this.setTitle()}ngAfterViewInit(){this.initDone=!0,this.setTitle()}setTitle(){this.initDone&&setTimeout(()=>{this.titleString.current({pfx:this.pfx,sfx:this.sfx}).then(e=>this.title.setTitle(e))})}}},dix8:function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return c}));var r=s("8Y7J"),i=s("WZ78"),a=s("ayJW"),n=s("cUpR"),l=(s("ufrD"),r.ob({encapsulation:2,styles:[],data:{}}));function c(e){return r.Mb(0,[(e()(),r.qb(0,0,null,null,4,"div",[["class","lead alert alert-primary text-center pt-1 pb-1"]],null,null,null,null,null)),(e()(),r.qb(1,0,null,null,1,"eg-title",[],null,null,null,i.b,i.a)),r.pb(2,4243456,null,0,a.a,[n.h],{prefix:[0,"prefix"]},null),(e()(),r.qb(3,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),r.Kb(4,null,["",""]))],(function(e,t){e(t,2,0,t.component.bannerText)}),(function(e,t){e(t,4,0,t.component.bannerText)}))}},"mW9/":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var r=s("8Y7J"),i=s("lJxs"),a=s("vkgz"),n=s("nYR2"),l=(s("cm5s"),s("EWr9"),s("wBwE"),s("Osig"),s("iA0r"),s("XN9O"));s("XKii"),s("LMfH");class c{constructor(e,t,s,i,a,n,l){this.idl=e,this.net=t,this.org=s,this.unapi=i,this.pcrud=a,this.bibService=n,this.basket=l,this.ccvmMap={},this.cmfMap={},this.onSearchComplete=new r.m}search(e){return e.searchState=l.c.SEARCHING,e.showBasket?this.basketSearch(e):e.marcSearch.isSearchable()?this.marcSearch(e):e.identSearch.isSearchable()&&"item_barcode"===e.identSearch.queryType?this.barcodeSearch(e):this.termSearch(e)}barcodeSearch(e){return this.net.request("open-ils.search","open-ils.search.multi_home.bib_ids.by_barcode",e.identSearch.value).toPromise().then(t=>{const s={count:t.length,ids:t.map(e=>[e])};this.applyResultData(e,s),e.searchState=l.c.COMPLETE,this.onSearchComplete.emit(e)})}basketSearch(e){return this.basket.getRecordIds().then(t=>{const s={count:t.length,ids:t.map(e=>[e])};this.applyResultData(e,s),e.searchState=l.c.COMPLETE,this.onSearchComplete.emit(e)})}marcSearch(e){let t="open-ils.search.biblio.marc";e.isStaff&&(t+=".staff");const s=e.compileMarcSearchArgs();return this.net.request("open-ils.search",t,s).toPromise().then(t=>{t.ids=t.ids.map(e=>[e]),this.applyResultData(e,t),e.searchState=l.c.COMPLETE,this.onSearchComplete.emit(e)})}termSearch(e){let t,s="open-ils.search.biblio.multiclass.query";return e.identSearch.isSearchable()?t=e.compileIdentSearchQuery():(t=e.compileTermSearchQuery(),e.termSearch.groupByMetarecord&&!e.termSearch.fromMetarecord&&(s="open-ils.search.metabib.multiclass.query"),e.termSearch.hasBrowseEntry&&this.fetchBrowseEntry(e)),console.debug("search query: "+t),e.isStaff&&(s+=".staff"),this.net.request("open-ils.search",s,{limit:e.pager.limit+1,offset:e.pager.offset},t,!0).toPromise().then(t=>this.applyResultData(e,t)).then(t=>this.fetchFieldHighlights(e)).then(t=>{e.searchState=l.c.COMPLETE,this.onSearchComplete.emit(e)})}fetchBrowseEntry(e){const t=e.termSearch.hasBrowseEntry.split(",");this.pcrud.retrieve("mbe",t[0]).subscribe(t=>e.termSearch.browseEntry=t)}applyResultData(e,t){e.result=t,e.pager.resultCount=t.count,t.records=[],this.lastFacetKey!==t.facet_key&&(e.resultIds=[]),t.ids.forEach((t,s)=>e.addResultId(t[0],s))}fetchBibSummaries(e){const t=e.global?e.org.root().ou_type().depth():e.searchOrg.ou_type().depth(),s=e.termSearch.isMetarecordSearch();let r;return r=s?this.bibService.getMetabibSummary(e.currentResultIds(),e.searchOrg.id(),t):this.bibService.getBibSummary(e.currentResultIds(),e.searchOrg.id(),t),r.pipe(Object(i.a)(t=>{let r;r=s?e.currentResultIds().indexOf(t.metabibId):e.currentResultIds().indexOf(t.id),e.result.records&&(e.result.records[r]=t),e.highlightData[t.id]&&(t.displayHighlights=e.highlightData[t.id])})).toPromise()}fetchFieldHighlights(e){let t,s;return(t=e.result)&&(t=t.global_summary)&&(t=t.query_struct)&&(t=t.additional_data)&&(t=t.highlight_map)&&Object.keys(t).length>0?(e.getHighlightsFor?s=[e.getHighlightsFor]:(s=e.currentResultIds(),e.termSearch.groupByMetarecord&&(s=s.map(t=>e.result.records.filter(e=>t===e.metabibId)[0].id))),this.net.requestWithParamList("open-ils.search","open-ils.search.fetch.metabib.display_field.highlight",[t].concat(s)).pipe(Object(i.a)(t=>{if(0===t.length)return;const s=e.highlightData[t[0].source]={};t.forEach(e=>{const t=this.cmfMap[e.field].display_field_map();t&&("t"===t.multi()?(s[t.name()]||(s[t.name()]=[]),s[t.name()].push(e.highlight)):s[t.name()]=e.highlight)})})).toPromise()):Promise.resolve()}fetchFacets(e){return e.result?e.result.facet_key?this.lastFacetKey===e.result.facet_key?(e.result.facetData=this.lastFacetData,Promise.resolve()):new Promise((t,s)=>{this.net.request("open-ils.search","open-ils.search.facet_cache.retrieve",e.result.facet_key).subscribe(s=>{const r={};Object.keys(s).forEach(e=>{const t=s[e],i=this.cmfMap[e],a=[];Object.keys(t).forEach(e=>{a.push({value:e,count:t[e]})}),r[i.field_class()]||(r[i.field_class()]={}),r[i.field_class()][i.name()]={cmfLabel:i.label(),valueList:a.sort((e,t)=>e.count>t.count?-1:e.count<t.count?1:e.value<t.value?-1:1)}}),this.lastFacetKey=e.result.facet_key,this.lastFacetData=e.result.facetData=r,t()})}):Promise.resolve():Promise.reject("Cannot fetch facets without results")}fetchCcvms(){return Object.keys(this.ccvmMap).length?Promise.resolve():new Promise((e,t)=>{this.pcrud.search("ccvm",{ctype:l.a},{},{atomic:!0,anonymous:!0}).subscribe(t=>{this.compileCcvms(t),e()})})}compileCcvms(e){e.forEach(e=>{this.ccvmMap[e.ctype()]||(this.ccvmMap[e.ctype()]=[]),this.ccvmMap[e.ctype()].push(e)}),Object.keys(this.ccvmMap).forEach(e=>{this.ccvmMap[e]=this.ccvmMap[e].sort((e,t)=>e.value()<t.value()?-1:1)})}iconFormatLabel(e){if(this.ccvmMap){const t=this.ccvmMap.icon_format.filter(t=>t.code()===e)[0];if(t)return t.search_label()}}fetchCmfs(){return Object.keys(this.cmfMap).length?Promise.resolve():new Promise((e,t)=>{this.pcrud.search("cmf",{"-or":[{facet_field:"t"},{display_field:"t"}]},{flesh:1,flesh_fields:{cmf:["display_field_map"]}},{atomic:!0,anonymous:!0}).subscribe(t=>{t.forEach(e=>this.cmfMap[e.id()]=e),e()})})}fetchCopyLocations(e){const t=this.org.fullPath(e,!0);return this.copyLocations=[],this.pcrud.search("acpl",{deleted:"f",opac_visible:"t",owning_lib:t},{order_by:{acpl:"name"}},{anonymous:!0}).pipe(Object(a.a)(e=>this.copyLocations.push(e))).toPromise()}browse(e){e.searchState=l.c.SEARCHING;const t=e.browseSearch;return this.net.request("open-ils.search","open-ils.search.browse.staff",{browse_class:t.fieldClass,term:t.value,limit:e.pager.limit,pivot:t.pivot,org_unit:e.searchOrg.id()}).pipe(Object(a.a)(t=>e.searchState=l.c.COMPLETE),Object(n.a)(()=>this.onSearchComplete.emit(e)))}cnBrowse(e){e.searchState=l.c.SEARCHING;const t=e.cnBrowseSearch;return this.net.request("open-ils.supercat","open-ils.supercat.call_number.browse",t.value,e.searchOrg.shortname(),t.limit,t.offset).pipe(Object(a.a)(t=>e.searchState=l.c.COMPLETE))}}},mrSG:function(e,t,s){"use strict";function r(e,t,s,r){return new(s||(s=Promise))((function(i,a){function n(e){try{c(r.next(e))}catch(t){a(t)}}function l(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new s((function(t){t(e.value)})).then(n,l)}c((r=r.apply(e,t||[])).next())}))}s.d(t,"a",(function(){return r}))},"r2N+":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{}},tNQm:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("mrSG");s("G8BM");class i{constructor(e,t){this.elm=e,this.strings=t,this.elm=e,this.strings=t}ngOnInit(){this.key&&this.strings.register({key:this.key,resolver:e=>this.text?Promise.resolve(this.text):this.current(e)})}current(e){return Object(r.a)(this,void 0,void 0,(function*(){return e&&(this.ctx=e),new Promise(e=>setTimeout(()=>e(this.elm.nativeElement.textContent)))}))}}},ufrD:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{}}}]);