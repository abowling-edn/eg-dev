(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"/xpB":function(l,n,e){"use strict";e.d(n,"a",(function(){return u}));var t=e("rRT/");class u extends t.a{}},"1kwX":function(l,n,e){"use strict";var t=e("8Y7J");e("wBwE"),e("EQDH"),e("Osig"),e("8PDw"),e("cm5s"),e("iA0r"),e("YRS1"),e("OsfI"),e("tNQm");class u{get leader(){return this.record.leader}set leader(l){this.record.leader=l}get fields(){return this.record.fields}set fields(l){this.record.fields=l}constructor(l){this.record=new MARC21.Record({marcxml:l,delimiter:"$"}),this.breakerText=this.record.toBreaker(),this.fixedFieldChange=new t.m}toXml(){return this.record.toXmlString()}toBreaker(){return this.record.toBreaker()}recordType(){return this.record.recordType()}absorbBreakerChanges(){this.record=new MARC21.Record({marcbreaker:this.breakerText,delimiter:"$"})}extractFixedField(l){return this.record.extractFixedField(l)}setFixedField(l,n){const e=this.record.setFixedField(l,n);return this.fixedFieldChange.emit(l),e}stampFieldIds(){this.fields.forEach(l=>this.stampFieldId(l))}stampFieldId(l){l.fieldId||(l.fieldId=Math.floor(1e7*Math.random())),void 0===l.isCtrlField&&(l.isCtrlField=l.isControlfield())}field(l,n){return this.record.field(l,n)}insertFieldsBefore(l,...n){this.record.insertFieldsBefore.apply(this.record,[l].concat(n)),this.stampFieldIds()}insertFieldsAfter(l,...n){this.record.insertFieldsAfter.apply(this.record,[l].concat(n)),this.stampFieldIds()}insertOrderedFields(...l){this.record.insertOrderedFields.apply(this.record,l),this.stampFieldIds()}generate008(){return this.record.generate008()}deleteFields(...l){this.record.deleteFields.apply(this.record,l)}getField(l){return this.fields.filter(n=>n.fieldId===l)[0]}getPreviousField(l){for(let n=0;n<this.fields.length;n++)if(this.fields[n].fieldId===l)return this.fields[n-1]}getNextField(l){for(let n=0;n<this.fields.length;n++)if(this.fields[n].fieldId===l)return this.fields[n+1]}newField(l){const n=new MARC21.Field(l);return this.stampFieldId(n),n}cloneField(l){const n={tag:l.tag};return l.isControlfield()?n.data=l.data:(n.ind1=l.ind1,n.ind2=l.ind2,n.subfields=this.cloneSubfields(l.subfields)),this.newField(n)}cloneSubfields(l){const n=[];return l.forEach(l=>n.push([].concat(l))),n}}e("9rfo"),e("36iw");var i=e("DMNx");e("WC/f"),e.d(n,"a",(function(){return o}));class o{constructor(l,n,e,u,o,s,d,a,r){this.evt=l,this.idl=n,this.net=e,this.auth=u,this.org=o,this.pcrud=s,this.toast=d,this.holdings=a,this.store=r,this.recordType="biblio",this.initCalled=!1,this.sources=[],this.recordSaved=new t.m,this.context=new i.a,this.recordSaved.subscribe(l=>this.dataSaving=!1)}set recordId(l){this.record&&this.record.id===l||(this.initCalled?(this._pendingRecordId=null,this.fromId(l)):this._pendingRecordId=l)}get recordId(){return this.record?this.record.id:this._pendingRecordId}set recordXml(l){l&&this.fromXml(l)}get record(){return this.context.record}ngOnInit(){this.initCalled=!0,this.context.recordType=this.recordType,this.store.getItem("cat.marcedit.flateditor").then(l=>this.editorTab=l?"flat":"rich"),!this.record&&this.recordId&&this.fromId(this.recordId),"biblio"===this.recordType&&this.pcrud.retrieveAll("cbs").subscribe(l=>this.sources.push({id:+l.id(),label:l.source()}),l=>{},()=>{this.sources=this.sources.sort((l,n)=>l.label.toLowerCase()<n.label.toLowerCase()?-1:1),this.recordSource&&this.sourceSelector.applyEntryId(this.recordSource)})}changesPending(){return this.context.changesPending}clearPendingChanges(){this.context.changesPending=!1}tabChange(l){this.context.resetUndos(),"flat"===l.nextId?this.store.setItem("cat.marcedit.flateditor",!0):this.store.removeItem("cat.marcedit.flateditor")}saveRecord(){const l=this.record.toXml();this.dataSaving=!0,this.context.changesPending=!1,this.context.resetUndos();let n=null,e=null;this.sourceSelector&&this.sourceSelector.selected&&(n=this.sourceSelector.selected.label,e=this.sourceSelector.selected.id);const t={marcXml:l,bibSource:e,recordId:this.recordId};if(this.inPlaceMode)return this.recordSaved.emit(t),Promise.resolve();let u;return u=this.record.id?this.modifyRecord(l,n,e):this.createRecord(l,n),u.then(l=>l?(this.successMsg.current().then(l=>this.toast.success(l)),t.marcXml=l,t.recordId=this.recordId,this.recordSaved.emit(t),this.fastAdd(),l):null)}modifyRecord(l,n,e){return this.net.request("open-ils.cat","biblio"===this.recordType?"open-ils.cat.biblio.record.xml.update":"open-ils.cat.authority.record.overlay",this.auth.token(),this.record.id,l,n).toPromise().then(n=>{const e=this.evt.parse(n);return e?(console.error(e),this.failMsg.current().then(l=>this.toast.warning(l)),this.dataSaving=!1,null):"object"==typeof n?n.marc():l})}createRecord(l,n){return this.net.request("open-ils.cat","biblio"===this.recordType?"open-ils.cat.biblio.record.xml.create":"open-ils.cat.authority.record.import",this.auth.token(),l,n).toPromise().then(l=>{const n=this.evt.parse(l);return n?(console.error(n),this.failMsg.current().then(l=>this.toast.warning(l)),this.dataSaving=!1,null):(this.record.id=l.id(),l.marc())})}fromId(l){const n="authority"===this.recordType?"are":"bre";return this.pcrud.retrieve(n,l).toPromise().then(e=>{this.context.record=new u(e.marc()),this.record.id=l,this.record.deleted="t"===e.deleted(),"bre"===n&&e.source()&&this.sourceSelector.applyEntryId(+e.source())})}fromXml(l){this.context.record=new u(l),this.record.id=null}deleteRecord(){return this.confirmDelete.open().toPromise().then(l=>{if(!l)return;let n;return n="authority"===this.recordType?this.deleteAuthorityRecord():this.deleteBibRecord(),n.then(l=>{if(l)return this.fromId(this.record.id).then(l=>{this.recordSaved.emit({marcXml:this.record.toXml(),recordId:this.recordId})})})})}deleteAuthorityRecord(){return this.pcrud.retrieve("are",this.record.id).toPromise().then(l=>this.pcrud.remove(l).toPromise()).then(l=>null!==l)}deleteBibRecord(){return this.net.request("open-ils.cat","open-ils.cat.biblio.record_entry.delete",this.auth.token(),this.record.id).toPromise().then(l=>{const n=this.evt.parse(l);return!n||("RECORD_NOT_EMPTY"===n.textcode?this.cannotDelete.open().toPromise().then(l=>!1):(console.error(n),alert(n),!1))})}undeleteRecord(){return this.confirmUndelete.open().toPromise().then(l=>{if(!l)return;let n;return n="authority"===this.recordType?this.undeleteAuthorityRecord():this.undeleteBibRecord(),n.then(l=>{if(l)return this.fromId(this.record.id).then(l=>{this.recordSaved.emit({marcXml:this.record.toXml(),recordId:this.recordId})})})})}undeleteAuthorityRecord(){return this.pcrud.retrieve("are",this.record.id).toPromise().then(l=>(l.deleted("f"),this.pcrud.update(l).toPromise())).then(l=>null!==l)}undeleteBibRecord(){return this.net.request("open-ils.cat","open-ils.cat.biblio.record_entry.undelete",this.auth.token(),this.record.id).toPromise().then(l=>{const n=this.evt.parse(l);return!n||(console.error(n),alert(n),!1)})}fastAdd(){this.showFastAdd&&this.fastItemLabel&&this.fastItemBarcode&&this.holdings.spawnAddHoldingsUi(this.recordId,null,[{label:this.fastItemLabel,barcode:this.fastItemBarcode,fast_add:!0}])}}},"9u+K":function(l,n,e){"use strict";e.d(n,"a",(function(){return t}));class t{}},DMNx:function(l,n,e){"use strict";e.d(n,"b",(function(){return i})),e.d(n,"a",(function(){return s}));var t=e("8Y7J");class u{}class i extends u{}class o extends u{}class s{constructor(){this.recordType="biblio",this.lastFocused=null,this.undoStack=[],this.redoStack=[],this.recordChange=new t.m,this.fieldFocusRequest=new t.m,this.textUndoRedoRequest=new t.m}set record(l){l!==this._record&&(this._record=l,this._record.stampFieldIds(),this.recordChange.emit(l))}get record(){return this._record}requestFieldFocus(l){l&&setTimeout(()=>this.fieldFocusRequest.emit(l))}resetUndos(){this.undoStack=[],this.redoStack=[]}requestUndo(){let l=null;do{const n=this.undoStack.shift();if(!n)return;null===l&&(l=n.groupSize||1),l--,n.isRedo=!1,this.distributeUndoRedo(n)}while(l>0)}requestRedo(){let l=null;do{const n=this.redoStack.shift();if(!n)return;null===l&&(l=n.groupSize||1),l--,n.isRedo=!0,this.distributeUndoRedo(n)}while(l>0)}stackCount(l){let n=0,e=0;return l.forEach(l=>{if(l.groupSize>1){if(e)return;e=1}else e=0;n++}),n}undoCount(){return this.stackCount(this.undoStack)}redoCount(){return this.stackCount(this.redoStack)}setUndoGroupSize(l){for(let n=0;n<l;n++)this.undoStack[n]&&(this.undoStack[n].groupSize=l)}distributeUndoRedo(l){l instanceof i?this.textUndoRedoRequest.emit(l):this.handleStructuralUndoRedo(l)}addToUndoStack(l){this.changesPending=!0,this.undoStack.unshift(l)}handleStructuralUndoRedo(l){if(l.wasAddition){if(l.subfield){const n=l.subfield[2]-1;l.field.deleteExactSubfields(l.subfield),this.focusSubfield(l.field,n)}else this.record.deleteFields(l.field);this.requestFieldFocus(l.prevFocus)}else{if(l.subfield)this.insertSubfield(l.field,l.subfield,!0),this.focusSubfield(l.field,l.subfield[2]);else{const n=l.position.fieldId,e=this.record.getField(l.prevPosition.fieldId);this.record.insertFieldsAfter(e,l.field),l.field.fieldId=n,this.requestFieldFocus(l.position)}l.prevFocus=this.lastFocused}l.wasAddition=!l.wasAddition,(l.isRedo?this.undoStack:this.redoStack).unshift(l)}trackStructuralUndo(l,n,e){this.redoStack=[];const t={fieldId:l.fieldId,target:"tag"};let u=null;if(e)t.target="sfc",t.sfOffset=e[2];else{const n=this.record.getPreviousField(l.fieldId);n&&(u={fieldId:n.fieldId,target:"tag"})}const i=new o;i.field=l,i.subfield=e,i.wasAddition=n,i.position=t,i.prevPosition=u,i.prevFocus=this.lastFocused,this.addToUndoStack(i)}deleteField(l){this.trackStructuralUndo(l,!1),this.focusNextTag(l)||this.focusPreviousTag(l),this.record.deleteFields(l)}add00X(l){const n=this.record.newField({tag:l,data:"                                        "});this.record.insertOrderedFields(n),this.trackStructuralUndo(n,!0),this.focusTag(n)}insertReplace008(){[].concat(this.record.field("008",!0)).forEach(l=>{this.trackStructuralUndo(l,!1),this.record.deleteFields(l)});const l=this.record.newField({tag:"008",data:this.record.generate008()});this.record.insertOrderedFields(l),this.trackStructuralUndo(l,!0),this.focusTag(l)}insertStubField(l,n){const e=this.record.newField({tag:"999",subfields:[[" ","",0]]});this.insertField(l,e,n)}insertField(l,n,e){e?(this.record.insertFieldsBefore(l,n),this.focusPreviousTag(l)):(this.record.insertFieldsAfter(l,n),this.focusNextTag(l)),this.trackStructuralUndo(n,!0)}insertSubfield(l,n,e){const t=n[2];l.subfields.forEach(l=>{l[2]>=t&&l[2]++}),l.subfields.splice(t,0,n),e||(this.focusSubfield(l,t),this.trackStructuralUndo(l,!0,n))}insertStubSubfield(l,n){this.insertSubfield(l,[" ","",n])}focusSubfield(l,n){const e={fieldId:l.fieldId,target:"tag"};n>=0&&(e.target="sfc",e.sfOffset=n),this.requestFieldFocus(e)}deleteSubfield(l,n){const e=n[2]-1;this.trackStructuralUndo(l,!1,n),l.deleteExactSubfields(n),this.focusSubfield(l,e)}focusTag(l){this.requestFieldFocus({fieldId:l.fieldId,target:"tag"})}focusNextTag(l){const n=this.record.getNextField(l.fieldId);return!!n&&(this.focusTag(n),!0)}focusPreviousTag(l){const n=this.record.getPreviousField(l.fieldId);return!!n&&(this.focusTag(n),!0)}}},F4VR:function(l,n,e){"use strict";var t=e("8Y7J"),u=e("s7LF"),i=e("nUl2"),o=e("9rfo"),s=e("OXuP"),d=e("wBwE"),a=e("iA0r"),r=e("SVse"),c=e("RvO3"),b=e("TxlL"),f=e("G0yt"),h=e("m9Ce");let p=(()=>{class l extends f.S{constructor(l,n,e,u,i,o,s,d,a,r,c){super(l,n,e,u,i,o,s,d,a,r),this.menuService=c,this.triggers="contextmenu",this.popoverClass="eg-context-menu",this.menuEntries=[],this.menuItemSelected=new t.m,this.menuService.menuItemSelected.subscribe(l=>{this.activeMenuIsMe()&&(this.menuItemSelected.emit(l),this.cleanup())})}set egContextMenu(l){this.menuEntries=l}activeMenuIsMe(){return this.menu&&this.menuService.activeMenu&&this.menu.id===this.menuService.activeMenu.id}cleanup(){l.activeDirective&&(l.activeDirective.close(),l.activeDirective=null,this.menuService.activeMenu=null)}open(){this.cleanup(),this.menuEntries&&0!==this.menuEntries.length&&(this.menu=new h.a,this.menu.id=l.menuId++,this.menu.entries=this.menuEntries,this.menuService.activeMenu=this.menu,this.menuService.showMenuRequest.emit(this.menu),this.ngbPopover=this.menuService.menuTemplate,l.activeDirective=this,super.open())}}return l.menuId=0,l})();var g=e("StZw"),m=e("tNQm"),C=e("G8BM"),x=e("pLZG"),v=e("DMNx");class q{constructor(l){this.renderer=l,this.fieldType=null,this.fieldText=null,this.bigText=!1,this.randId=Math.floor(1e5*Math.random()),this.maxLength=null,this.ffValues=[],this.tagMenuEntries=[]}get record(){return this.context.record}tt(){return this.context.tagTable}ngOnInit(){this.setupFieldType()}ngOnDestroy(){this.focusSub&&this.focusSub.unsubscribe(),this.undoRedoSub&&this.undoRedoSub.unsubscribe()}watchForFocusRequests(){this.focusSub=this.context.fieldFocusRequest.pipe(Object(x.a)(l=>this.focusRequestIsMe(l))).subscribe(l=>this.selectText(l))}watchForUndoRedoRequests(){this.undoRedoSub=this.context.textUndoRedoRequest.pipe(Object(x.a)(l=>this.focusRequestIsMe(l.position))).subscribe(l=>this.processUndoRedo(l))}focusRequestIsMe(l){if(l.target!==this.fieldType)return!1;if(this.field){if(l.fieldId!==this.field.fieldId)return!1}else{if("ldr"===l.target)return this.isLeader;if("ffld"===l.target&&l.ffCode!==this.fixedFieldCode)return!1}return void 0===l.sfOffset||l.sfOffset===this.subfield[2]}selectText(l){this.bigText?this.focusBigText():this.editInput.select(),l?l.newText&&this.setContent(l.newText):l={fieldId:this.field?this.field.fieldId:-1,target:this.fieldType,sfOffset:this.subfield?this.subfield[2]:void 0,ffCode:this.fixedFieldCode},this.context.lastFocused=l}setupFieldType(){const l=this.getContent();switch(this.undoBackToText=l,this.fieldType){case"ldr":this.isLeader=!0,l&&(this.maxLength=l.length),this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;case"tag":this.maxLength=3,this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;case"cfld":this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;case"ffld":this.applyFFOptions(),this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;case"ind1":case"ind2":case"sfc":this.maxLength=1,this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;case"sfv":this.bigText=!0,this.watchForFocusRequests(),this.watchForUndoRedoRequests();break;default:this.fieldText&&(this.maxLength=this.fieldText.length)}}applyFFOptions(){return this.tt().getFfFieldMeta(this.fixedFieldCode).then(l=>{l&&(this.maxLength=l.length||1)})}contextMenuEntries(){if(!this.isLeader){switch(this.fieldType){case"tag":return this.tagContextMenuEntries();case"sfc":return this.tt().getSubfieldCodes(this.field.tag);case"sfv":return this.tt().getSubfieldValues(this.field.tag,this.subfield[0]);case"ind1":case"ind2":return this.tt().getIndicatorValues(this.field.tag,this.fieldType);case"ffld":return this.tt().getFfValues(this.fixedFieldCode)}return null}}tagContextMenuEntries(){return this.tagMenuEntries.length>0||!this.add006Str||(this.tagMenuEntries.push({label:this.add006Str.text,value:"_add006"},{label:this.add007Str.text,value:"_add007"},{label:this.add008Str.text,value:"_add008"}),this.field.isCtrlField||this.tagMenuEntries.push({label:this.insertAfterStr.text,value:"_insertAfter"},{label:this.insertBeforeStr.text,value:"_insertBefore"}),this.tagMenuEntries.push({label:this.deleteFieldStr.text,value:"_deleteField"},{divider:!0}),this.tt().getFieldTags().forEach(l=>this.tagMenuEntries.push(l))),this.tagMenuEntries}getContent(){if(this.fieldText)return this.fieldText;switch(this.fieldType){case"ldr":return this.record.leader;case"cfld":return this.field.data;case"tag":return this.field.tag;case"sfc":return this.subfield[0];case"sfv":return this.subfield[1];case"ind1":return this.field.ind1;case"ind2":return this.field.ind2;case"ffld":return void 0!==this.ffValue&&this.context.lastFocused&&this.focusRequestIsMe(this.context.lastFocused)||(this.ffValue=this.record.extractFixedField(this.fixedFieldCode)),this.ffValue}return"X"}setContent(l,n,e){if(!this.fieldText){switch(this.fieldType){case"ldr":this.record.leader=l;break;case"cfld":this.field.data=l;break;case"tag":this.field.tag=l;break;case"sfc":this.subfield[0]=l;break;case"sfv":this.subfield[1]=l;break;case"ind1":this.field.ind1=l;break;case"ind2":this.field.ind2=l;break;case"ffld":this.ffValue=l,this.record.setFixedField(this.fixedFieldCode,l)}n&&this.bigText&&(this.editInput.innerText=l),e||this.trackTextChangeForUndo(l)}}trackTextChangeForUndo(l){this.context.redoStack=[];const n=this.context.undoStack[0];if(n&&n instanceof v.b&&n.textContent===this.undoBackToText&&this.focusRequestIsMe(n.position))return;const e=new v.b;e.position=this.context.lastFocused,e.textContent=this.undoBackToText,this.context.addToUndoStack(e)}processUndoRedo(l){const n=this.getContent();this.setContent(l.textContent,!0,!0),l.textContent=n,(l.isRedo?this.context.undoStack:this.context.redoStack).unshift(l)}inputBlurred(){this.undoBackToText=this.getContent()}bigTextValueChange(){this.setContent(this.editInput.innerText)}ngAfterViewInit(){this.editInput=this.renderer.selectRootElement(`[id='${this.randId}']`),this.editInput.innerText=this.getContent()}inputSize(){return this.maxLength?this.maxLength+1:1.1*Math.max(2,(this.getContent()||"").length)}focusBigText(){const l=this.editInput.firstChild;if(!l)return;const n=document.createRange();n.setStart(l,0),n.setEnd(l,l.length);const e=window.getSelection();e.removeAllRanges(),e.addRange(n)}inputKeyDown(l){switch(l.key){case"y":return void(l.ctrlKey&&(this.context.requestRedo(),l.preventDefault()));case"z":return void(l.ctrlKey&&(this.context.requestUndo(),l.preventDefault()));case"F6":return void(l.shiftKey&&(this.context.add00X("006"),l.preventDefault(),l.stopPropagation()));case"F7":return void(l.shiftKey&&(this.context.add00X("007"),l.preventDefault(),l.stopPropagation()));case"F8":return void(l.shiftKey&&(this.context.insertReplace008(),l.preventDefault(),l.stopPropagation()))}if("ldr"!==this.fieldType&&"ffld"!==this.fieldType)switch(l.key){case"Enter":l.ctrlKey&&this.context.insertStubField(this.field,l.shiftKey),l.preventDefault();break;case"Delete":l.ctrlKey?(this.context.deleteField(this.field),l.preventDefault()):l.shiftKey&&(this.subfield&&this.context.deleteSubfield(this.field,this.subfield),l.preventDefault());break;case"ArrowDown":l.ctrlKey?this.context.insertField(this.field,this.record.cloneField(this.field)):this.context.focusNextTag(this.field),l.preventDefault();break;case"ArrowUp":l.ctrlKey?this.context.insertField(this.field,this.record.cloneField(this.field),!0):this.context.focusPreviousTag(this.field),l.preventDefault();break;case"d":case"i":l.ctrlKey&&(this.context.insertStubSubfield(this.field,this.subfield?this.subfield[2]+1:0),l.preventDefault())}}insertField(l){const n=this.record.newField({tag:"999",subfields:[[" ","",0]]});l?this.record.insertFieldsBefore(this.field,n):this.record.insertFieldsAfter(this.field,n),this.context.requestFieldFocus({fieldId:n.fieldId,target:"tag"})}deleteField(){this.context.focusNextTag(this.field)||this.context.focusPreviousTag(this.field),this.record.deleteFields(this.field)}deleteSubfield(){const l=this.subfield[2]-1;this.field.deleteExactSubfields(this.subfield);const n={fieldId:this.field.fieldId,target:"tag"};l>=0&&(n.target="sfv",n.sfOffset=l),this.context.requestFieldFocus(n)}contextMenuChange(l){switch(l){case"_add006":return this.context.add00X("006");case"_add007":return this.context.add00X("007");case"_add008":return this.context.insertReplace008();case"_insertBefore":return this.context.insertStubField(this.field,!0);case"_insertAfter":return this.context.insertStubField(this.field);case"_deleteField":return this.context.deleteField(this.field)}this.setContent(l,!0),this.context.requestFieldFocus(this.context.lastFocused)}isAuthInvalid(){return"sfv"===this.fieldType&&this.field.authChecked&&!this.field.authValid}isAuthValid(){return"sfv"===this.fieldType&&this.field.authChecked&&this.field.authValid}isLastSubfieldValue(){if("sfv"===this.fieldType){const l=this.subfield[2];for(let n=0;n<this.field.subfields.length;n++)if(n>l)return!1;return!0}return!1}}var T=t.ob({encapsulation:0,styles:[["div[contenteditable][_ngcontent-%COMP%]{min-width:2em;border:1px solid #ced4da;min-height:calc(1.5em + .75rem + 2px)}.sf-delimiter[_ngcontent-%COMP%]{color:#00f!important;margin-right:-.5rem}.sf-code[_ngcontent-%COMP%]{color:#00f!important}.auth-invalid[_ngcontent-%COMP%]{color:red!important}"]],data:{}});function y(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,null,null,null,null,null,null,null)),(l()(),t.qb(1,16777216,null,null,4,"div",[["contenteditable",""],["spellcheck","false"]],[[8,"id",0],[1,"tabindex",0],[1,"aria-label",0]],[[null,"menuItemSelected"],[null,"keydown"],[null,"focus"],[null,"blur"],[null,"input"]],(function(l,n,e){var t=!0,u=l.component;return"menuItemSelected"===n&&(t=!1!==u.contextMenuChange(e.value)&&t),"keydown"===n&&(t=!1!==u.inputKeyDown(e)&&t),"focus"===n&&(t=!1!==u.selectText()&&t),"blur"===n&&(t=!1!==u.inputBlurred()&&t),"input"===n&&(t=!1!==u.bigTextValueChange()&&t),t}),null,null)),t.Hb(512,null,r.N,r.O,[t.r,t.s,t.k,t.C]),t.pb(3,278528,null,0,r.n,[r.N],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.Fb(4,{"auth-invalid":0}),t.pb(5,737280,null,0,p,[t.k,t.C,t.q,t.j,t.N,f.T,t.y,r.e,t.h,t.g,h.b],{egContextMenu:[0,"egContextMenu"]},{menuItemSelected:"menuItemSelected"}),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component,u=t.ub(1,"d-inline-block text-dark text-break ",e.moreClasses,""),i=l(n,4,0,e.isAuthInvalid());l(n,3,0,u,i),l(n,5,0,e.contextMenuEntries())}),(function(l,n){var e=n.component;l(n,1,0,t.ub(1,"",e.randId,""),e.fieldText?-1:"0",e.ariaLabel)}))}function L(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,12,null,null,null,null,null,null,null)),(l()(),t.qb(1,16777216,null,null,11,"input",[["spellcheck","false"]],[[8,"id",0],[8,"size",0],[1,"tabindex",0],[1,"aria-label",0],[1,"maxlength",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"menuItemSelected"],[null,"keydown"],[null,"focus"],[null,"blur"],[null,"ngModelChange"],[null,"input"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,5)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,5).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,5)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,5)._compositionEnd(e.target.value)&&u),"menuItemSelected"===n&&(u=!1!==i.contextMenuChange(e.value)&&u),"keydown"===n&&(u=!1!==i.inputKeyDown(e)&&u),"focus"===n&&(u=!1!==i.selectText()&&u),"blur"===n&&(u=!1!==i.inputBlurred()&&u),"ngModelChange"===n&&(u=!1!==i.setContent(e)&&u),u}),null,null)),t.Hb(512,null,r.N,r.O,[t.r,t.s,t.k,t.C]),t.pb(3,278528,null,0,r.n,[r.N],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.Fb(4,{"auth-invalid":0}),t.pb(5,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.pb(6,540672,null,0,u.m,[],{maxlength:[0,"maxlength"]},null),t.Hb(1024,null,u.n,(function(l){return[l]}),[u.m]),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.d]),t.pb(9,671744,null,0,u.t,[[8,null],[6,u.n],[8,null],[6,u.o]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(11,16384,null,0,u.q,[[4,u.p]],null,null),t.pb(12,737280,null,0,p,[t.k,t.C,t.q,t.j,t.N,f.T,t.y,r.e,t.h,t.g,h.b],{egContextMenu:[0,"egContextMenu"]},{menuItemSelected:"menuItemSelected"}),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component,u=t.ub(1,"text-dark rounded-0 form-control ",e.moreClasses,""),i=l(n,4,0,e.isAuthInvalid());l(n,3,0,u,i),l(n,6,0,e.maxLength||""),l(n,9,0,e.fieldText,e.getContent()),l(n,12,0,e.contextMenuEntries())}),(function(l,n){var e=n.component;l(n,1,1,[t.ub(1,"",e.randId,""),e.inputSize(),e.fieldText?-1:"0",e.ariaLabel,t.Cb(n,6).maxlength?t.Cb(n,6).maxlength:null,t.Cb(n,11).ngClassUntouched,t.Cb(n,11).ngClassTouched,t.Cb(n,11).ngClassPristine,t.Cb(n,11).ngClassDirty,t.Cb(n,11).ngClassValid,t.Cb(n,11).ngClassInvalid,t.Cb(n,11).ngClassPending])}))}function F(l){return t.Mb(0,[t.Ib(671088640,1,{add006Str:0}),t.Ib(671088640,2,{add007Str:0}),t.Ib(671088640,3,{add008Str:0}),t.Ib(671088640,4,{insertBeforeStr:0}),t.Ib(671088640,5,{insertAfterStr:0}),t.Ib(671088640,6,{deleteFieldStr:0}),(l()(),t.qb(6,0,null,null,1,"eg-string",[["text","Add 006"]],null,null,null,g.b,g.a)),t.pb(7,114688,[[1,4],["add006",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(8,0,null,null,1,"eg-string",[["text","Add 007"]],null,null,null,g.b,g.a)),t.pb(9,114688,[[2,4],["add007",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(10,0,null,null,1,"eg-string",[["text","Add/Replace 008"]],null,null,null,g.b,g.a)),t.pb(11,114688,[[3,4],["add008",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(12,0,null,null,1,"eg-string",[["text","Insert Field Before"]],null,null,null,g.b,g.a)),t.pb(13,114688,[[4,4],["insertBefore",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(14,0,null,null,1,"eg-string",[["text","Insert Field After"]],null,null,null,g.b,g.a)),t.pb(15,114688,[[5,4],["insertAfter",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(16,0,null,null,1,"eg-string",[["text","Delete Field"]],null,null,null,g.b,g.a)),t.pb(17,114688,[[6,4],["deleteField",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.fb(16777216,null,null,1,null,y)),t.pb(19,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,L)),t.pb(21,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,7,0,"Add 006"),l(n,9,0,"Add 007"),l(n,11,0,"Add/Replace 008"),l(n,13,0,"Insert Field Before"),l(n,15,0,"Insert Field After"),l(n,17,0,"Delete Field"),l(n,19,0,e.bigText),l(n,21,0,!e.bigText)}),null)}class S{constructor(){this.randId=Math.floor(1e7*Math.random())}get record(){return this.context.record}ngOnInit(){this.init().then(l=>this.context.recordChange.subscribe(l=>this.init()))}init(){return this.record?this.context.tagTable.getFfFieldMeta(this.fieldCode).then(l=>this.fieldMeta=l):Promise.resolve()}}var I=t.ob({encapsulation:0,styles:[["[_nghost-%COMP%] .popover{font-family:'Lucida Console',Monaco,monospace;max-width:550px}[_nghost-%COMP%] .popover-body{max-height:400px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%] .popover-body .menu-entry{white-space:nowrap}[_nghost-%COMP%] .popover-body .menu-entry:hover{background-color:#f8f9fa}"]],data:{}});function k(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,7,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,6,"div",[["class","d-flex"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,2,"div",[["class","flex-4"]],null,null,null,null,null)),(l()(),t.qb(3,0,null,null,1,"span",[["class","text-left font-weight-bold"]],[[8,"id",0]],null,null,null,null)),(l()(),t.Kb(4,null,[" "," "])),(l()(),t.qb(5,0,null,null,2,"div",[["class","flex-5"]],null,null,null,null,null)),(l()(),t.qb(6,0,null,null,1,"eg-marc-editable-content",[["fieldType","ffld"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(7,4440064,null,0,q,[t.C],{context:[0,"context"],fieldType:[1,"fieldType"],fixedFieldCode:[2,"fixedFieldCode"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null)],(function(l,n){var e=n.component;l(n,7,0,e.context,"ffld",e.fieldCode,"p-1",e.fieldLabel)}),(function(l,n){var e=n.component;l(n,3,0,t.ub(1,"label-",e.randId,"")),l(n,4,0,e.fieldLabel)}))}function M(l){return t.Mb(0,[(l()(),t.fb(16777216,null,null,1,null,k)),t.pb(1,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){l(n,1,0,n.component.fieldMeta)}),null)}var w=e("cm5s"),R=e("r7vI");class _{constructor(l,n,e){this.idl=l,this.org=n,this.tagTable=e}get record(){return this.context.record}ngOnInit(){}}var K=t.ob({encapsulation:2,styles:[],data:{}});function P(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,1,"eg-fixed-field",[["fieldCode","Type"],["fieldLabel","Type"]],null,null,null,M,I)),t.pb(3,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(4,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(5,0,null,null,1,"eg-fixed-field",[["fieldCode","ELvl"],["fieldLabel","ELvl"]],null,null,null,M,I)),t.pb(6,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(7,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(8,0,null,null,1,"eg-fixed-field",[["fieldCode","Source"],["fieldLabel","Source"]],null,null,null,M,I)),t.pb(9,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(10,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(11,0,null,null,1,"eg-fixed-field",[["fieldCode","Audn"],["fieldLabel","Audn"]],null,null,null,M,I)),t.pb(12,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(13,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(14,0,null,null,1,"eg-fixed-field",[["fieldCode","Ctrl"],["fieldLabel","Ctrl"]],null,null,null,M,I)),t.pb(15,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(16,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(17,0,null,null,1,"eg-fixed-field",[["fieldCode","Lang"],["fieldLabel","Lang"]],null,null,null,M,I)),t.pb(18,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(19,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(20,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(21,0,null,null,1,"eg-fixed-field",[["fieldCode","BLvl"],["fieldLabel","BLvl"]],null,null,null,M,I)),t.pb(22,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(23,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(24,0,null,null,1,"eg-fixed-field",[["fieldCode","Form"],["fieldLabel","Form"]],null,null,null,M,I)),t.pb(25,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(26,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(27,0,null,null,1,"eg-fixed-field",[["fieldCode","Conf"],["fieldLabel","Conf"]],null,null,null,M,I)),t.pb(28,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(29,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(30,0,null,null,1,"eg-fixed-field",[["fieldCode","Biog"],["fieldLabel","Biog"]],null,null,null,M,I)),t.pb(31,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(32,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(33,0,null,null,1,"eg-fixed-field",[["fieldCode","MRec"],["fieldLabel","MRec"]],null,null,null,M,I)),t.pb(34,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(35,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(36,0,null,null,1,"eg-fixed-field",[["fieldCode","Ctry"],["fieldLabel","Ctry"]],null,null,null,M,I)),t.pb(37,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(38,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(39,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(40,0,null,null,1,"eg-fixed-field",[["fieldCode","s_l"],["fieldLabel","s_l"]],null,null,null,M,I)),t.pb(41,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(42,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(43,0,null,null,1,"eg-fixed-field",[["fieldCode","Cont"],["fieldLabel","Cont"]],null,null,null,M,I)),t.pb(44,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(45,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(46,0,null,null,1,"eg-fixed-field",[["fieldCode","GPub"],["fieldLabel","GPub"]],null,null,null,M,I)),t.pb(47,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(48,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(49,0,null,null,1,"eg-fixed-field",[["fieldCode","LitF"],["fieldLabel","LitF"]],null,null,null,M,I)),t.pb(50,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(51,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(52,0,null,null,1,"eg-fixed-field",[["fieldCode","Indx"],["fieldLabel","Indx"]],null,null,null,M,I)),t.pb(53,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(54,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(55,0,null,null,1,"eg-fixed-field",[["fieldCode","Alph"],["fieldLabel","Alph"]],null,null,null,M,I)),t.pb(56,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(57,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(58,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(59,0,null,null,1,"eg-fixed-field",[["fieldCode","Desc"],["fieldLabel","Desc"]],null,null,null,M,I)),t.pb(60,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(61,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(62,0,null,null,1,"eg-fixed-field",[["fieldCode","Ills"],["fieldLabel","Ills"]],null,null,null,M,I)),t.pb(63,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(64,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(65,0,null,null,1,"eg-fixed-field",[["fieldCode","Fest"],["fieldLabel","Fest"]],null,null,null,M,I)),t.pb(66,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(67,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(68,0,null,null,1,"eg-fixed-field",[["fieldCode","DtSt"],["fieldLabel","DtSt"]],null,null,null,M,I)),t.pb(69,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(70,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(71,0,null,null,1,"eg-fixed-field",[["fieldCode","Date1"],["fieldLabel","Date1"]],null,null,null,M,I)),t.pb(72,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(73,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(74,0,null,null,1,"eg-fixed-field",[["fieldCode","Date2"],["fieldLabel","Date2"]],null,null,null,M,I)),t.pb(75,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(76,0,null,null,15,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(77,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(78,0,null,null,1,"eg-fixed-field",[["fieldCode","SrTp"],["fieldLabel","SrTp"]],null,null,null,M,I)),t.pb(79,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(80,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(81,0,null,null,1,"eg-fixed-field",[["fieldCode","Regl"],["fieldLabel","Regl"]],null,null,null,M,I)),t.pb(82,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(83,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(84,0,null,null,1,"eg-fixed-field",[["fieldCode","Orig"],["fieldLabel","Orig"]],null,null,null,M,I)),t.pb(85,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(86,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(87,0,null,null,1,"eg-fixed-field",[["fieldCode","Freq"],["fieldLabel","Freq"]],null,null,null,M,I)),t.pb(88,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(89,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(90,0,null,null,1,"eg-fixed-field",[["fieldCode","EntW"],["fieldLabel","EntW"]],null,null,null,M,I)),t.pb(91,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(92,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(93,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(94,0,null,null,1,"eg-fixed-field",[["fieldCode","TrAr"],["fieldLabel","TrAr"]],null,null,null,M,I)),t.pb(95,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(96,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(97,0,null,null,1,"eg-fixed-field",[["fieldCode","Part"],["fieldLabel","Part"]],null,null,null,M,I)),t.pb(98,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(99,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(100,0,null,null,1,"eg-fixed-field",[["fieldCode","LTxt"],["fieldLabel","LTxt"]],null,null,null,M,I)),t.pb(101,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(102,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(103,0,null,null,1,"eg-fixed-field",[["fieldCode","FMus"],["fieldLabel","FMus"]],null,null,null,M,I)),t.pb(104,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(105,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(106,0,null,null,1,"eg-fixed-field",[["fieldCode","AccM"],["fieldLabel","AccM"]],null,null,null,M,I)),t.pb(107,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(108,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(109,0,null,null,1,"eg-fixed-field",[["fieldCode","Comp"],["fieldLabel","Comp"]],null,null,null,M,I)),t.pb(110,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(111,0,null,null,12,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(112,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(113,0,null,null,1,"eg-fixed-field",[["fieldCode","SpFm"],["fieldLabel","SpFm"]],null,null,null,M,I)),t.pb(114,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(115,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(116,0,null,null,1,"eg-fixed-field",[["fieldCode","Relf"],["fieldLabel","Relf"]],null,null,null,M,I)),t.pb(117,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(118,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(119,0,null,null,1,"eg-fixed-field",[["fieldCode","Proj"],["fieldLabel","Proj"]],null,null,null,M,I)),t.pb(120,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(121,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(122,0,null,null,1,"eg-fixed-field",[["fieldCode","CrTp"],["fieldLabel","CrTp"]],null,null,null,M,I)),t.pb(123,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(124,0,null,null,12,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(125,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(126,0,null,null,1,"eg-fixed-field",[["fieldCode","TMat"],["fieldLabel","TMat"]],null,null,null,M,I)),t.pb(127,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(128,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(129,0,null,null,1,"eg-fixed-field",[["fieldCode","Time"],["fieldLabel","Time"]],null,null,null,M,I)),t.pb(130,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(131,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(132,0,null,null,1,"eg-fixed-field",[["fieldCode","Tech"],["fieldLabel","Tech"]],null,null,null,M,I)),t.pb(133,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(134,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(135,0,null,null,1,"eg-fixed-field",[["fieldCode","File"],["fieldLabel","File"]],null,null,null,M,I)),t.pb(136,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(137,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(138,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(139,0,null,null,1,"eg-fixed-field",[["fieldCode","Type_tbmfhd"],["fieldLabel","Type_tbmfhd"]],null,null,null,M,I)),t.pb(140,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(141,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(142,0,null,null,1,"eg-fixed-field",[["fieldCode","ELvl_tbmfhd"],["fieldLabel","ELvl_tbmfhd"]],null,null,null,M,I)),t.pb(143,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(144,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(145,0,null,null,1,"eg-fixed-field",[["fieldCode","Item_tbmfhd"],["fieldLabel","Item_tbmfhd"]],null,null,null,M,I)),t.pb(146,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(147,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(148,0,null,null,1,"eg-fixed-field",[["fieldCode","GeoDiv"],["fieldLabel","GeoDiv"]],null,null,null,M,I)),t.pb(149,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(150,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(151,0,null,null,1,"eg-fixed-field",[["fieldCode","Roman"],["fieldLabel","Roman"]],null,null,null,M,I)),t.pb(152,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(153,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(154,0,null,null,1,"eg-fixed-field",[["fieldCode","CatLang"],["fieldLabel","CatLang"]],null,null,null,M,I)),t.pb(155,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(156,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(157,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(158,0,null,null,1,"eg-fixed-field",[["fieldCode","Kind"],["fieldLabel","Kind"]],null,null,null,M,I)),t.pb(159,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(160,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(161,0,null,null,1,"eg-fixed-field",[["fieldCode","Rules"],["fieldLabel","Rules"]],null,null,null,M,I)),t.pb(162,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(163,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(164,0,null,null,1,"eg-fixed-field",[["fieldCode","Subj"],["fieldLabel","Subj"]],null,null,null,M,I)),t.pb(165,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(166,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(167,0,null,null,1,"eg-fixed-field",[["fieldCode","Series"],["fieldLabel","Series"]],null,null,null,M,I)),t.pb(168,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(169,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(170,0,null,null,1,"eg-fixed-field",[["fieldCode","SerNum"],["fieldLabel","SerNum"]],null,null,null,M,I)),t.pb(171,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(172,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(173,0,null,null,1,"eg-fixed-field",[["fieldCode","NameUse"],["fieldLabel","NameUse"]],null,null,null,M,I)),t.pb(174,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(175,0,null,null,18,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(176,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(177,0,null,null,1,"eg-fixed-field",[["fieldCode","SubjUse"],["fieldLabel","SubjUse"]],null,null,null,M,I)),t.pb(178,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(179,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(180,0,null,null,1,"eg-fixed-field",[["fieldCode","SerUse"],["fieldLabel","SerUse"]],null,null,null,M,I)),t.pb(181,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(182,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(183,0,null,null,1,"eg-fixed-field",[["fieldCode","TypeSubd"],["fieldLabel","TypeSubd"]],null,null,null,M,I)),t.pb(184,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(185,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(186,0,null,null,1,"eg-fixed-field",[["fieldCode","GovtAgn"],["fieldLabel","GovtAgn"]],null,null,null,M,I)),t.pb(187,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(188,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(189,0,null,null,1,"eg-fixed-field",[["fieldCode","RefStatus"],["fieldLabel","RefStatus"]],null,null,null,M,I)),t.pb(190,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(191,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(192,0,null,null,1,"eg-fixed-field",[["fieldCode","UpdStatus"],["fieldLabel","UpdStatus"]],null,null,null,M,I)),t.pb(193,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(194,0,null,null,9,"div",[["class","row p-0"]],null,null,null,null,null)),(l()(),t.qb(195,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(196,0,null,null,1,"eg-fixed-field",[["fieldCode","Name"],["fieldLabel","Name"]],null,null,null,M,I)),t.pb(197,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(198,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(199,0,null,null,1,"eg-fixed-field",[["fieldCode","Status"],["fieldLabel","Status"]],null,null,null,M,I)),t.pb(200,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null),(l()(),t.qb(201,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),t.qb(202,0,null,null,1,"eg-fixed-field",[["fieldCode","ModRec"],["fieldLabel","ModRec"]],null,null,null,M,I)),t.pb(203,114688,null,0,S,[],{fieldCode:[0,"fieldCode"],fieldLabel:[1,"fieldLabel"],context:[2,"context"]},null)],(function(l,n){var e=n.component;l(n,3,0,"Type","Type",e.context),l(n,6,0,"ELvl","ELvl",e.context),l(n,9,0,"Source","Source",e.context),l(n,12,0,"Audn","Audn",e.context),l(n,15,0,"Ctrl","Ctrl",e.context),l(n,18,0,"Lang","Lang",e.context),l(n,22,0,"BLvl","BLvl",e.context),l(n,25,0,"Form","Form",e.context),l(n,28,0,"Conf","Conf",e.context),l(n,31,0,"Biog","Biog",e.context),l(n,34,0,"MRec","MRec",e.context),l(n,37,0,"Ctry","Ctry",e.context),l(n,41,0,"s_l","s_l",e.context),l(n,44,0,"Cont","Cont",e.context),l(n,47,0,"GPub","GPub",e.context),l(n,50,0,"LitF","LitF",e.context),l(n,53,0,"Indx","Indx",e.context),l(n,56,0,"Alph","Alph",e.context),l(n,60,0,"Desc","Desc",e.context),l(n,63,0,"Ills","Ills",e.context),l(n,66,0,"Fest","Fest",e.context),l(n,69,0,"DtSt","DtSt",e.context),l(n,72,0,"Date1","Date1",e.context),l(n,75,0,"Date2","Date2",e.context),l(n,79,0,"SrTp","SrTp",e.context),l(n,82,0,"Regl","Regl",e.context),l(n,85,0,"Orig","Orig",e.context),l(n,88,0,"Freq","Freq",e.context),l(n,91,0,"EntW","EntW",e.context),l(n,95,0,"TrAr","TrAr",e.context),l(n,98,0,"Part","Part",e.context),l(n,101,0,"LTxt","LTxt",e.context),l(n,104,0,"FMus","FMus",e.context),l(n,107,0,"AccM","AccM",e.context),l(n,110,0,"Comp","Comp",e.context),l(n,114,0,"SpFm","SpFm",e.context),l(n,117,0,"Relf","Relf",e.context),l(n,120,0,"Proj","Proj",e.context),l(n,123,0,"CrTp","CrTp",e.context),l(n,127,0,"TMat","TMat",e.context),l(n,130,0,"Time","Time",e.context),l(n,133,0,"Tech","Tech",e.context),l(n,136,0,"File","File",e.context),l(n,140,0,"Type_tbmfhd","Type_tbmfhd",e.context),l(n,143,0,"ELvl_tbmfhd","ELvl_tbmfhd",e.context),l(n,146,0,"Item_tbmfhd","Item_tbmfhd",e.context),l(n,149,0,"GeoDiv","GeoDiv",e.context),l(n,152,0,"Roman","Roman",e.context),l(n,155,0,"CatLang","CatLang",e.context),l(n,159,0,"Kind","Kind",e.context),l(n,162,0,"Rules","Rules",e.context),l(n,165,0,"Subj","Subj",e.context),l(n,168,0,"Series","Series",e.context),l(n,171,0,"SerNum","SerNum",e.context),l(n,174,0,"NameUse","NameUse",e.context),l(n,178,0,"SubjUse","SubjUse",e.context),l(n,181,0,"SerUse","SerUse",e.context),l(n,184,0,"TypeSubd","TypeSubd",e.context),l(n,187,0,"GovtAgn","GovtAgn",e.context),l(n,190,0,"RefStatus","RefStatus",e.context),l(n,193,0,"UpdStatus","UpdStatus",e.context),l(n,197,0,"Name","Name",e.context),l(n,200,0,"Status","Status",e.context),l(n,203,0,"ModRec","ModRec",e.context)}),null)}var D=e("iInd"),O=e("1kwX"),A=e("EQDH"),N=e("Osig"),E=e("8PDw"),U=e("YRS1"),B=e("WC/f"),V=e("OsfI"),$=e("rRT/");class H extends $.a{constructor(l,n,e,t,u){super(l),this.modal=l,this.auth=n,this.org=e,this.pcrud=t,this.net=u,this.recordType="biblio"}ngOnInit(){}handleRecordSaved(l){this.close(l)}}var z=t.ob({encapsulation:2,styles:[],data:{}});function X(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["MARC Editor"])),(l()(),t.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.close()&&t),t}),null,null)),(l()(),t.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[""])),(l()(),t.qb(6,0,null,null,2,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),t.qb(7,0,null,null,1,"eg-marc-editor",[],null,[[null,"recordSaved"]],(function(l,n,e){var t=!0;return"recordSaved"===n&&(t=!1!==l.component.handleRecordSaved(e)&&t),t}),pn,nn)),t.pb(8,114688,[["marcEditor",4]],0,O.a,[A.a,d.a,N.b,E.a,w.a,a.a,U.a,B.a,V.a],{recordType:[0,"recordType"],recordXml:[1,"recordXml"]},{recordSaved:"recordSaved"})],(function(l,n){var e=n.component;l(n,8,0,e.recordType,e.recordXml)}),null)}function j(l){return t.Mb(0,[t.Ib(671088640,1,{dialogContent:0}),(l()(),t.fb(0,[[1,2],["dialogContent",2]],null,0,null,X))],null,null)}var G=e("Q4dc");class J extends $.a{constructor(l,n,e,t,u){super(l),this.modal=l,this.auth=n,this.org=e,this.pcrud=t,this.net=u,this.thesauri=null,this.controlSet=null,this.browseData=[],this.showAs="heading",this.selectedSubfields=[]}ngOnInit(){this.pager||(this.pager=new G.a,this.pager.limit=5),this.onOpen$.subscribe(l=>this.initData())}fieldHash(l){return l||(l=this.bibField),{tag:l.tag,ind1:l.ind1,ind2:l.ind2,subfields:l.subfields.map(l=>[l[0],l[1]])}}initData(){this.pager.offset=0,this.org.settings(["cat.marc_control_number_identifier"]).then(l=>{this.cni=l["cat.marc_control_number_identifier"]||"Set cat.marc_control_number_identifier in Library Settings"}),this.pcrud.search("acsbf",{tag:this.bibField.tag},{flesh:1,flesh_fields:{acsbf:["authority_field"]}},{atomic:!0,anonymous:!0}).subscribe(l=>{if(0===l.length)return;let n;n=this.controlSet?l.filter(l=>this.controlSet===+l.authority_field().control_set()):l[0],n&&(this.authMeta=n.authority_field(),this.bibField.subfields.forEach(l=>this.selectedSubfields[l[0]]=this.isControlledBibSf(l[0]))),this.getPage(0)})}getPage(l){this.browseData=[],l>0?this.pager.offset++:l<0?this.pager.offset--:this.pager.offset=0;const n=this.fieldHash();n.subfields=n.subfields.filter(l=>this.selectedSubfields[l[0]]),0!==n.subfields.length&&this.net.request("open-ils.cat","open-ils.cat.authority.bib_field.linking_browse",n,this.pager.limit,this.pager.offset,this.thesauri).subscribe(l=>this.browseData.push(l))}applyHeading(l,n){this.net.request("open-ils.cat","open-ils.cat.authority.bib_field.overlay_authority",this.fieldHash(),this.fieldHash(l),this.controlSet).subscribe(l=>{n&&this.setSubfieldZero(n,l),this.close(l)})}isControlledBibSf(l){return!!this.authMeta&&this.authMeta.sf_list().includes(l)}setSubfieldZero(l,n){n||(n=this.bibField);const e=n.subfields.filter(l=>"0"===l[0])[0];e&&this.context.deleteSubfield(n,e),this.context.insertSubfield(n,["0",`(${this.cni})${l}`,n.subfields.length]),n.authChecked=null,n.authValid=null}createNewAuthority(l){this.net.request("open-ils.cat",l?"open-ils.cat.authority.record.create_from_bib.readonly":"open-ils.cat.authority.record.create_from_bib",this.fieldHash(),this.cni,this.auth.token()).subscribe(n=>{l?(this.marcEditDialog.recordXml=n,this.marcEditDialog.open({size:"xl"}).subscribe(l=>{l&&l.recordId&&this.setSubfieldZero(l.recordId),this.close()})):(this.setSubfieldZero(n.id()),this.close())})}}var Q=t.ob({encapsulation:2,styles:[],data:{}});function W(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,"span",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"span",[["class","text-danger"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[""])),(l()(),t.Kb(3,null,[""," "," "]))],null,(function(l,n){l(n,3,0,n.context.$implicit[0],n.context.$implicit[1])}))}function Y(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Kb(1,null,[""," "," ",""])),(l()(),t.fb(16777216,null,null,1,null,W)),t.pb(3,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){l(n,3,0,n.context.field.subfields)}),(function(l,n){l(n,1,0,n.context.field.tag,n.context.field.ind1,n.context.field.ind2)}))}function Z(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Kb(1,null,["See From: ",""]))],null,(function(l,n){l(n,1,0,n.parent.parent.context.field.heading)}))}function ll(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Kb(1,null,["See Also: ",""]))],null,(function(l,n){l(n,1,0,n.parent.parent.context.field.heading)}))}function nl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Kb(1,null,["",""]))],null,(function(l,n){l(n,1,0,n.parent.parent.context.field.heading)}))}function el(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,6,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,Z)),t.pb(2,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,ll)),t.pb(4,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,nl)),t.pb(6,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){l(n,2,0,n.parent.context.from),l(n,4,0,n.parent.context.also),l(n,6,0,!n.parent.context.from&&!n.parent.context.also)}),null)}function tl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function ul(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,tl)),t.pb(2,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(3,{field:0}),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=l(n,3,0,n.parent.context.field);l(n,2,0,e,t.Cb(n.parent.parent,2))}),null)}function il(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,"button",[["class","btn btn-sm p-1 mr-1"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.applyHeading(l.context.field,l.context.authId)&&t),t}),null,null)),t.Hb(512,null,r.N,r.O,[t.r,t.s,t.k,t.C]),t.pb(2,278528,null,0,r.n,[r.N],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.Fb(3,{"btn-outline-primary":0,"btn-outline-info":1}),(l()(),t.Kb(-1,null,["Apply"])),(l()(),t.fb(16777216,null,null,1,null,el)),t.pb(6,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,ul)),t.pb(8,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component,t=l(n,3,0,!(n.context.from||n.context.also),n.context.from||n.context.also);l(n,2,0,"btn btn-sm p-1 mr-1",t),l(n,6,0,"heading"==e.showAs),l(n,8,0,"marc"==e.showAs)}),null)}function ol(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,11,"div",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,10,"div",[["class","form-check form-check-inline"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,5,"input",[["class","form-check-input"],["type","checkbox"]],[[8,"id",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"],[null,"blur"]],(function(l,n,e){var u=!0,i=l.component;return"change"===n&&(u=!1!==t.Cb(l,3).onChange(e.target.checked)&&u),"blur"===n&&(u=!1!==t.Cb(l,3).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(i.selectedSubfields[l.context.$implicit[0]]=e)&&u),"change"===n&&(u=!1!==i.getPage(i.pager.offset)&&u),u}),null,null)),t.pb(3,16384,null,0,u.b,[t.C,t.k],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.b]),t.pb(5,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(7,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(8,0,null,null,1,"span",[["class","text-danger"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[""])),(l()(),t.qb(10,0,null,null,1,"label",[["class","form-check-label"]],[[8,"htmlFor",0]],null,null,null,null)),(l()(),t.Kb(11,null,[" "," "," "]))],(function(l,n){var e=n.component;l(n,5,0,!e.isControlledBibSf(n.context.$implicit[0]),e.selectedSubfields[n.context.$implicit[0]])}),(function(l,n){l(n,2,0,t.ub(1,"search-subfield-",n.context.$implicit[0],""),t.Cb(n,7).ngClassUntouched,t.Cb(n,7).ngClassTouched,t.Cb(n,7).ngClassPristine,t.Cb(n,7).ngClassDirty,t.Cb(n,7).ngClassValid,t.Cb(n,7).ngClassInvalid,t.Cb(n,7).ngClassPending),l(n,10,0,t.ub(1,"search-subfield-",n.context.$implicit[0],"")),l(n,11,0,n.context.$implicit[0],n.context.$implicit[1])}))}function sl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function dl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function al(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,"ul",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,3,"li",[["class","mt-1"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,dl)),t.pb(3,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(4,{field:0,from:1})],(function(l,n){var e=l(n,4,0,n.context.$implicit,!0);l(n,3,0,e,t.Cb(n.parent.parent.parent,5))}),null)}function rl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function cl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,"ul",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,3,"li",[["class","mt-1"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,rl)),t.pb(3,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(4,{field:0,also:1})],(function(l,n){var e=l(n,4,0,n.context.$implicit,!0);l(n,3,0,e,t.Cb(n.parent.parent.parent,5))}),null)}function bl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,13,"ul",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,8,"li",[["class","d-flex mt-1"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,3,"div",[["class","flex-1"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,sl)),t.pb(4,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(5,{field:0,authId:1}),(l()(),t.qb(6,0,null,null,3,"div",[["class","font-italic"]],null,null,null,null,null)),(l()(),t.qb(7,0,null,null,2,"a",[["target","_blank"]],[[8,"title",0],[1,"target",0],[8,"href",4]],[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Cb(l,8).onClick(e.button,e.ctrlKey,e.metaKey,e.shiftKey)&&u),u}),null,null)),t.pb(8,671744,null,0,D.n,[D.l,D.a,r.m],{target:[0,"target"],routerLink:[1,"routerLink"]},null),(l()(),t.Kb(9,null,[" #"," "])),(l()(),t.fb(16777216,null,null,1,null,al)),t.pb(11,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.fb(16777216,null,null,1,null,cl)),t.pb(13,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=l(n,5,0,n.context.$implicit.main_heading,n.context.$implicit.authority_id);l(n,4,0,e,t.Cb(n.parent.parent,5)),l(n,8,0,"_blank",t.ub(1,"/staff/cat/authority/edit/",n.context.$implicit.authority_id,"")),l(n,11,0,n.context.$implicit.see_froms),l(n,13,0,n.context.$implicit.see_alsos)}),(function(l,n){l(n,7,0,t.ub(1,"Authority Record ID ",n.context.$implicit.authority_id,""),t.Cb(n,8).target,t.Cb(n,8).href),l(n,9,0,n.context.$implicit.authority_id)}))}function fl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Manage Authority Links"])),(l()(),t.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.close()&&t),t}),null,null)),(l()(),t.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[""])),(l()(),t.qb(6,0,null,null,45,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),t.qb(7,0,null,null,13,"div",[["class","row border-bottom border-secondary p-2 d-flex"]],null,null,null,null,null)),(l()(),t.qb(8,0,null,null,4,"div",[["class","flex-1 font-weight-bold p-1 pl-2 pt-2 ml-2"]],null,null,null,null,null)),(l()(),t.qb(9,0,null,null,1,"div",[],null,null,null,null,null)),(l()(),t.Kb(10,null,[""," "," ",""])),(l()(),t.fb(16777216,null,null,1,null,ol)),t.pb(12,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.qb(13,0,null,null,7,"div",[["class","ml-2 p-1"]],null,null,null,null,null)),(l()(),t.qb(14,0,null,null,1,"div",[["class","mb-1"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Create new authority from this field"])),(l()(),t.qb(16,0,null,null,4,"div",[],null,null,null,null,null)),(l()(),t.qb(17,0,null,null,1,"button",[["class","btn btn-outline-info"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.createNewAuthority()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Immediately"])),(l()(),t.qb(19,0,null,null,1,"button",[["class","btn btn-outline-info ml-2"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.createNewAuthority(!0)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Create and Edit"])),(l()(),t.qb(21,0,null,null,28,"div",[["class","row border-bottom border-secondary p-2 d-flex"]],null,null,null,null,null)),(l()(),t.qb(22,0,null,null,6,"div",[["class","flex-1"]],null,null,null,null,null)),(l()(),t.qb(23,0,null,null,1,"button",[["class","btn btn-outline-dark"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.getPage(0)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Start"])),(l()(),t.qb(25,0,null,null,1,"button",[["class","btn btn-outline-dark ml-2"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.getPage(-1)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Previous"])),(l()(),t.qb(27,0,null,null,1,"button",[["class","btn btn-outline-dark ml-2"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.getPage(1)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Next"])),(l()(),t.qb(29,0,null,null,20,"div",[["class","pt-2 mb-2"]],null,null,null,null,null)),(l()(),t.qb(30,0,null,null,9,"div",[["class","form-check form-check-inline"]],null,null,null,null,null)),(l()(),t.qb(31,0,null,null,6,"input",[["class","form-check-input"],["id","show-as-heading"],["name","show-as-heading"],["type","radio"],["value","heading"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,32)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,32).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,32)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,32)._compositionEnd(e.target.value)&&u),"change"===n&&(u=!1!==t.Cb(l,33).onChange()&&u),"blur"===n&&(u=!1!==t.Cb(l,33).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(i.showAs=e)&&u),u}),null,null)),t.pb(32,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.pb(33,212992,null,0,u.w,[t.C,t.k,u.D,t.q],{name:[0,"name"],value:[1,"value"]},null),t.Hb(1024,null,u.o,(function(l,n){return[l,n]}),[u.d,u.w]),t.pb(35,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(37,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(38,0,null,null,1,"label",[["class","form-check-label"],["for","show-as-heading"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Show As Heading"])),(l()(),t.qb(40,0,null,null,9,"div",[["class","form-check form-check-inline"]],null,null,null,null,null)),(l()(),t.qb(41,0,null,null,6,"input",[["class","form-check-input"],["id","show-as-marc"],["name","show-as-heading"],["type","radio"],["value","marc"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,42)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,42).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,42)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,42)._compositionEnd(e.target.value)&&u),"change"===n&&(u=!1!==t.Cb(l,43).onChange()&&u),"blur"===n&&(u=!1!==t.Cb(l,43).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(i.showAs=e)&&u),u}),null,null)),t.pb(42,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.pb(43,212992,null,0,u.w,[t.C,t.k,u.D,t.q],{name:[0,"name"],value:[1,"value"]},null),t.Hb(1024,null,u.o,(function(l,n){return[l,n]}),[u.d,u.w]),t.pb(45,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(47,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(48,0,null,null,1,"label",[["class","form-check-label"],["for","show-as-marc"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Show As MARC"])),(l()(),t.fb(16777216,null,null,1,null,bl)),t.pb(51,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=n.component;l(n,12,0,e.bibField.subfields),l(n,33,0,"show-as-heading","heading"),l(n,35,0,"show-as-heading",e.showAs),l(n,43,0,"show-as-heading","marc"),l(n,45,0,"show-as-heading",e.showAs),l(n,51,0,e.browseData)}),(function(l,n){var e=n.component;l(n,10,0,e.bibField.tag,e.bibField.ind1,e.bibField.ind2),l(n,23,0,0==e.pager.offset),l(n,31,0,t.Cb(n,37).ngClassUntouched,t.Cb(n,37).ngClassTouched,t.Cb(n,37).ngClassPristine,t.Cb(n,37).ngClassDirty,t.Cb(n,37).ngClassValid,t.Cb(n,37).ngClassInvalid,t.Cb(n,37).ngClassPending),l(n,41,0,t.Cb(n,47).ngClassUntouched,t.Cb(n,47).ngClassTouched,t.Cb(n,47).ngClassPristine,t.Cb(n,47).ngClassDirty,t.Cb(n,47).ngClassValid,t.Cb(n,47).ngClassInvalid,t.Cb(n,47).ngClassPending)}))}function hl(l){return t.Mb(0,[t.Ib(671088640,1,{dialogContent:0}),t.Ib(671088640,2,{marcEditDialog:0}),(l()(),t.fb(0,[["fieldAsMarc",2]],null,0,null,Y)),(l()(),t.qb(3,0,null,null,1,"eg-marc-editor-dialog",[["recordType","authority"]],null,null,null,j,z)),t.pb(4,114688,[[2,4],["marcEditDialog",4]],0,H,[f.E,E.a,w.a,a.a,N.b],{recordType:[0,"recordType"]},null),(l()(),t.fb(0,[["headingField",2]],null,0,null,il)),(l()(),t.fb(0,[[1,2],["dialogContent",2]],null,0,null,fl))],(function(l,n){l(n,4,0,"authority")}),null)}class pl extends $.a{constructor(l,n,e){super(l),this.modal=l,this.idl=n,this.pcrud=e,this.fieldData="",this.selectorLabel=null,this.selectorOptions=[],this.typeMap=[],this.sfMap={},this.valueMap={},this.step=0,this.slotOffset=0,this.slotSize=1}ngOnInit(){this.onOpen$.subscribe(l=>{this.initialValue=this.fieldData,this.reset()})}splitFieldData(){const l=this.fieldData;return[l.substring(0,this.slotOffset),l.substring(this.slotOffset,this.slotOffset+this.slotSize),l.substring(this.slotOffset+this.slotSize)]}setValuesForStep(){let l;return l=0===this.step?this.getPhysCharTypeMap():this.currentSubfield().then(l=>this.getPhysCharValueMap(l.id())),l.then(l=>{this.selectorOptions=l,this.setSelectedOptionFromField(),this.setLabelForStep()})}setLabelForStep(){0===this.step?this.selectorLabel=null:this.currentSubfield().then(l=>this.selectorLabel=l.label())}getStepSlot(){return 0===this.step?Promise.resolve([0,1]):this.currentSubfield().then(l=>[l.start_pos(),l.length()])}setSelectedOptionFromField(){this.getStepSlot().then(l=>{this.slotOffset=l[0],this.slotSize=l[1],this.selectorValue=String.prototype.substr.apply(this.fieldData,l)||" "})}isLastStep(){return this.currentPtype&&this.sfMap[this.currentPtype]&&this.sfMap[this.currentPtype].length===this.step}selectorChanged(){0===this.step?(this.currentPtype=this.selectorValue,this.fieldData=this.selectorValue):this.getStepSlot().then(l=>{let n=this.fieldData;const e=l[0],t=l[1];for(;n.length<e+t;)n+=" ";const u=n.substr(0,e);this.fieldData=u+this.selectorValue.padEnd(t," "),this.slotOffset=e,this.slotSize=t})}next(){this.step++,this.setValuesForStep()}prev(){this.step--,this.setValuesForStep()}currentSubfield(){return this.getPhysCharSubfieldMap(this.currentPtype).then(l=>l[this.step-1])}reset(l){this.step=0,this.slotOffset=0,this.slotSize=1,this.fieldData=l?" ":this.initialValue,this.currentPtype=this.fieldData.substr(0,1),this.setValuesForStep()}getPhysCharTypeMap(){return this.typeMap.length?Promise.resolve(this.typeMap):this.pcrud.retrieveAll("cmpctm",{order_by:{cmpctm:"label"}},{atomic:!0}).toPromise().then(l=>this.typeMap=l.map(l=>({id:l.ptype_key(),label:l.label()})))}getPhysCharSubfieldMap(l){return this.sfMap[l]?Promise.resolve(this.sfMap[l]):this.pcrud.search("cmpcsm",{ptype_key:l},{order_by:{cmpcsm:["start_pos"]}},{atomic:!0}).toPromise().then(n=>this.sfMap[l]=n)}getPhysCharValueMap(l){return this.valueMap[l]?Promise.resolve(this.valueMap[l]):this.pcrud.search("cmpcvm",{ptype_subfield:l},{order_by:{cmpcsm:["value"]}},{atomic:!0}).toPromise().then(n=>this.valueMap[l]=n.map(l=>({id:l.value(),label:l.label()})))}}var gl=t.ob({encapsulation:2,styles:[],data:{}});function ml(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(l()(),t.Kb(-1,null,["Category of Material"]))],null,null)}function Cl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,null,null,null,null,null,null,null)),(l()(),t.Kb(1,null,["",""]))],null,(function(l,n){l(n,1,0,n.component.selectorLabel)}))}function xl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,"option",[],null,null,null,null,null)),t.pb(1,147456,null,0,u.u,[t.k,t.C,[2,u.z]],{ngValue:[0,"ngValue"]},null),t.pb(2,147456,null,0,u.F,[t.k,t.C,[8,null]],{ngValue:[0,"ngValue"]},null),(l()(),t.Kb(3,null,["",": ",""]))],(function(l,n){l(n,1,0,n.context.$implicit.id),l(n,2,0,n.context.$implicit.id)}),(function(l,n){l(n,3,0,n.context.$implicit.id,n.context.$implicit.label)}))}function vl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Physical Characteristics Wizard"])),(l()(),t.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.close()&&t),t}),null,null)),(l()(),t.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[""])),(l()(),t.qb(6,0,null,null,39,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),t.qb(7,0,null,null,14,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),t.qb(8,0,null,null,1,"label",[["class","col-lg-4 col-form-label"],["for","007-value"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["007 Value"])),(l()(),t.qb(10,0,null,null,6,"div",[["class","col-lg-5 well-table"]],null,null,null,null,null)),(l()(),t.qb(11,0,null,null,5,"div",[["class","well-value"]],null,null,null,null,null)),(l()(),t.qb(12,0,null,null,4,"pre",[["class","pb-0 mb-0 pt-1"]],null,null,null,null,null)),(l()(),t.Kb(13,null,["",""])),(l()(),t.qb(14,0,null,null,1,"span",[["class","text-danger"]],null,null,null,null,null)),(l()(),t.Kb(15,null,["",""])),(l()(),t.Kb(16,null,["",""])),(l()(),t.qb(17,0,null,null,4,"div",[["class","col-lg-3 d-flex"]],null,null,null,null,null)),(l()(),t.qb(18,0,null,null,1,"button",[["class","btn btn-outline-dark m-1 p-1 flex-1"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.reset()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Reset"])),(l()(),t.qb(20,0,null,null,1,"button",[["class","btn btn-outline-dark m-1 p-1 flex-1"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.reset(!0)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Clear"])),(l()(),t.qb(22,0,null,null,23,"div",[["class","form-group row"]],null,null,null,null,null)),(l()(),t.qb(23,0,null,null,4,"label",[["class","col-lg-4 col-form-label"],["for","value-selector"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,ml)),t.pb(25,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,Cl)),t.pb(27,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(28,0,null,null,12,"div",[["class","col-lg-5"]],null,null,null,null,null)),(l()(),t.qb(29,0,null,null,11,"select",[["class","form-control"],["id","value-selector"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"],[null,"blur"]],(function(l,n,e){var u=!0,i=l.component;return"change"===n&&(u=!1!==t.Cb(l,30).onChange(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,30).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(i.selectorValue=e)&&u),"change"===n&&(u=!1!==i.selectorChanged()&&u),u}),null,null)),t.pb(30,16384,null,0,u.z,[t.C,t.k],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.z]),t.pb(32,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(34,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(35,0,null,null,3,"option",[["value"," "]],null,null,null,null,null)),t.pb(36,147456,null,0,u.u,[t.k,t.C,[2,u.z]],{value:[0,"value"]},null),t.pb(37,147456,null,0,u.F,[t.k,t.C,[8,null]],{value:[0,"value"]},null),(l()(),t.Kb(-1,null,["<Unset>"])),(l()(),t.fb(16777216,null,null,1,null,xl)),t.pb(40,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.qb(41,0,null,null,4,"div",[["class","col-lg-3 d-flex"]],null,null,null,null,null)),(l()(),t.qb(42,0,null,null,1,"button",[["class","btn btn-outline-dark flex-1 m-1 p-1"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.prev()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Previous"])),(l()(),t.qb(44,0,null,null,1,"button",[["class","btn btn-outline-dark flex-1 m-1 p-1"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.next()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Next"])),(l()(),t.qb(46,0,null,null,4,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),t.qb(47,0,null,null,1,"button",[["class","btn btn-success"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0,u=l.component;return"click"===n&&(t=!1!==u.close(u.fieldData)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Apply"])),(l()(),t.qb(49,0,null,null,1,"button",[["class","btn btn-warning"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.close()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Cancel"]))],(function(l,n){var e=n.component;l(n,25,0,!e.selectorLabel),l(n,27,0,e.selectorLabel),l(n,32,0,e.selectorValue),l(n,36,0," "),l(n,37,0," "),l(n,40,0,e.selectorOptions)}),(function(l,n){var e=n.component;l(n,13,0,e.splitFieldData()[0]),l(n,15,0,e.splitFieldData()[1]),l(n,16,0,e.splitFieldData()[2]),l(n,29,0,t.Cb(n,34).ngClassUntouched,t.Cb(n,34).ngClassTouched,t.Cb(n,34).ngClassPristine,t.Cb(n,34).ngClassDirty,t.Cb(n,34).ngClassValid,t.Cb(n,34).ngClassInvalid,t.Cb(n,34).ngClassPending),l(n,42,0,0===e.step),l(n,44,0,e.isLastStep())}))}function ql(l){return t.Mb(0,[t.Ib(671088640,1,{dialogContent:0}),(l()(),t.fb(0,[[1,2],["dialogContent",2]],null,0,null,vl))],null,null)}class Tl{constructor(l,n,e,t,u){this.idl=l,this.net=n,this.org=e,this.store=t,this.tagTable=u,this.randId=Math.floor(1e5*Math.random()),this.controlledBibTags=[]}get record(){return this.context.record}ngOnInit(){this.store.getItem("cat.marcedit.stack_subfields").then(l=>this.stackSubfields=l),this.init().then(l=>this.context.recordChange.subscribe(l=>this.init())),this.record.fixedFieldChange.pipe(Object(x.a)(l=>"Type"===l)).subscribe(l=>this.init())}init(){return this.dataLoaded=!1,this.record?Promise.all([this.tagTable.loadTags({marcRecordType:this.context.recordType,ffType:this.record.recordType()}).then(l=>this.context.tagTable=l),this.tagTable.getControlledBibTags().then(l=>this.controlledBibTags=l),this.fetchSettings()]).then(l=>setTimeout(()=>this.dataLoaded=!0)):Promise.resolve()}fetchSettings(){return this.org.settings(["cat.marc_control_number_identifier"])}stackSubfieldsChange(){this.stackSubfields?this.store.setItem("cat.marcedit.stack_subfields",!0):this.store.removeItem("cat.marcedit.stack_subfields")}undoCount(){return this.context.undoCount()}redoCount(){return this.context.redoCount()}undo(){this.context.requestUndo()}redo(){this.context.requestRedo()}controlFields(){return this.record.fields.filter(l=>l.isCtrlField)}dataFields(){return this.record.fields.filter(l=>!l.isCtrlField)}validate(){const l=[];this.record.fields.filter(l=>this.isControlledBibTag(l.tag)).forEach(n=>{n.authValid=!1,l.push({id:n.fieldId,tag:n.tag,ind1:n.ind1,ind2:n.ind2,subfields:n.subfields.map(l=>[l[0],l[1]])})}),this.net.request("open-ils.cat","open-ils.cat.authority.validate.bib_field",l).subscribe(l=>{const n=this.record.fields.filter(n=>n.fieldId===+l.id)[0];n.authChecked=!0,n.authValid=l.valid})}isControlledBibTag(l){return this.controlledBibTags&&this.controlledBibTags.includes(l)}openLinkerDialog(l){this.authLinker.bibField=l,this.authLinker.open({size:"xl"}).subscribe(n=>{if(!n)return;const e=this.record.newField(n);this.context.insertField(l,e),this.context.deleteField(l),this.context.setUndoGroupSize(2)})}openPhysCharDialog(l){this.physCharDialog.fieldData=l.data,this.physCharDialog.open({size:"lg"}).subscribe(n=>{n&&this.context.requestFieldFocus({fieldId:l.fieldId,target:"cfld",newText:n})})}}var yl=t.ob({encapsulation:0,styles:[[".link-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:17px;display:inline-flex;vertical-align:middle;align-items:center}"]],data:{}});function Ll(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,3,"div",[["class","row mt-5"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,2,"div",[["class","offset-lg-3 col-lg-6"]],null,null,null,null,null)),(l()(),t.qb(3,0,null,null,1,"eg-progress-inline",[],null,null,null,c.b,c.a)),t.pb(4,49152,null,0,b.a,[],null,null)],null,null)}function Fl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"eg-marc-editable-content",[["fieldText",""],["moreClasses","sf-delimiter border-right-0 bg-transparent p-1 pr-0"]],null,null,null,F,T)),t.pb(1,4440064,null,0,q,[t.C],{fieldText:[0,"fieldText"],moreClasses:[1,"moreClasses"]},null),(l()(),t.qb(2,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Subfield Code"],["fieldType","sfc"],["moreClasses","sf-code border-left-0 p-1 pl-0"]],null,null,null,F,T)),t.pb(3,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],subfield:[3,"subfield"],moreClasses:[4,"moreClasses"],ariaLabel:[5,"ariaLabel"]},null),(l()(),t.qb(4,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Subfield Value"],["fieldType","sfv"],["moreClasses","p-1 pt-2"]],null,null,null,F,T)),t.pb(5,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],subfield:[3,"subfield"],moreClasses:[4,"moreClasses"],ariaLabel:[5,"ariaLabel"]},null)],(function(l,n){var e=n.component;l(n,1,0,"","sf-delimiter border-right-0 bg-transparent p-1 pr-0"),l(n,3,0,e.context,n.context.field,"sfc",n.context.subfield,"sf-code border-left-0 p-1 pl-0","Subfield Code"),l(n,5,0,e.context,n.context.field,"sfv",n.context.subfield,"p-1 pt-2","Subfield Value")}),null)}function Sl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,2,"button",[["class","btn btn-sm btn-outline-info link-button"],["title","Create authority link"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.openLinkerDialog(l.parent.context.field)&&t),t}),null,null)),(l()(),t.qb(2,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["link"]))],null,null)}function Il(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[["class","material-icons label-with-material-icon text-success"],["title","Authority Validation Succeeded"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[" check_circle_outline "]))],null,null)}function kl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"span",[["class","material-icons label-with-material-icon text-danger"],["title","Authority Validation Failed"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[" error_outline "]))],null,null)}function Ml(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,4,"span",[["class","pl-2 pt-2"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,Il)),t.pb(3,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,kl)),t.pb(5,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){l(n,3,0,n.parent.context.field.authValid),l(n,5,0,!n.parent.context.field.authValid)}),null)}function wl(l){return t.Mb(0,[(l()(),t.fb(16777216,null,null,1,null,Sl)),t.pb(1,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,Ml)),t.pb(3,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){l(n,1,0,n.component.isControlledBibTag(n.context.field.tag)),l(n,3,0,n.context.field.authChecked)}),null)}function Rl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,2,"div",[["class","mt-2"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,1,"button",[["class","btn btn-outline-dark"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.validate()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Validate"]))],null,null)}function _l(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,30,"div",[["class","row m-2"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,9,"div",[["class","col-lg-4"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,8,"ul",[],null,null,null,null,null)),(l()(),t.qb(3,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Undo: CTRL-z"])),(l()(),t.qb(5,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Redo: CTRL-y"])),(l()(),t.qb(7,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Add Row: CTRL+Enter"])),(l()(),t.qb(9,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Insert Row: CTRL+Shift+Enter"])),(l()(),t.qb(11,0,null,null,9,"div",[["class","col-lg-4"]],null,null,null,null,null)),(l()(),t.qb(12,0,null,null,8,"ul",[],null,null,null,null,null)),(l()(),t.qb(13,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Copy Current Row Above: CTRL+Up"])),(l()(),t.qb(15,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Copy Current Row Below: CTRL+Down"])),(l()(),t.qb(17,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Add Subfield: CTRL+D or CTRL+I"])),(l()(),t.qb(19,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Remove Row: CTRL+Del"])),(l()(),t.qb(21,0,null,null,9,"div",[["class","col-lg-4"]],null,null,null,null,null)),(l()(),t.qb(22,0,null,null,8,"ul",[],null,null,null,null,null)),(l()(),t.qb(23,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Remove Subfield: Shift+Del"])),(l()(),t.qb(25,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Create/Replace 006: Shift+F6"])),(l()(),t.qb(27,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Create/Replace 007: Shift+F7"])),(l()(),t.qb(29,0,null,null,1,"li",[],null,null,null,null,null)),(l()(),t.Kb(-1,null,["Create/Replace 008: Shift+F8"]))],null,null)}function Kl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,2,"button",[["class","btn btn-sm btn-outline-info link-button"],["title","Open physical characteristics wizard"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.openPhysCharDialog(l.parent.context.$implicit)&&t),t}),null,null)),(l()(),t.qb(2,0,null,null,1,"span",[["class","material-icons"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,["launch"]))],null,null)}function Pl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,6,"div",[["class","row pt-0 pb-0 pl-3"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Control Field Tag"],["fieldType","tag"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(2,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null),(l()(),t.qb(3,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Control Field Content"],["fieldType","cfld"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(4,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null),(l()(),t.fb(16777216,null,null,1,null,Kl)),t.pb(6,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,2,0,e.context,n.context.$implicit,"tag","p-1","Control Field Tag"),l(n,4,0,e.context,n.context.$implicit,"cfld","p-1","Control Field Content"),l(n,6,0,"007"===n.context.$implicit.tag)}),null)}function Dl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function Ol(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function Al(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,3,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,Ol)),t.pb(2,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(3,{field:0}),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=l(n,3,0,n.parent.parent.parent.context.$implicit);l(n,2,0,e,t.Cb(n.parent.parent.parent.parent.parent,9))}),null)}function Nl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,2,null,Dl)),t.pb(2,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(3,{field:0,subfield:1}),(l()(),t.fb(16777216,null,null,1,null,Al)),t.pb(5,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=l(n,3,0,n.parent.parent.context.$implicit,n.context.$implicit);l(n,2,0,e,t.Cb(n.parent.parent.parent.parent,8)),l(n,5,0,n.context.last)}),null)}function El(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,Nl)),t.pb(2,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){l(n,2,0,n.parent.context.$implicit.subfields)}),null)}function Ul(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function Bl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,5,"div",[["class","form-inline"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"eg-marc-editable-content",[["fieldText","   "],["moreClasses","p-1 invisible"]],null,null,null,F,T)),t.pb(2,4440064,null,0,q,[t.C],{fieldText:[0,"fieldText"],moreClasses:[1,"moreClasses"]},null),(l()(),t.fb(16777216,null,null,2,null,Ul)),t.pb(4,540672,null,0,r.y,[t.N],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),t.Fb(5,{field:0,subfield:1})],(function(l,n){l(n,2,0,"   ","p-1 invisible");var e=l(n,5,0,n.parent.parent.context.$implicit,n.context.$implicit);l(n,4,0,e,t.Cb(n.parent.parent.parent.parent,8))}),null)}function Vl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,Bl)),t.pb(2,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){l(n,2,0,n.parent.context.$implicit.subfields)}),null)}function $l(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,11,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,8,"div",[["class","row pt-0 pb-0 pl-3"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Data Field Tag"],["fieldType","tag"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(3,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null),(l()(),t.qb(4,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Data Field Indicator 1"],["fieldType","ind1"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(5,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null),(l()(),t.qb(6,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Data Field Indicator 2"],["fieldType","ind2"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(7,4440064,null,0,q,[t.C],{context:[0,"context"],field:[1,"field"],fieldType:[2,"fieldType"],moreClasses:[3,"moreClasses"],ariaLabel:[4,"ariaLabel"]},null),(l()(),t.fb(16777216,null,null,1,null,El)),t.pb(9,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,Vl)),t.pb(11,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,3,0,e.context,n.context.$implicit,"tag","p-1","Data Field Tag"),l(n,5,0,e.context,n.context.$implicit,"ind1","p-1","Data Field Indicator 1"),l(n,7,0,e.context,n.context.$implicit,"ind2","p-1","Data Field Indicator 2"),l(n,9,0,!e.stackSubfields),l(n,11,0,e.stackSubfields)}),null)}function Hl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,42,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,41,"div",[["class","mt-3 text-monospace"]],null,[[null,"contextmenu"]],(function(l,n,e){var t=!0;return"contextmenu"===n&&(t=!1!==e.preventDefault()&&t),t}),null,null)),(l()(),t.qb(2,0,null,null,29,"div",[["class","row pb-2 mb-2 border-bottom border-muted"]],null,null,null,null,null)),(l()(),t.qb(3,0,null,null,2,"div",[["class","col-lg-9 fixed-fields-container"]],null,null,null,null,null)),(l()(),t.qb(4,0,null,null,1,"eg-fixed-fields-editor",[],null,null,null,P,K)),t.pb(5,114688,null,0,_,[d.a,w.a,R.a],{context:[0,"context"]},null),(l()(),t.qb(6,0,null,null,24,"div",[["class","col-lg-3"]],null,null,null,null,null)),(l()(),t.qb(7,0,null,null,2,"div",[],null,null,null,null,null)),(l()(),t.qb(8,0,null,null,1,"button",[["class","btn btn-outline-dark"]],null,[[null,"click"]],(function(l,n,e){var t=!0,u=l.component;return"click"===n&&(t=0!=(u.showHelp=!u.showHelp)&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Help"])),(l()(),t.fb(16777216,null,null,1,null,Rl)),t.pb(11,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(12,0,null,null,8,"div",[["class","mt-2"]],null,null,null,null,null)),(l()(),t.qb(13,0,null,null,3,"button",[["class","btn btn-outline-info"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.undo()&&t),t}),null,null)),(l()(),t.Kb(-1,null,[" Undo "])),(l()(),t.qb(15,0,null,null,1,"span",[["class","badge badge-info"]],null,null,null,null,null)),(l()(),t.Kb(16,null,["",""])),(l()(),t.qb(17,0,null,null,3,"button",[["class","btn btn-outline-info ml-2"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.redo()&&t),t}),null,null)),(l()(),t.Kb(-1,null,[" Redo "])),(l()(),t.qb(19,0,null,null,1,"span",[["class","badge badge-info"]],null,null,null,null,null)),(l()(),t.Kb(20,null,["",""])),(l()(),t.qb(21,0,null,null,9,"div",[["class","mt-2"]],null,null,null,null,null)),(l()(),t.qb(22,0,null,null,8,"div",[["class","form-check"]],null,null,null,null,null)),(l()(),t.qb(23,0,null,null,5,"input",[["class","form-check-input"],["type","checkbox"]],[[8,"id",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"blur"]],(function(l,n,e){var u=!0,i=l.component;return"change"===n&&(u=!1!==t.Cb(l,24).onChange(e.target.checked)&&u),"blur"===n&&(u=!1!==t.Cb(l,24).onTouched()&&u),"change"===n&&(u=!1!==i.stackSubfieldsChange()&&u),"ngModelChange"===n&&(u=!1!==(i.stackSubfields=e)&&u),u}),null,null)),t.pb(24,16384,null,0,u.b,[t.C,t.k],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.b]),t.pb(26,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(28,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(29,0,null,null,1,"label",[["class","form-check-label"]],[[8,"htmlFor",0]],null,null,null,null)),(l()(),t.Kb(-1,null,[" Stack Subfields "])),(l()(),t.qb(31,0,null,null,0,"div",[["class","col-lg-1"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,_l)),t.pb(33,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(34,0,null,null,4,"div",[["class","row pt-0 pb-0 pl-3"]],null,null,null,null,null)),(l()(),t.qb(35,0,null,null,1,"eg-marc-editable-content",[["fieldText","LDR"],["moreClasses","p-1"]],null,null,null,F,T)),t.pb(36,4440064,null,0,q,[t.C],{context:[0,"context"],fieldText:[1,"fieldText"],moreClasses:[2,"moreClasses"]},null),(l()(),t.qb(37,0,null,null,1,"eg-marc-editable-content",[["ariaLabel","Leader"],["fieldType","ldr"],["moreClasses","p-1 pr-2"]],null,null,null,F,T)),t.pb(38,4440064,null,0,q,[t.C],{context:[0,"context"],fieldType:[1,"fieldType"],moreClasses:[2,"moreClasses"],ariaLabel:[3,"ariaLabel"]},null),(l()(),t.fb(16777216,null,null,1,null,Pl)),t.pb(40,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null),(l()(),t.fb(16777216,null,null,1,null,$l)),t.pb(42,278528,null,0,r.o,[t.N,t.K,t.r],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var e=n.component;l(n,5,0,e.context),l(n,11,0,"biblio"===e.context.recordType),l(n,26,0,e.stackSubfields),l(n,33,0,e.showHelp),l(n,36,0,e.context,"LDR","p-1"),l(n,38,0,e.context,"ldr","p-1 pr-2","Leader"),l(n,40,0,e.controlFields()),l(n,42,0,e.dataFields())}),(function(l,n){var e=n.component;l(n,13,0,e.undoCount()<1),l(n,16,0,e.undoCount()),l(n,17,0,e.redoCount()<1),l(n,20,0,e.redoCount()),l(n,23,0,t.ub(1,"stack-subfields-",e.randId,""),t.Cb(n,28).ngClassUntouched,t.Cb(n,28).ngClassTouched,t.Cb(n,28).ngClassPristine,t.Cb(n,28).ngClassDirty,t.Cb(n,28).ngClassValid,t.Cb(n,28).ngClassInvalid,t.Cb(n,28).ngClassPending),l(n,29,0,t.ub(1,"stack-subfields-",e.randId,""))}))}function zl(l){return t.Mb(0,[t.Ib(671088640,1,{authLinker:0}),t.Ib(671088640,2,{physCharDialog:0}),(l()(),t.fb(16777216,null,null,1,null,Ll)),t.pb(3,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(4,0,null,null,1,"eg-authority-linking-dialog",[],null,null,null,hl,Q)),t.pb(5,114688,[[1,4],["authLinker",4]],0,J,[f.E,E.a,w.a,a.a,N.b],{context:[0,"context"]},null),(l()(),t.qb(6,0,null,null,1,"eg-phys-char-dialog",[],null,null,null,ql,gl)),t.pb(7,114688,[[2,4],["physCharDialog",4]],0,pl,[f.E,d.a,a.a],null,null),(l()(),t.fb(0,[["subfieldChunk",2]],null,0,null,Fl)),(l()(),t.fb(0,[["postSubfieldsChunk",2]],null,0,null,wl)),(l()(),t.fb(16777216,null,null,1,null,Hl)),t.pb(11,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var e=n.component;l(n,3,0,!e.dataLoaded),l(n,5,0,e.context),l(n,7,0),l(n,11,0,e.dataLoaded)}),null)}class Xl{constructor(l,n,e){this.idl=l,this.org=n,this.store=e}get record(){return this.context.record}ngOnInit(){this.record.breakerText=this.record.toBreaker()}rowCount(){return this.record&&this.record.breakerText?this.record.breakerText.split(/\n/).length+2:40}textChanged(){this.context.changesPending=!0}}var jl=t.ob({encapsulation:0,styles:[[".flat-editor-content[_ngcontent-%COMP%]{font-family:'Lucida Console',Monaco,monospace;display:inline-block;padding:0}"]],data:{}});function Gl(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,7,"div",[],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,6,"textarea",[["class","form-control flat-editor-content"],["spellcheck","false"]],[[8,"rows",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"],[null,"ngModelChange"],[null,"input"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,2)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,2).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,2)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,2)._compositionEnd(e.target.value)&&u),"change"===n&&(u=!1!==i.textChanged()&&u),"blur"===n&&(u=!1!==i.record.absorbBreakerChanges()&&u),"ngModelChange"===n&&(u=!1!==(i.record.breakerText=e)&&u),u}),null,null)),t.pb(2,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.d]),t.pb(4,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(6,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.Kb(-1,null,["  "]))],(function(l,n){l(n,4,0,n.component.record.breakerText)}),(function(l,n){l(n,1,0,t.ub(1,"",n.component.rowCount(),""),t.Cb(n,6).ngClassUntouched,t.Cb(n,6).ngClassTouched,t.Cb(n,6).ngClassPristine,t.Cb(n,6).ngClassDirty,t.Cb(n,6).ngClassValid,t.Cb(n,6).ngClassInvalid,t.Cb(n,6).ngClassPending)}))}function Jl(l){return t.Mb(0,[(l()(),t.fb(16777216,null,null,1,null,Gl)),t.pb(1,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){l(n,1,0,n.component.record)}),null)}var Ql=e("9AJC"),Wl=e("6rhm"),Yl=e("36iw"),Zl=e("taEJ"),ln=e("/xpB");e.d(n,"a",(function(){return nn})),e.d(n,"b",(function(){return pn}));var nn=t.ob({encapsulation:2,styles:[],data:{}});function en(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,9,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,8,"div",[["class","form-check"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,5,"input",[["class","form-check-input"],["id","fast-add-item"],["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"],[null,"blur"]],(function(l,n,e){var u=!0,i=l.component;return"change"===n&&(u=!1!==t.Cb(l,3).onChange(e.target.checked)&&u),"blur"===n&&(u=!1!==t.Cb(l,3).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(i.showFastAdd=e)&&u),u}),null,null)),t.pb(3,16384,null,0,u.b,[t.C,t.k],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.b]),t.pb(5,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(7,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(8,0,null,null,1,"label",[["class","form-check-label"],["for","fast-add-item"]],null,null,null,null,null)),(l()(),t.Kb(-1,null,[" Add Item "]))],(function(l,n){l(n,5,0,n.component.showFastAdd)}),(function(l,n){l(n,2,0,t.Cb(n,7).ngClassUntouched,t.Cb(n,7).ngClassTouched,t.Cb(n,7).ngClassPristine,t.Cb(n,7).ngClassDirty,t.Cb(n,7).ngClassValid,t.Cb(n,7).ngClassInvalid,t.Cb(n,7).ngClassPending)}))}function tn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,13,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,12,"div",[["class","form-inline"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,5,"input",[["class","form-control ml-2"],["placeholder","Call Number"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,3)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,3).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,3)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,3)._compositionEnd(e.target.value)&&u),"ngModelChange"===n&&(u=!1!==(i.fastItemLabel=e)&&u),u}),null,null)),t.pb(3,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.d]),t.pb(5,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(7,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),t.qb(8,0,null,null,5,"input",[["class","form-control ml-2"],["placeholder","Barcode"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,e){var u=!0,i=l.component;return"input"===n&&(u=!1!==t.Cb(l,9)._handleInput(e.target.value)&&u),"blur"===n&&(u=!1!==t.Cb(l,9).onTouched()&&u),"compositionstart"===n&&(u=!1!==t.Cb(l,9)._compositionStart()&&u),"compositionend"===n&&(u=!1!==t.Cb(l,9)._compositionEnd(e.target.value)&&u),"ngModelChange"===n&&(u=!1!==(i.fastItemBarcode=e)&&u),u}),null,null)),t.pb(9,16384,null,0,u.d,[t.C,t.k,[2,u.a]],null,null),t.Hb(1024,null,u.o,(function(l){return[l]}),[u.d]),t.pb(11,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{model:[0,"model"]},{update:"ngModelChange"}),t.Hb(2048,null,u.p,null,[u.t]),t.pb(13,16384,null,0,u.q,[[4,u.p]],null,null)],(function(l,n){var e=n.component;l(n,5,0,e.fastItemLabel),l(n,11,0,e.fastItemBarcode)}),(function(l,n){l(n,2,0,t.Cb(n,7).ngClassUntouched,t.Cb(n,7).ngClassTouched,t.Cb(n,7).ngClassPristine,t.Cb(n,7).ngClassDirty,t.Cb(n,7).ngClassValid,t.Cb(n,7).ngClassInvalid,t.Cb(n,7).ngClassPending),l(n,8,0,t.Cb(n,13).ngClassUntouched,t.Cb(n,13).ngClassTouched,t.Cb(n,13).ngClassPristine,t.Cb(n,13).ngClassDirty,t.Cb(n,13).ngClassValid,t.Cb(n,13).ngClassInvalid,t.Cb(n,13).ngClassPending)}))}function un(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,3,"div",[["class","mr-2"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,2,"eg-combobox",[["placeholder","Select a Source..."]],null,null,null,i.b,i.a)),t.Hb(5120,null,u.o,(function(l){return[l]}),[o.a]),t.pb(4,114688,[[1,4],["sourceSelector",4]],0,o.a,[t.k,s.a,d.a,a.a],{placeholder:[0,"placeholder"],entries:[1,"entries"]},null)],(function(l,n){l(n,4,0,"Select a Source...",n.component.sources)}),null)}function on(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"button",[["class","btn btn-warning"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.deleteRecord()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Delete Record"]))],null,(function(l,n){l(n,0,0,n.component.inPlaceMode)}))}function sn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,1,"button",[["class","btn btn-info"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.undeleteRecord()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Undelete Record"]))],null,(function(l,n){l(n,0,0,n.component.inPlaceMode)}))}function dn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,on)),t.pb(2,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,sn)),t.pb(4,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,2,0,!e.record.deleted),l(n,4,0,e.record.deleted)}),null)}function an(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,3,"div",[["class","row mt-5"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,2,"div",[["class","offset-lg-3 col-lg-6"]],null,null,null,null,null)),(l()(),t.qb(3,0,null,null,1,"eg-progress-inline",[],null,null,null,c.b,c.a)),t.pb(4,49152,null,0,b.a,[],null,null)],null,null)}function rn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"eg-marc-rich-editor",[],null,null,null,zl,yl)),t.pb(2,114688,null,0,Tl,[d.a,N.b,w.a,V.a,R.a],{context:[0,"context"]},null)],(function(l,n){l(n,2,0,n.component.context)}),null)}function cn(l){return t.Mb(0,[(l()(),t.fb(16777216,null,null,1,null,rn)),t.pb(1,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,1,0,e.context&&e.context.record)}),null)}function bn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"eg-marc-flat-editor",[],null,null,null,Jl,jl)),t.pb(2,114688,null,0,Xl,[d.a,w.a,V.a],{context:[0,"context"]},null)],(function(l,n){l(n,2,0,n.component.context)}),null)}function fn(l){return t.Mb(0,[(l()(),t.fb(16777216,null,null,1,null,bn)),t.pb(1,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(0,null,null,0))],(function(l,n){var e=n.component;l(n,1,0,e.context&&e.context.record)}),null)}function hn(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,16,"div",[["class","row"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,15,"div",[["class","col-lg-12"]],null,null,null,null,null)),(l()(),t.qb(2,0,null,null,14,"ngb-tabset",[],null,[[null,"tabChange"]],(function(l,n,e){var t=!0;return"tabChange"===n&&(t=!1!==l.component.tabChange(e)&&t),t}),Ql.k,Ql.f)),t.pb(3,2146304,null,1,f.eb,[f.fb],{activeId:[0,"activeId"]},{tabChange:"tabChange"}),t.Ib(603979776,7,{tabs:1}),(l()(),t.qb(5,0,null,null,5,"ngb-tab",[["id","rich"],["title","Enhanced MARC Editor"]],null,null,null,null,null)),t.pb(6,2113536,[[7,4]],2,f.bb,[],{id:[0,"id"],title:[1,"title"]},null),t.Ib(603979776,8,{titleTpls:1}),t.Ib(603979776,9,{contentTpls:1}),(l()(),t.fb(0,null,null,1,null,cn)),t.pb(10,16384,[[9,4]],0,f.cb,[t.K],null,null),(l()(),t.qb(11,0,null,null,5,"ngb-tab",[["id","flat"],["title","Flat Text Editor"]],null,null,null,null,null)),t.pb(12,2113536,[[7,4]],2,f.bb,[],{id:[0,"id"],title:[1,"title"]},null),t.Ib(603979776,10,{titleTpls:1}),t.Ib(603979776,11,{contentTpls:1}),(l()(),t.fb(0,null,null,1,null,fn)),t.pb(16,16384,[[11,4]],0,f.cb,[t.K],null,null)],(function(l,n){l(n,3,0,n.component.editorTab),l(n,6,0,"rich","Enhanced MARC Editor"),l(n,12,0,"flat","Flat Text Editor")}),null)}function pn(l){return t.Mb(0,[t.Ib(671088640,1,{sourceSelector:0}),t.Ib(671088640,2,{confirmDelete:0}),t.Ib(671088640,3,{confirmUndelete:0}),t.Ib(671088640,4,{cannotDelete:0}),t.Ib(671088640,5,{successMsg:0}),t.Ib(671088640,6,{failMsg:0}),(l()(),t.qb(6,0,null,null,1,"eg-confirm-dialog",[["dialogTitle","Confirm Delete"]],null,null,null,Wl.b,Wl.a)),t.pb(7,114688,[[2,4],["confirmDelete",4]],0,Yl.a,[f.E],{dialogTitle:[0,"dialogTitle"],dialogBody:[1,"dialogBody"]},null),(l()(),t.qb(8,0,null,null,1,"eg-confirm-dialog",[["dialogTitle","Confirm Undelete"]],null,null,null,Wl.b,Wl.a)),t.pb(9,114688,[[3,4],["confirmUndelete",4]],0,Yl.a,[f.E],{dialogTitle:[0,"dialogTitle"],dialogBody:[1,"dialogBody"]},null),(l()(),t.qb(10,0,null,null,1,"eg-alert-dialog",[["dialogBody","Records with holdings attached cannot be deleted."]],null,null,null,Zl.b,Zl.a)),t.pb(11,114688,[[4,4],["cannotDelete",4]],0,ln.a,[f.E],{dialogBody:[0,"dialogBody"]},null),(l()(),t.qb(12,0,null,null,1,"eg-string",[["text","Record successfully updated"]],null,null,null,g.b,g.a)),t.pb(13,114688,[[5,4],["successMsg",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(14,0,null,null,1,"eg-string",[["text","Record failed to update"]],null,null,null,g.b,g.a)),t.pb(15,114688,[[6,4],["failMsg",4]],0,m.a,[t.k,C.a],{text:[0,"text"]},null),(l()(),t.qb(16,0,null,null,15,"div",[["class","row d-flex p-2 m-2"]],null,null,null,null,null)),(l()(),t.fb(16777216,null,null,1,null,en)),t.pb(18,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,tn)),t.pb(20,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(21,0,null,null,0,"div",[["class","flex-1"]],null,null,null,null,null)),(l()(),t.qb(22,0,null,null,2,"h3",[["class","mr-2"]],null,null,null,null,null)),(l()(),t.qb(23,0,null,null,1,"span",[["class","badge badge-light p-2"]],null,null,null,null,null)),(l()(),t.Kb(24,null,[" Record Type "," "])),(l()(),t.fb(16777216,null,null,1,null,un)),t.pb(26,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(27,0,null,null,2,"div",[["class","pr-3 mr-3 border-right"]],null,null,null,null,null)),(l()(),t.qb(28,0,null,null,1,"button",[["class","btn btn-success"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.saveRecord()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Save Changes"])),(l()(),t.fb(16777216,null,null,1,null,dn)),t.pb(31,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,an)),t.pb(33,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.fb(16777216,null,null,1,null,hn)),t.pb(35,16384,null,0,r.p,[t.N,t.K],{ngIf:[0,"ngIf"]},null),(l()(),t.qb(36,0,null,null,2,"div",[["class","row d-flex p-2 m-2 flex-row-reverse"]],null,null,null,null,null)),(l()(),t.qb(37,0,null,null,1,"button",[["class","btn btn-success"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.saveRecord()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["Save Changes"]))],(function(l,n){var e=n.component;l(n,7,0,"Confirm Delete",t.ub(1,"Delete Record ID ",e.record?e.record.id:"","?")),l(n,9,0,"Confirm Undelete",t.ub(1,"Undelete Record ID ",e.record?e.record.id:"","?")),l(n,11,0,"Records with holdings attached cannot be deleted."),l(n,13,0,"Record successfully updated"),l(n,15,0,"Record failed to update"),l(n,18,0,"biblio"===e.recordType),l(n,20,0,e.showFastAdd),l(n,26,0,"biblio"===e.recordType),l(n,31,0,e.record&&e.record.id),l(n,33,0,e.dataSaving),l(n,35,0,!e.dataSaving)}),(function(l,n){var e=n.component;l(n,24,0,e.record?e.record.recordType():""),l(n,28,0,e.record&&e.record.deleted),l(n,37,0,e.record&&e.record.deleted)}))}},"WC/f":function(l,n,e){"use strict";e.d(n,"a",(function(){return t})),e("Osig"),e("EQoe"),e("8PDw"),e("EQDH");class t{constructor(l,n,e,t){this.net=l,this.auth=n,this.evt=e,this.anonCache=t}spawnAddHoldingsUi(l,n,e,t,u,i){const o=[];n?n.forEach(l=>o.push({callnumber:l})):e&&e.forEach(l=>o.push(l)),this.anonCache.setItem(null,"edit-these-copies",{record_id:l,raw:o,copies:t,hide_vols:!0===i,hide_copies:!0===u}).then(l=>{l?setTimeout(()=>{window.open("/eg/staff/cat/volcopy/"+l,"_blank")}):console.error("Could not create holds cache key!")})}}},fkVb:function(l,n,e){"use strict";e.d(n,"a",(function(){return t}));class t{}},m9Ce:function(l,n,e){"use strict";e.d(n,"a",(function(){return u})),e.d(n,"b",(function(){return i}));var t=e("8Y7J");class u{}let i=(()=>{class l{constructor(){this.showMenuRequest=new t.m,this.menuItemSelected=new t.m}}return l.ngInjectableDef=t.Qb({factory:function(){return new l},token:l,providedIn:"root"}),l})()},r7vI:function(l,n,e){"use strict";var t=e("vkgz"),u=e("lJxs"),i=e("l7GE"),o=e("ZUHj");class s{constructor(l,n){this.keySelector=l,this.flushes=n}call(l,n){return n.subscribe(new d(l,this.keySelector,this.flushes))}}class d extends i.a{constructor(l,n,e){super(l),this.keySelector=n,this.values=new Set,e&&this.add(Object(o.a)(this,e))}notifyNext(l,n,e,t,u){this.values.clear()}notifyError(l,n){this._error(l)}_next(l){this.keySelector?this._useKeySelector(l):this._finalizeNext(l,l)}_useKeySelector(l){let n;const{destination:e}=this;try{n=this.keySelector(l)}catch(t){return void e.error(t)}this._finalizeNext(n,l)}_finalizeNext(l,n){const{values:e}=this;e.has(l)||(e.add(l),this.destination.next(n))}}e("OXuP"),e("8PDw"),e("Osig"),e("iA0r"),e.d(n,"a",(function(){return r}));class a{constructor(l,n,e,t,u){this.cache={indicators:{},sfcodes:{},sfvalues:{},ffvalues:{}},this.store=l,this.auth=n,this.net=e,this.pcrud=t,this.selector=u}load(){return Promise.all([this.loadTagTable(),this.getFfPosTable(),this.getFfValueTable()])}fromCache(l,n,e){const t=this.cache[l][n];return e?t?t[e]:void 0:t}toCache(l,n,e,t){const u=this.cache[l];return e?(u[n]||(u[n]={}),u[n][e]=t):u[n]=t,t}getFfPosTable(){const l="FFPosTable_"+this.selector.ffType;return this.ffPosTable?Promise.resolve(this.ffPosTable):(this.ffPosTable=this.store.getLocalItem(l),this.ffPosTable?Promise.resolve(this.ffPosTable):this.net.request("open-ils.fielder","open-ils.fielder.cmfpm.atomic",{query:{tag:{"!=":"006"},rec_type:this.selector.ffType}}).toPromise().then(n=>(this.store.setLocalItem(l,n),this.ffPosTable=n)))}getFfValueTable(){const l="FFValueTable_"+this.selector.ffType;return this.ffValueTable?Promise.resolve(this.ffValueTable):(this.ffValueTable=this.store.getLocalItem(l),this.ffValueTable?Promise.resolve(this.ffValueTable):this.net.request("open-ils.cat","open-ils.cat.biblio.fixed_field_values.by_rec_type",this.selector.ffType).toPromise().then(n=>(this.store.setLocalItem(l,n),this.ffValueTable=n)))}loadTagTable(){const l=this.selector,n=`current_tag_table_${l.marcFormat}_${l.marcRecordType}`;return this.tagMap=this.store.getLocalItem(n),this.tagMap?Promise.resolve(this.tagMap):this.fetchTagTable().then(l=>(this.store.setLocalItem(n,this.tagMap),this.tagMap))}fetchTagTable(){return this.tagMap=[],this.net.request("open-ils.cat","open-ils.cat.tag_table.all.retrieve.local",this.auth.token(),this.selector.marcFormat,this.selector.marcRecordType).pipe(Object(t.a)(l=>{this.tagMap[l.tag]=l})).toPromise()}getSubfieldCodes(l){if(!l||!this.tagMap[l])return null;this.fromCache("sfcodes",l);const n=this.tagMap[l].subfields.map(l=>({value:l.code,label:`${l.code}: ${l.description}`})).sort((l,n)=>l.label<n.label?-1:1);return this.toCache("sfcodes",l,null,n)}getFieldTags(){return this.fieldTags||(this.fieldTags=Object.keys(this.tagMap).filter(l=>Boolean(this.tagMap[l])).map(l=>({value:l,label:`${l}: ${this.tagMap[l].name}`})).sort((l,n)=>l.label<n.label?-1:1)),this.fieldTags}getSubfieldValues(l,n){if(!l||!this.tagMap[l])return[];const e=this.fromCache("sfvalues",l,n);if(e)return e;const t=[];return this.tagMap[l].subfields.filter(l=>l.code===n&&l.hasOwnProperty("value_list")).forEach(l=>{l.value_list.forEach(l=>{let n=l.description||l.code;const e=l.code||n;e!==n&&(n=`${e}: ${n}`),t.push({value:e,label:n})})}),this.toCache("sfvalues",l,n,t)}getIndicatorValues(l,n){if(!l||!this.tagMap[l])return;const e=this.fromCache("indicators",l,n);if(e)return e;let t=this.tagMap[l][n];return t?(t=t.map(l=>({value:l.code,label:`${l.code}: ${l.description}`})).sort((l,n)=>l.label<n.label?-1:1),this.toCache("indicators",l,n,t)):void 0}getFfFieldMeta(l){return this.getFfPosTable().then(n=>n.filter(n=>n.fixed_field===l&&n.rec_type===this.selector.ffType)[0])}getFfValues(l){const n=this.fromCache("ffvalues",l);if(n)return n;let e=this.ffValueTable;return e&&e[l]?(e=e[l].filter(l=>l[0].length<=l[2]).map(l=>({value:l[0],label:`${l[0]}: ${l[1]}`})).sort((l,n)=>l.label<n.label?-1:1),this.toCache("ffvalues",l,null,e)):null}}class r{constructor(l,n,e,t){this.store=l,this.auth=n,this.net=e,this.pcrud=t,this.tagTables={}}loadTags(l){if(l.marcFormat||(l.marcFormat="marc21"),this.tagTables[l.marcRecordType])return Promise.resolve(this.tagTables[l.marcRecordType]);const n=new a(this.store,this.auth,this.net,this.pcrud,l);return this.tagTables[l.marcRecordType]=n,n.load().then(l=>n)}getControlledBibTags(){return this.controlledBibTags?Promise.resolve(this.controlledBibTags):(this.controlledBibTags=[],this.pcrud.retrieveAll("acsbf",{select:["tag"]}).pipe(Object(u.a)(l=>l.tag()),l=>l.lift(new s(void 0,void 0)),Object(u.a)(l=>this.controlledBibTags.push(l))).toPromise().then(l=>this.controlledBibTags))}}},taEJ:function(l,n,e){"use strict";e.d(n,"a",(function(){return u})),e.d(n,"b",(function(){return o}));var t=e("8Y7J"),u=(e("/xpB"),e("G0yt"),t.ob({encapsulation:2,styles:[],data:{}}));function i(l){return t.Mb(0,[(l()(),t.qb(0,0,null,null,2,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),t.qb(1,0,null,null,1,"div",[["class","alert alert-danger"]],null,null,null,null,null)),(l()(),t.Kb(2,null,["",""])),(l()(),t.qb(3,0,null,null,2,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),t.qb(4,0,null,null,1,"button",[["class","btn btn-success"],["type","button"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.close()&&t),t}),null,null)),(l()(),t.Kb(-1,null,["OK"]))],null,(function(l,n){l(n,2,0,n.component.dialogBody)}))}function o(l){return t.Mb(0,[t.Ib(671088640,1,{dialogContent:0}),(l()(),t.fb(0,[[1,2],["dialogContent",2]],null,0,null,i))],null,null)}}}]);