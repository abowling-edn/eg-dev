(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"1xse":function(l,n,t){"use strict";t.r(n);var e=t("8Y7J");class u{}var s=t("pMnS"),i=t("9AJC"),a=t("s7LF"),o=t("SVse"),r=t("dix8"),c=t("ufrD"),b=t("WZ78"),d=t("ayJW"),h=t("cUpR"),g=t("6rhm"),p=t("36iw"),m=t("G0yt"),f=t("gBxT"),w=t("wVJ/"),C=t("8PDw"),v=t("OXuP"),k=t("cm5s"),O=t("wN9v"),y=t("Osig"),q=t("EQDH"),A=t("87XM");class N{constructor(l,n,t,e,u,s,i,a,o){this.router=l,this.route=n,this.evt=t,this.net=e,this.store=u,this.auth=s,this.org=i,this.hatch=a,this.perm=o,this.workstations=[],this.orgOnChange=l=>{this.newOwner=l}}ngOnInit(){this.store.getWorkstations().then(l=>(this.workstations=l||[],this.setNewName())).then(l=>this.store.getDefaultWorkstation()).then(l=>{this.defaultName=l,this.selectedName=this.auth.workstation()||this.defaultName;const n=this.route.snapshot.paramMap.get("remove");n&&this.removeSelected(this.removeWorkstation=n)}),this.perm.hasWorkPermAt(["REGISTER_WORKSTATION"],!0).then(l=>{this.disableOrgs=this.org.filterList({canHaveUsers:!1},!0).concat(this.org.filterList({notInList:l.REGISTER_WORKSTATION},!0))})}selected(){return this.workstations.filter(l=>l.name===this.selectedName)[0]}useNow(){this.selected()&&this.router.navigate(["/staff/login"],{queryParams:{workstation:this.selected().name}})}setDefault(){this.selected()&&(this.defaultName=this.selected().name,this.store.setDefaultWorkstation(this.defaultName))}removeSelected(l){l||(l=this.selected().name),this.workstations=this.workstations.filter(n=>n.name!==l),this.store.setWorkstations(this.workstations)}setNewName(){this.hatch.hostname().then(l=>this.newName=l||"")}canDeleteSelected(){return!0}registerWorkstation(){console.log(`Registering new workstation "${this.newName}" at ${this.newOwner.shortname()}`),this.newName=this.newOwner.shortname()+"-"+this.newName,this.registerWorkstationApi().then(l=>this.registerWorkstationLocal(l),l=>console.log("Workstation registration canceled/failed"))}handleCollision(){return new Promise((l,n)=>{this.wsExistsDialog.open().subscribe(t=>{t&&this.registerWorkstationApi(!0).then(n=>l(n),l=>n(l))})})}registerWorkstationApi(l){let n="open-ils.actor.workstation.register";return l&&(n+=".override"),new Promise((l,t)=>{this.net.request("open-ils.actor",n,this.auth.token(),this.newName,this.newOwner.id()).subscribe(n=>{const e=this.evt.parse(n);e?"WORKSTATION_NAME_EXISTS"===e.textcode?this.handleCollision().then(n=>l(n),l=>t(l)):(console.error("Registration failed "+e),t()):l(n)})})}registerWorkstationLocal(l){const n={id:l,name:this.newName,owning_lib:this.newOwner.id()};this.workstations.push(n),this.store.setWorkstations(this.workstations),this.newName="",1===this.workstations.length&&(this.selectedName=n.name,this.setDefault())}}var I=t("iInd"),x=e.ob({encapsulation:2,styles:[],data:{}});function T(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,1,"div",[["class","alert alert-warning"]],null,null,null,null,null)),(l()(),e.Kb(1,null,[" Workstation "," is no longer valid. Removing registration. "]))],null,(function(l,n){l(n,1,0,n.component.removeWorkstation)}))}function W(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,2,"div",[["class","alert alert-danger"]],null,null,null,null,null)),(l()(),e.qb(1,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(-1,null,["Please register a workstation."]))],null,null)}function D(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(1,null,[" "," (Default) "]))],null,(function(l,n){l(n,1,0,n.parent.context.$implicit.name)}))}function M(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(1,null,[" "," "]))],null,(function(l,n){l(n,1,0,n.parent.context.$implicit.name)}))}function K(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,6,"option",[],null,null,null,null,null)),e.pb(1,147456,null,0,a.u,[e.k,e.C,[2,a.z]],{value:[0,"value"]},null),e.pb(2,147456,null,0,a.F,[e.k,e.C,[8,null]],{value:[0,"value"]},null),(l()(),e.fb(16777216,null,null,1,null,D)),e.pb(4,16384,null,0,o.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.fb(16777216,null,null,1,null,M)),e.pb(6,16384,null,0,o.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var t=n.component;l(n,1,0,e.ub(1,"",n.context.$implicit.name,"")),l(n,2,0,e.ub(1,"",n.context.$implicit.name,"")),l(n,4,0,n.context.$implicit.name==t.defaultName),l(n,6,0,n.context.$implicit.name!=t.defaultName)}),null)}function P(l){return e.Mb(0,[e.Ib(402653184,1,{wsExistsDialog:0}),(l()(),e.qb(1,0,null,null,1,"eg-staff-banner",[["bannerText","Workstation Administration"]],null,null,null,r.b,r.a)),e.pb(2,49152,null,0,c.a,[],{bannerText:[0,"bannerText"]},null),(l()(),e.qb(3,0,null,null,1,"eg-title",[["prefix","Manage Workstations"]],null,null,null,b.b,b.a)),e.pb(4,4243456,null,0,d.a,[h.h],{prefix:[0,"prefix"]},null),(l()(),e.qb(5,0,null,null,1,"eg-confirm-dialog",[["dialogTitle","Workstation Exists"]],null,null,null,g.b,g.a)),e.pb(6,114688,[[1,4],["workstationExistsDialog",4]],0,p.a,[m.E],{dialogTitle:[0,"dialogTitle"],dialogBody:[1,"dialogBody"]},null),(l()(),e.qb(7,0,null,null,46,"div",[["class","row"]],null,null,null,null,null)),(l()(),e.qb(8,0,null,null,45,"div",[["class","col-lg-8 offset-1 mt-3"]],null,null,null,null,null)),(l()(),e.fb(16777216,null,null,1,null,T)),e.pb(10,16384,null,0,o.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.fb(16777216,null,null,1,null,W)),e.pb(12,16384,null,0,o.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.qb(13,0,null,null,2,"div",[["class","row"]],null,null,null,null,null)),(l()(),e.qb(14,0,null,null,1,"div",[["class","col"]],null,null,null,null,null)),(l()(),e.Kb(-1,null,["Register a New Workstation For This Browser"])),(l()(),e.qb(16,0,null,null,15,"div",[["class","row mt-2"]],null,null,null,null,null)),(l()(),e.qb(17,0,null,null,2,"div",[["class","col-lg-2"]],null,null,null,null,null)),(l()(),e.qb(18,0,null,null,1,"eg-org-select",[["placeholder","Owner..."]],null,[[null,"onChange"]],(function(l,n,t){var e=!0;return"onChange"===n&&(e=!1!==l.component.orgOnChange(t)&&e),e}),f.b,f.a)),e.pb(19,114688,null,0,w.a,[C.a,v.a,k.a,O.a],{placeholder:[0,"placeholder"],applyDefault:[1,"applyDefault"],hideOrgs:[2,"hideOrgs"],disableOrgs:[3,"disableOrgs"]},{onChange:"onChange"}),(l()(),e.qb(20,0,null,null,11,"div",[["class","col-lg-6"]],null,null,null,null,null)),(l()(),e.qb(21,0,null,null,10,"div",[["class","input-group"]],null,null,null,null,null)),(l()(),e.qb(22,0,null,null,5,"input",[["class","form-control"],["placeholder","Workstation Name..."],["title","Workstation Name"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,n,t){var u=!0,s=l.component;return"input"===n&&(u=!1!==e.Cb(l,23)._handleInput(t.target.value)&&u),"blur"===n&&(u=!1!==e.Cb(l,23).onTouched()&&u),"compositionstart"===n&&(u=!1!==e.Cb(l,23)._compositionStart()&&u),"compositionend"===n&&(u=!1!==e.Cb(l,23)._compositionEnd(t.target.value)&&u),"ngModelChange"===n&&(u=!1!==(s.newName=t)&&u),u}),null,null)),e.pb(23,16384,null,0,a.d,[e.C,e.k,[2,a.a]],null,null),e.Hb(1024,null,a.o,(function(l){return[l]}),[a.d]),e.pb(25,671744,null,0,a.t,[[8,null],[8,null],[8,null],[6,a.o]],{model:[0,"model"]},{update:"ngModelChange"}),e.Hb(2048,null,a.p,null,[a.t]),e.pb(27,16384,null,0,a.q,[[4,a.p]],null,null),(l()(),e.qb(28,0,null,null,3,"div",[["class","input-group-btn"]],null,null,null,null,null)),(l()(),e.qb(29,0,null,null,2,"button",[["class","btn btn-outline-dark"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.registerWorkstation()&&e),e}),null,null)),(l()(),e.qb(30,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(-1,null,["Register"])),(l()(),e.qb(32,0,null,null,3,"div",[["class","row mt-3 pt-3 border border-left-0 border-right-0 border-bottom-0 border-light"]],null,null,null,null,null)),(l()(),e.qb(33,0,null,null,2,"div",[["class","col"]],null,null,null,null,null)),(l()(),e.qb(34,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(-1,null,["Workstations Registered With This Browser"])),(l()(),e.qb(36,0,null,null,9,"div",[["class","row"]],null,null,null,null,null)),(l()(),e.qb(37,0,null,null,8,"div",[["class","col-lg-8"]],null,null,null,null,null)),(l()(),e.qb(38,0,null,null,7,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"change"],[null,"blur"]],(function(l,n,t){var u=!0,s=l.component;return"change"===n&&(u=!1!==e.Cb(l,39).onChange(t.target.value)&&u),"blur"===n&&(u=!1!==e.Cb(l,39).onTouched()&&u),"ngModelChange"===n&&(u=!1!==(s.selectedName=t)&&u),u}),null,null)),e.pb(39,16384,null,0,a.z,[e.C,e.k],null,null),e.Hb(1024,null,a.o,(function(l){return[l]}),[a.z]),e.pb(41,671744,null,0,a.t,[[8,null],[8,null],[8,null],[6,a.o]],{model:[0,"model"]},{update:"ngModelChange"}),e.Hb(2048,null,a.p,null,[a.t]),e.pb(43,16384,null,0,a.q,[[4,a.p]],null,null),(l()(),e.fb(16777216,null,null,1,null,K)),e.pb(45,278528,null,0,o.o,[e.N,e.K,e.r],{ngForOf:[0,"ngForOf"]},null),(l()(),e.qb(46,0,null,null,7,"div",[["class","row mt-2"]],null,null,null,null,null)),(l()(),e.qb(47,0,null,null,6,"div",[["class","col-lg-6"]],null,null,null,null,null)),(l()(),e.qb(48,0,null,null,1,"button",[["class","btn btn-success"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.useNow()&&e),e}),null,null)),(l()(),e.Kb(-1,null,[" Use Now "])),(l()(),e.qb(50,0,null,null,1,"button",[["class","btn btn-outline-dark"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.setDefault()&&e),e}),null,null)),(l()(),e.Kb(-1,null,[" Mark As Default "])),(l()(),e.qb(52,0,null,null,1,"button",[["class","btn btn-danger"]],[[8,"disabled",0]],[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.removeSelected()&&e),e}),null,null)),(l()(),e.Kb(-1,null,[" Remove "]))],(function(l,n){var t=n.component;l(n,2,0,"Workstation Administration"),l(n,4,0,"Manage Workstations"),l(n,6,0,"Workstation Exists",e.ub(1,'Workstation "',t.newName,'" already exists.  Use it anyway?')),l(n,10,0,t.removeWorkstation),l(n,12,0,0==t.workstations.length),l(n,19,0,"Owner...",!0,t.hideOrgs,t.disableOrgs),l(n,25,0,t.newName),l(n,41,0,t.selectedName),l(n,45,0,t.workstations)}),(function(l,n){var t=n.component;l(n,22,0,e.Cb(n,27).ngClassUntouched,e.Cb(n,27).ngClassTouched,e.Cb(n,27).ngClassPristine,e.Cb(n,27).ngClassDirty,e.Cb(n,27).ngClassValid,e.Cb(n,27).ngClassInvalid,e.Cb(n,27).ngClassPending),l(n,29,0,!t.newName||!t.newOwner),l(n,38,0,e.Cb(n,43).ngClassUntouched,e.Cb(n,43).ngClassTouched,e.Cb(n,43).ngClassPristine,e.Cb(n,43).ngClassDirty,e.Cb(n,43).ngClassValid,e.Cb(n,43).ngClassInvalid,e.Cb(n,43).ngClassPending),l(n,48,0,!t.selected),l(n,50,0,!t.selected),l(n,52,0,!t.selected||!t.canDeleteSelected())}))}function _(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,1,"ng-component",[],null,null,null,P,x)),e.pb(1,114688,null,0,N,[I.l,I.a,q.a,y.b,v.a,C.a,k.a,A.b,O.a],null,null)],(function(l,n){l(n,1,0)}),null)}var E=e.mb("ng-component",N,_,{},{},[]),F=t("G8BM"),S=t("EWr9"),R=t("XKii"),L=t("wBwE"),V=t("iA0r"),j=t("LMfH"),H=t("EQoe"),B=t("mW9/"),J=t("avZ9"),X=t("pKmL"),$=t("9RLy"),G=t("VEwP"),U=t("NR/D"),z=t("r2N+"),Y=t("ZqI7"),Q=t("MhCk"),Z=t("MZHd");class ll{}t.d(n,"ManageWorkstationsModuleNgFactory",(function(){return nl}));var nl=e.nb(u,[],(function(l){return e.zb([e.Ab(512,e.j,e.Y,[[8,[s.a,i.a,i.b,i.p,i.q,i.m,i.n,i.o,E]],[3,e.j],e.w]),e.Ab(4608,o.r,o.q,[e.t,[2,o.S]]),e.Ab(4608,a.D,a.D,[]),e.Ab(4608,a.g,a.g,[]),e.Ab(4608,m.E,m.E,[e.j,e.q,m.Fb,m.F]),e.Ab(4608,o.f,o.f,[e.t]),e.Ab(4608,o.d,o.d,[e.t]),e.Ab(4608,F.a,F.a,[]),e.Ab(4608,S.a,S.a,[k.a]),e.Ab(4608,R.a,R.a,[L.a,y.b,k.a,S.a,V.a]),e.Ab(4608,j.a,j.a,[y.b,V.a,v.a,H.a]),e.Ab(4608,B.a,B.a,[L.a,y.b,k.a,S.a,V.a,R.a,j.a]),e.Ab(4608,J.a,J.a,[k.a]),e.Ab(1073742336,o.c,o.c,[]),e.Ab(1073742336,a.C,a.C,[]),e.Ab(1073742336,a.l,a.l,[]),e.Ab(1073742336,a.x,a.x,[]),e.Ab(1073742336,I.o,I.o,[[2,I.t],[2,I.l]]),e.Ab(1073742336,m.c,m.c,[]),e.Ab(1073742336,m.f,m.f,[]),e.Ab(1073742336,m.g,m.g,[]),e.Ab(1073742336,m.k,m.k,[]),e.Ab(1073742336,m.l,m.l,[]),e.Ab(1073742336,m.t,m.t,[]),e.Ab(1073742336,m.z,m.z,[]),e.Ab(1073742336,m.G,m.G,[]),e.Ab(1073742336,m.I,m.I,[]),e.Ab(1073742336,m.N,m.N,[]),e.Ab(1073742336,m.U,m.U,[]),e.Ab(1073742336,m.X,m.X,[]),e.Ab(1073742336,m.ab,m.ab,[]),e.Ab(1073742336,m.gb,m.gb,[]),e.Ab(1073742336,m.lb,m.lb,[]),e.Ab(1073742336,m.ob,m.ob,[]),e.Ab(1073742336,m.rb,m.rb,[]),e.Ab(1073742336,m.ub,m.ub,[]),e.Ab(1073742336,m.H,m.H,[]),e.Ab(1073742336,X.a,X.a,[]),e.Ab(1073742336,$.a,$.a,[]),e.Ab(1073742336,G.a,G.a,[]),e.Ab(1073742336,U.a,U.a,[]),e.Ab(1073742336,z.a,z.a,[]),e.Ab(1073742336,Y.a,Y.a,[]),e.Ab(1073742336,Q.a,Q.a,[]),e.Ab(1073742336,Z.a,Z.a,[]),e.Ab(1073742336,ll,ll,[]),e.Ab(1073742336,u,u,[]),e.Ab(1024,I.j,(function(){return[[{path:"manage",component:N},{path:"remove/:remove",component:N}]]}),[])])}))},"36iw":function(l,n,t){"use strict";t.d(n,"a",(function(){return u}));var e=t("rRT/");class u extends e.a{}},"6rhm":function(l,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return c}));var e=t("8Y7J"),u=t("SVse"),s=(t("36iw"),t("G0yt"),e.ob({encapsulation:2,styles:[],data:{}}));function i(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),e.qb(1,0,null,null,1,"p",[],null,null,null,null,null)),(l()(),e.Kb(2,null,["",""]))],null,(function(l,n){l(n,2,0,n.component.dialogBody)}))}function a(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function o(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),e.fb(16777216,null,null,1,null,a)),e.pb(2,540672,null,0,u.y,[e.N],{ngTemplateOutlet:[0,"ngTemplateOutlet"]},null),(l()(),e.fb(0,null,null,0))],(function(l,n){l(n,2,0,n.component.dialogBodyTemplate)}),null)}function r(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,5,"div",[["class","modal-header bg-info"]],null,null,null,null,null)),(l()(),e.qb(1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),e.Kb(2,null,["",""])),(l()(),e.qb(3,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["type","button"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.close()&&e),e}),null,null)),(l()(),e.qb(4,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),e.Kb(-1,null,["×"])),(l()(),e.qb(6,0,null,null,4,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),e.fb(16777216,null,null,1,null,i)),e.pb(8,16384,null,0,u.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.fb(16777216,null,null,1,null,o)),e.pb(10,16384,null,0,u.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.qb(11,0,null,null,4,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),e.qb(12,0,null,null,1,"button",[["class","btn btn-success"],["type","button"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.close(!0)&&e),e}),null,null)),(l()(),e.Kb(-1,null,["Confirm"])),(l()(),e.qb(14,0,null,null,1,"button",[["class","btn btn-warning"],["type","button"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.close(!1)&&e),e}),null,null)),(l()(),e.Kb(-1,null,["Cancel"]))],(function(l,n){var t=n.component;l(n,8,0,!t.dialogBodyTemplate),l(n,10,0,t.dialogBodyTemplate)}),(function(l,n){l(n,2,0,n.component.dialogTitle)}))}function c(l){return e.Mb(0,[e.Ib(671088640,1,{dialogContent:0}),(l()(),e.fb(0,[[1,2],["dialogContent",2]],null,0,null,r))],null,null)}},CqXF:function(l,n,t){"use strict";t.d(n,"a",(function(){return u}));var e=t("7o/Q");function u(l){return n=>n.lift(new s(l))}class s{constructor(l){this.value=l}call(l,n){return n.subscribe(new i(l,this.value))}}class i extends e.a{constructor(l,n){super(l),this.value=n}_next(l){this.destination.next(this.value)}}},Kj3r:function(l,n,t){"use strict";t.d(n,"a",(function(){return s}));var e=t("7o/Q"),u=t("D0XW");function s(l,n=u.a){return t=>t.lift(new i(l,n))}class i{constructor(l,n){this.dueTime=l,this.scheduler=n}call(l,n){return n.subscribe(new a(l,this.dueTime,this.scheduler))}}class a extends e.a{constructor(l,n,t){super(l),this.dueTime=n,this.scheduler=t,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(l){this.clearDebounce(),this.lastValue=l,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(o,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:l}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(l)}}clearDebounce(){const l=this.debouncedSubscription;null!==l&&(this.remove(l),l.unsubscribe(),this.debouncedSubscription=null)}}function o(l){l.debouncedNext()}},gBxT:function(l,n,t){"use strict";t.d(n,"a",(function(){return a})),t.d(n,"b",(function(){return b}));var e=t("8Y7J"),u=t("s7LF"),s=t("G0yt"),i=t("SVse"),a=(t("wVJ/"),t("8PDw"),t("OXuP"),t("cm5s"),t("wN9v"),e.ob({encapsulation:2,styles:[],data:{}}));function o(l){return e.Mb(0,[(l()(),e.Kb(0,null,["\n","\n"]))],null,(function(l,n){l(n,0,0,n.context.result.label)}))}function r(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,2,null,null,null,null,null,null,null)),(l()(),e.qb(1,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),e.Kb(2,null,["",""]))],null,(function(l,n){l(n,2,0,n.component.selected.label)}))}function c(l){return e.Mb(0,[(l()(),e.qb(0,0,null,null,7,null,null,null,null,null,null,null)),(l()(),e.qb(1,16777216,null,null,6,"input",[["aria-multiline","false"],["autocapitalize","off"],["autocorrect","off"],["class","form-control"],["container","body"],["role","combobox"],["type","text"]],[[1,"id",0],[8,"placeholder",0],[2,"open",null],[8,"autocomplete",0],[1,"aria-autocomplete",0],[1,"aria-activedescendant",0],[1,"aria-owns",0],[1,"aria-expanded",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"click"],[null,"selectItem"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"keydown"]],(function(l,n,t){var u=!0,s=l.component;return"input"===n&&(u=!1!==e.Cb(l,2)._handleInput(t.target.value)&&u),"blur"===n&&(u=!1!==e.Cb(l,2).onTouched()&&u),"compositionstart"===n&&(u=!1!==e.Cb(l,2)._compositionStart()&&u),"compositionend"===n&&(u=!1!==e.Cb(l,2)._compositionEnd(t.target.value)&&u),"blur"===n&&(u=!1!==e.Cb(l,3).handleBlur()&&u),"keydown"===n&&(u=!1!==e.Cb(l,3).handleKeyDown(t)&&u),"ngModelChange"===n&&(u=!1!==(s.selected=t)&&u),"click"===n&&(u=!1!==s.click$.next(t.target.value)&&u),"selectItem"===n&&(u=!1!==s.orgChanged(t)&&u),u}),null,null)),e.pb(2,16384,null,0,u.d,[e.C,e.k,[2,u.a]],null,null),e.pb(3,212992,[[1,4],["instance",4]],0,s.sb,[e.k,e.N,e.C,e.q,e.j,s.tb,e.y,s.vb,i.e,e.y,e.h,e.g],{container:[0,"container"],inputFormatter:[1,"inputFormatter"],ngbTypeahead:[2,"ngbTypeahead"],resultTemplate:[3,"resultTemplate"]},{selectItem:"selectItem"}),e.Hb(1024,null,u.o,(function(l,n){return[l,n]}),[u.d,s.sb]),e.pb(5,671744,null,0,u.t,[[8,null],[8,null],[8,null],[6,u.o]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),e.Hb(2048,null,u.p,null,[u.t]),e.pb(7,16384,null,0,u.q,[[4,u.p]],null,null),(l()(),e.fb(0,null,null,0))],(function(l,n){var t=n.component;l(n,3,0,"body",t.formatter,t.filter,e.Cb(n.parent,1)),l(n,5,0,t.disabled,t.selected)}),(function(l,n){var t=n.component;l(n,1,1,[t.domId.length?t.domId:null,t.placeholder,e.Cb(n,3).isPopupOpen(),e.Cb(n,3).autocomplete,e.Cb(n,3).showHint?"both":"list",e.Cb(n,3).activeDescendant,e.Cb(n,3).isPopupOpen()?e.Cb(n,3).popupId:null,e.Cb(n,3).isPopupOpen(),e.Cb(n,7).ngClassUntouched,e.Cb(n,7).ngClassTouched,e.Cb(n,7).ngClassPristine,e.Cb(n,7).ngClassDirty,e.Cb(n,7).ngClassValid,e.Cb(n,7).ngClassInvalid,e.Cb(n,7).ngClassPending])}))}function b(l){return e.Mb(0,[e.Ib(671088640,1,{instance:0}),(l()(),e.fb(0,[["displayTemplate",2]],null,0,null,o)),(l()(),e.fb(16777216,null,null,1,null,r)),e.pb(3,16384,null,0,i.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.fb(16777216,null,null,1,null,c)),e.pb(5,16384,null,0,i.p,[e.N,e.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var t=n.component;l(n,3,0,t.readOnly&&t.selected),l(n,5,0,!t.readOnly)}),null)}},q92s:function(l,n,t){"use strict";t.d(n,"a",(function(){return u}));var e=t("VRyK");function u(...l){return n=>n.lift.call(Object(e.a)(n,...l))}},wN9v:function(l,n,t){"use strict";t.d(n,"a",(function(){return a}));var e=t("Osig"),u=t("cm5s"),s=t("8PDw"),i=t("8Y7J");let a=(()=>{class l{constructor(l,n,t){this.net=l,this.org=n,this.auth=t}hasWorkPermAt(l,n){return this.net.request("open-ils.actor","open-ils.actor.user.has_work_perm_at.batch",this.auth.token(),l).toPromise().then(t=>{const e={};return l.forEach(l=>{let u=[];t[l].forEach(l=>{u=u.concat(this.org.descendants(l,n))}),e[l]=u}),e})}hasWorkPermHere(l){if(l=[].concat(l),!+this.auth.user().wsid())return Promise.reject("hasWorkPermHere requires a workstation");const n=+this.auth.user().ws_ou();return this.hasWorkPermAt(l,!0).then(l=>{const t={};return Object.keys(l).forEach(e=>{t[e]=l[e].indexOf(n)>-1}),t})}}return l.ngInjectableDef=i.Qb({factory:function(){return new l(i.Rb(e.b),i.Rb(u.a),i.Rb(s.a))},token:l,providedIn:"root"}),l})()},"wVJ/":function(l,n,t){"use strict";t.d(n,"a",(function(){return b}));var e=t("8Y7J"),u=t("XNiG"),s=t("Kj3r"),i=t("/uUt"),a=t("q92s"),o=t("pLZG"),r=t("CqXF"),c=t("lJxs");t("8PDw"),t("OXuP"),t("cm5s"),t("wN9v");class b{constructor(l,n,t,b){this.auth=l,this.store=n,this.org=t,this.perm=b,this.hidden=[],this.click$=new u.a,this.placeholder="",this.domId="",this.displayField="shortname",this.applyDefault=!1,this.readOnly=!1,this._disabledOrgs=[],this.onChange=new e.m,this.sortedOrgs=[],this.formatter=l=>l?l.label.trim():"",this.filter=l=>l.pipe(Object(s.a)(200),Object(i.a)(),Object(a.a)(this.click$.pipe(Object(o.a)(()=>!this.instance.isPopupOpen())).pipe(Object(r.a)("_CLICK_"))),Object(c.a)(l=>{let n=this.sortedOrgs.filter(l=>0===this.hidden.filter(n=>l.id()===n).length);return this.permLimitOrgs&&(n=n.filter(l=>this.permLimitOrgs.includes(l.id()))),"_CLICK_"!==l&&(n=n.filter(n=>""===l||n[this.displayField]().toLowerCase().indexOf(l.toLowerCase())>-1)),n.map(l=>this.formatForDisplay(l))}))}set hideOrgs(l){l&&(this.hidden=l)}set disableOrgs(l){l&&(this._disabledOrgs=l)}set initialOrg(l){l&&(this.startOrg=l)}set initialOrgId(l){l&&(this.startOrg=this.org.get(l))}set applyOrg(l){l&&(this.selected=this.formatForDisplay(l))}set limitPerms(l){this.applyPermLimitOrgs(l)}set applyOrgId(l){l&&(this.selected=this.formatForDisplay(this.org.get(l)))}selectedOrg(){return null==this.selected?null:this.org.get(this.selected.id)}ngOnInit(){this.org.sortTree(this.displayField),this.org.absorbTree(),this.sortedOrgs=this.org.list(),!this.startOrg&&this.applyDefault&&this.auth.user()&&(this.startOrg=this.org.get(this.auth.user().ws_ou()),this.selected=this.formatForDisplay(this.org.get(this.auth.user().ws_ou())),setTimeout(()=>this.onChange.emit(this.startOrg),0)),this.startOrg&&(this.selected=this.formatForDisplay(this.startOrg))}applyPermLimitOrgs(l){l&&0!==(l=l.filter(l=>null!=l)).length&&this.perm.hasWorkPermAt(l,!0).then(l=>{this.permLimitOrgs=Object.values(l).reduce((l,n)=>l.concat(n),[])})}formatForDisplay(l){let n=l[this.displayField]();return this.readOnly||(n=" ".repeat(l.ou_type().depth())+n),{id:l.id(),label:n,disabled:!1}}orgChanged(l){this.onChange.emit(this.org.get(l.item.id))}reset(){this.selected=null}}}}]);